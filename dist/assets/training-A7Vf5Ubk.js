import"./modulepreload-polyfill-B5Qt9EMX.js";import"./config-8gd_ljfe.js";import{r as c,j as t,c as X,R as H}from"./client-Chk-tuEE.js";import{DictionaryDB as w,DataLoader as A}from"./db-CUAitF01.js";import{T as _}from"./tts-D1JXvOqA.js";import{ThemeManager as J}from"./utils-5O7zxelZ.js";import{L as V}from"./i18n-Dq4jSOyT.js";import"./toast-manager-DdtDDR9Z.js";var E=(e=>(e[e.Again=0]="Again",e[e.Hard=3]="Hard",e[e.Good=4]="Good",e[e.Easy=5]="Easy",e))(E||{});const P={nextReview:Date.now(),interval:0,easeFactor:2.5,repetitions:0};function Z(e,n=P){const{easeFactor:r,interval:l,repetitions:v}=n,u=Math.max(0,Math.min(5,Math.round(e)));let m,h,x;u<3?(m=1,x=0,h=Math.max(1.3,r-.2)):(x=v+1,h=r+(.1-(5-u)*(.08+(5-u)*.02)),h=Math.max(1.3,h),x===1?m=1:x===2?m=6:m=Math.round(l*h),u===5&&(m=Math.round(m*1.3))),m=Math.min(365,m);const T=Date.now();return{newData:{nextReview:T+m*24*60*60*1e3,interval:m,easeFactor:Math.round(h*100)/100,repetitions:x,lastReview:T},wasCorrect:u>=3}}const z=[{quality:0,label:"Igen / Ù…Ø±Ø© Ø£Ø®Ø±Ù‰",color:"#ef4444",icon:"ðŸ”„"},{quality:3,label:"SvÃ¥rt / ØµØ¹Ø¨",color:"#f97316",icon:"ðŸ˜“"},{quality:4,label:"Bra / Ø¬ÙŠØ¯",color:"#22c55e",icon:"ðŸ‘"},{quality:5,label:"Klar / ØªÙ…",color:"#3b82f6",icon:"ðŸ—‘ï¸"}],Q=()=>{const[e,n]=c.useState([]),[r,l]=c.useState(0),[v,u]=c.useState(!1),[m,h]=c.useState(!0),[x,T]=c.useState(!1),[R,M]=c.useState(null),[p,B]=c.useState({wordsReviewed:0,correctCount:0,startTime:Date.now()}),[U,Y]=c.useState(!1),L=c.useRef(0),D=c.useRef(0),y=c.useRef(null);c.useEffect(()=>{W(),setTimeout(()=>T(!0),100)},[]);const W=async()=>{h(!0);try{await w.hasCachedData()||await A.loadDictionary();const a=await w.getTrainingWordsDue(),o=s=>Array.isArray(s)?{id:s[0],swe:s[2],arb:s[3],type:s[1],sweDef:s[5],sweEx:s[7],arbEx:s[8]}:{id:s.id,swe:s.swe||s.swedish,arb:s.arb||s.arabic,type:s.type,sweDef:s.sweDef,sweEx:s.sweEx,arbEx:s.arbEx};let d=a.map(o);d.some(s=>!s.swe||!s.arb)&&(await A.refreshCache(),d=(await w.getTrainingWordsDue()).map(o));const j=d.filter(s=>s.swe&&s.arb);n(j)}catch(a){console.error("Failed to load training words",a)}finally{h(!1)}},$=()=>{B({wordsReviewed:0,correctCount:0,startTime:Date.now()}),l(0),u(!1),M(null),W()};c.useEffect(()=>{(async()=>{if(e.length===0){const o=await w.getTrainingCount();Y(o>0)}})()},[e.length]);const i=e[r],C=()=>{if(!i)return;_.speak(i.swe);const a=parseInt(localStorage.getItem("ttsUsage")||"0",10);localStorage.setItem("ttsUsage",(a+1).toString())},I=c.useRef(0),S=c.useRef(0),b=c.useRef(!1),F=a=>{L.current=a.touches[0].clientX,I.current=a.touches[0].clientY,b.current=!1},O=a=>{D.current=a.touches[0].clientX,S.current=a.touches[0].clientY;const o=D.current-L.current,d=S.current-I.current;if((Math.abs(o)>5||Math.abs(d)>5)&&(b.current=!0),Math.abs(o)>Math.abs(d)){if(Math.abs(o)>10&&y.current){a.cancelable&&a.preventDefault();const f=o*.05,j=v?180:0;y.current.style.transform=`translateX(${o}px) rotateY(${j}deg) rotateZ(${f}deg)`}}else if(d<-10&&y.current){const f=v?180:0;y.current.style.transform=`translateY(${d*.3}px) rotateY(${f}deg)`}},q=a=>{const o=D.current-L.current,d=S.current-I.current,f=60;b.current&&a.cancelable&&a.preventDefault(),y.current&&(y.current.style.transform=""),b.current&&(Math.abs(o)>Math.abs(d)?o>f?k(E.Good):o<-f&&k(E.Again):d<-40&&(C(),"vibrate"in navigator&&navigator.vibrate(20))),L.current=0,D.current=0,I.current=0,S.current=0,setTimeout(()=>{b.current=!1},200)},G=()=>{b.current||(u(!v),C())},k=async a=>{if(!i)return;const d=await w.getReviewData(i.id)||P,{newData:f,wasCorrect:j}=Z(a,d);if(a===E.Easy){await w.updateTrainingStatus(i.id,!1);const s=JSON.parse(localStorage.getItem("wordAssessments")||"{}");s[i.id]={id:i.id,level:5,timestamp:Date.now()},localStorage.setItem("wordAssessments",JSON.stringify(s))}else await w.updateReviewData(i.id,f);B(s=>({...s,wordsReviewed:s.wordsReviewed+1,correctCount:s.correctCount+(j?1:0)})),M(j?"right":"left"),"vibrate"in navigator&&navigator.vibrate(j?50:[50,30,50]),setTimeout(()=>{if(M(null),u(!1),a===E.Again)n(s=>{const N=[...s],[K]=N.splice(r,1);return N.push(K),N});else{const s=e.filter(N=>N.id!==i.id);n(s),r>=s.length&&l(Math.max(0,s.length-1))}},300)};return c.useEffect(()=>()=>{p.wordsReviewed>0&&w.saveTrainingSession({date:new Date().toISOString().split("T")[0],wordsReviewed:p.wordsReviewed,correctCount:p.correctCount,timeSpentMs:Date.now()-p.startTime})},[p]),m?t.jsxs("div",{className:"training-loading",children:[t.jsx("div",{className:"loading-spinner"}),t.jsx("p",{className:"text-loading",children:"Laddar..."})]}):e.length===0?t.jsx(ee,{stats:p,hasMore:U,onRestart:$}):t.jsxs("div",{className:`training-container transition-opacity duration-700 ${x?"opacity-100":"opacity-0"}`,children:[t.jsxs("div",{className:"training-header",children:[t.jsx("button",{className:"training-back-btn",onClick:()=>window.location.href="/","aria-label":"Tillbaka / Ø±Ø¬ÙˆØ¹",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),t.jsx("polyline",{points:"12 19 5 12 12 5"})]})}),t.jsxs("div",{className:"training-counter",children:[t.jsx("span",{children:"Kvar:"}),t.jsx("span",{className:"counter-label",children:e.length})]}),t.jsxs("div",{className:"training-counter mastered-counter",children:[t.jsx("span",{children:"ðŸ“Š"}),t.jsx("span",{className:"counter-label mastered-val",children:p.wordsReviewed>0?`${Math.round(p.correctCount/p.wordsReviewed*100)}%`:"0%"})]})]}),t.jsx("div",{className:`training-card ${v?"flipped":""} ${R?`swipe-${R}`:""}`,onClick:G,onTouchStart:F,onTouchMove:O,onTouchEnd:q,children:t.jsxs("div",{className:"card-inner",ref:y,children:[t.jsxs("div",{className:"card-face card-front",children:[i.type&&t.jsx("div",{className:"card-type",children:i.type}),t.jsx("h2",{className:"card-word",children:i.swe})]}),t.jsxs("div",{className:"card-face card-back",children:[t.jsx("h2",{className:"card-arabic",dir:"rtl",children:i.arb}),t.jsx("div",{className:"divider"}),t.jsxs("div",{className:"card-section",children:[i.sweDef&&t.jsx("div",{className:"card-definition",children:i.sweDef}),i.sweEx&&t.jsxs("div",{className:"card-example-container",children:[t.jsxs("p",{className:"card-example-swe",children:['"',i.sweEx,'"']}),i.arbEx&&t.jsx("p",{className:"card-example",dir:"rtl",children:i.arbEx})]})]})]})]})}),t.jsx("div",{className:"swipe-hint-container",children:"ðŸ‘† Tryck fÃ¶r att vÃ¤nda â€¢ Ø§Ø¶ØºØ· Ù„Ù„Ù‚Ù„Ø¨"}),t.jsx("div",{className:"training-controls sm2-controls",children:z.map(a=>t.jsxs("button",{onClick:o=>{o.stopPropagation(),k(a.quality)},className:`training-btn sm2-btn quality-${a.quality}`,style:{"--btn-color":a.color},children:[t.jsx("span",{className:"btn-icon",children:a.icon}),t.jsx("span",{className:"btn-label",children:a.label.split(" / ")[0]})]},a.quality))})]})},ee=({stats:e,hasMore:n,onRestart:r})=>{if(e.wordsReviewed===0)return t.jsx("div",{className:"training-container",children:t.jsxs("div",{className:"training-state complete",children:[t.jsx("div",{className:"state-emoji",children:"â˜•ï¸"}),t.jsx("h2",{className:"text-white",children:"Allt Ã¤r klart!"}),t.jsx("p",{children:"Du har inga ord att repetera just nu. Kom tillbaka senare!"}),t.jsx("p",{className:"text-sm opacity-70 mt-2",children:"Du Ã¤r helt i fas med din plan."}),t.jsx("div",{className:"complete-actions",children:t.jsx("a",{href:"/",className:"training-btn primary",children:"Tillbaka Hem"})})]})});const l=Math.round(e.correctCount/e.wordsReviewed*100),v=Math.max(1,Math.round((Date.now()-e.startTime)/6e4));return t.jsx("div",{className:"training-container",children:t.jsxs("div",{className:"training-state complete",children:[t.jsx("div",{className:"state-emoji",children:"ðŸŽ‰"}),t.jsx("h2",{className:"text-white",children:"TrÃ¤ning Klar!"}),t.jsx("p",{children:"Grymt jobbat! Du har repeterat alla ord som behÃ¶vdes idag."}),t.jsxs("div",{className:"stats-grid",children:[t.jsxs("div",{className:"stat-item",children:[t.jsx("span",{className:"stat-value",children:e.wordsReviewed}),t.jsx("span",{className:"stat-label",children:"Ord repeterade"})]}),t.jsxs("div",{className:"stat-item",children:[t.jsxs("span",{className:"stat-value",children:[l,"%"]}),t.jsx("span",{className:"stat-label",children:"Precision"})]}),t.jsxs("div",{className:"stat-item",children:[t.jsxs("span",{className:"stat-value",children:[v,"m"]}),t.jsx("span",{className:"stat-label",children:"Tid"})]})]}),t.jsxs("div",{className:"complete-actions",children:[n&&t.jsx("button",{onClick:r,className:"training-btn",style:{width:"auto",flex:"none",height:"50px",padding:"0 1.5rem"},children:"ðŸ”„ TrÃ¤na Igen"}),t.jsx("a",{href:"/",className:"training-btn primary",children:"Tillbaka Hem"})]})]})})};J.init();V.init();document.addEventListener("DOMContentLoaded",async()=>{const e=document.getElementById("training-root");if(!e){console.error("[TrainingApp] Mount point not found");return}X.createRoot(e).render(H.createElement(Q)),console.log("[TrainingApp] Mounted successfully")});"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{const e=new URL("/assets/sw-sxs_KKb2.ts",import.meta.url),n=await navigator.serviceWorker.register(e,{type:"module"});console.log("[PWA] ServiceWorker registered with URL:",e.href),n.addEventListener("updatefound",()=>{const r=n.installing;r&&(console.log("[PWA] New service worker installing..."),r.addEventListener("statechange",()=>{r.state==="installed"&&navigator.serviceWorker.controller&&te()}))})}catch(e){console.log("[PWA] ServiceWorker registration failed:",e)}});function te(){const e=document.getElementById("updatePrompt");if(e){e.classList.remove("hidden");const n=document.getElementById("updateBtn"),r=document.getElementById("dismissUpdate");n&&n.addEventListener("click",()=>{var l;(l=navigator.serviceWorker.controller)==null||l.postMessage({type:"SKIP_WAITING"}),window.location.reload()}),r&&r.addEventListener("click",()=>{e.classList.add("hidden")})}}window.addEventListener("online",()=>{const e=document.getElementById("offlineBanner");e&&e.classList.add("hidden")});window.addEventListener("offline",()=>{const e=document.getElementById("offlineBanner");e&&e.classList.remove("hidden")});if(!navigator.onLine){const e=document.getElementById("offlineBanner");e&&e.classList.remove("hidden")}let g=null;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),g=e;const n=document.getElementById("installApp"),r=document.getElementById("pwa-install-prompt");n&&(n.classList.remove("hidden"),n.addEventListener("click",async()=>{if(g){g.prompt();const{outcome:l}=await g.userChoice;console.log("[PWA] User response:",l),g=null,n.classList.add("hidden")}})),r&&!localStorage.getItem("pwa-prompt-dismissed")&&setTimeout(()=>{r.classList.remove("hidden")},5e3)});document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("pwa-install-btn"),n=document.getElementById("pwa-later-btn"),r=document.getElementById("pwa-install-prompt");e&&e.addEventListener("click",async()=>{if(g){g.prompt();const{outcome:l}=await g.userChoice;console.log("[PWA] Install prompt outcome:",l),g=null}r&&r.classList.add("hidden")}),n&&n.addEventListener("click",()=>{r&&r.classList.add("hidden"),localStorage.setItem("pwa-prompt-dismissed","true")})});const se=/iPad|iPhone|iPod/.test(navigator.userAgent),ae=window.matchMedia("(display-mode: standalone)").matches||navigator.standalone;if(se&&!ae){const e=document.getElementById("iosInstallPrompt");if(e&&!localStorage.getItem("ios-prompt-dismissed")){setTimeout(()=>{e.classList.remove("hidden"),setTimeout(()=>{e.style.transition="opacity 0.5s ease-out, transform 0.5s ease-out",e.style.opacity="0",e.style.transform="translateY(20px)",setTimeout(()=>{e.classList.add("hidden"),e.style.opacity="",e.style.transform="",e.style.transition=""},500)},15e3)},1e4);const n=document.getElementById("closeIosPrompt");n&&n.addEventListener("click",()=>{e.classList.add("hidden"),localStorage.setItem("ios-prompt-dismissed","true")})}}console.log("[PWA] Module loaded");
