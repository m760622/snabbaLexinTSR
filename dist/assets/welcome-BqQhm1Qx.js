var l=Object.defineProperty;var d=(o,e,t)=>e in o?l(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var c=(o,e,t)=>d(o,typeof e!="symbol"?e+"":e,t);import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css                            */import{A as s}from"./config-CfHoVMbv.js";import{D as i}from"./db-bEbbjtoI.js";class p{constructor(){c(this,"tipInterval",null);this.init()}async init(){this.startSplashUI(),setTimeout(()=>{console.warn("[Welcome] Timeout reached (15s). Forcing redirect..."),localStorage.setItem("snabbaLexin_dataReady","true"),localStorage.setItem("snabbaLexin_version",s.DATA_VERSION),this.redirectToApp()},15e3);try{console.log("[Welcome] Initializing DB..."),await i.init();const e=localStorage.getItem("snabbaLexin_dataReady")==="true",t=localStorage.getItem("snabbaLexin_version");if(e&&t===s.DATA_VERSION&&await i.hasCachedData()){console.log("[Welcome] Data valid, redirecting to app..."),this.redirectToApp();return}await this.fetchData()}catch(e){console.error("[Welcome] Init failed:",e),this.updateProgress(0,"Fel vid start / خطأ في البدء")}}redirectToApp(){const t=new URLSearchParams(window.location.search).get("redirect");t&&(t.startsWith("/")||t.startsWith("http"))?window.location.replace(decodeURIComponent(t)):window.location.replace("index.html")}startSplashUI(){console.log("[Welcome] UI started"),this.updateProgress(10,"Ansluter... / جاري الاتصال...");const e=s.LOADING_TIPS,t=document.getElementById("splashTip");t&&(t.textContent=e[0],this.tipInterval&&clearInterval(this.tipInterval),this.tipInterval=setInterval(()=>{t.style.opacity="0",setTimeout(()=>{const a=Math.floor(Math.random()*e.length);t.textContent=e[a],t.style.opacity="1"},500)},s.SPLASH.TIP_ROTATION_INTERVAL))}updateProgress(e,t){const a=document.getElementById("splashProgressBar"),r=document.getElementById("splashPercent"),n=document.getElementById("splashStatus");a&&(a.style.width=`${e}%`),r&&(r.textContent=`${Math.round(e)}%`),n&&t&&(n.textContent=t)}async fetchData(){return new Promise((e,t)=>{const a=new XMLHttpRequest;a.open("GET",s.DATA_PATH.root,!0),a.onprogress=r=>{if(r.lengthComputable){let n=r.loaded/r.total*100;n=Math.min(90,n),this.updateProgress(n,"Laddar data... / جاري التحميل...")}},a.onload=async()=>{if(a.status===200){this.updateProgress(90,"Bearbetar... / جاري المعالجة...");try{const r=JSON.parse(a.responseText);await this.processData(r),e()}catch(r){console.error("[Welcome] JSON Parse error",r),this.updateProgress(100,"Fel vid data / خطأ في البيانات"),t(r)}}else t(new Error(`HTTP ${a.status}`))},a.onerror=()=>t(new Error("Network Error")),a.send()})}async processData(e){try{await i.saveWords(e,t=>{this.updateProgress(90+t*.1,"Sparar data... / جاري الحفظ...")}),await i.setDataVersion(s.DATA_VERSION),localStorage.setItem("snabbaLexin_dataReady","true"),localStorage.setItem("snabbaLexin_version",s.DATA_VERSION),this.updateProgress(100,"Klar! / تم!"),setTimeout(()=>this.redirectToApp(),500)}catch(t){throw console.error("[Welcome] Save failed:",t),this.updateProgress(100,"Kunde inte spara / تعذر الحفظ"),t}}}new p;
