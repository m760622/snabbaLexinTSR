import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css              */import"./loader-DOLU1NFP.js";import{s as L,a as D}from"./games-utils-CmJc8SbM.js";import{A as i}from"./config-8gd_ljfe.js";import{generateEducationalSentence as x}from"./utils-5O7zxelZ.js";import{T as u}from"./tts-D1JXvOqA.js";import{L as M,t as p}from"./i18n-BpwFYk4h.js";import"./db-D9nATt-F.js";import"./toast-manager-DdtDDR9Z.js";console.log("spellingGame.ts LOADED - VERSION DEBUG 1234");let d=null,C=0,E=0;function h(t=0){if(typeof dictionaryData>"u"||dictionaryData.length===0){console.log("Data not ready for Spelling. Waiting for dictionaryLoaded event...");const n=()=>{console.log("dictionaryLoaded event received in Spelling Game"),window.removeEventListener("dictionaryLoaded",n),h(0)};window.addEventListener("dictionaryLoaded",n),t<20?setTimeout(()=>{(typeof dictionaryData>"u"||dictionaryData.length===0)&&h(t+1)},500):(console.error("Critical: Data failed to load for Spelling."),typeof L=="function"&&L(p("common.error"),"error"));return}C=0,E=0,H(),I(),B()}function I(){const t=document.getElementById("spellingHint"),n=document.getElementById("spellingExample"),a=document.getElementById("spellingOptions"),s=document.getElementById("spellingFeedback"),o=document.getElementById("nextSpellingBtn"),m=document.getElementById("spHintBtn");if(window.spellingCountdownInterval&&(clearInterval(window.spellingCountdownInterval),window.spellingCountdownInterval=null),!t||!a||!s)return;s.innerHTML="",s.className="sp-feedback",o&&(o.classList.remove("hidden"),o.style.setProperty("display","flex","important"),o.innerHTML='<span data-i18n="games.next">NÃ¤sta</span> âžœ'),m&&m.classList.remove("hidden"),a.innerHTML=`<div class="sp-loading"><div class="sp-loading-spinner"></div><span>${p("common.loading")}</span></div>`;let r=null,w=0;for(;!r&&w<200;){const e=dictionaryData[Math.floor(Math.random()*dictionaryData.length)];e&&e[i.COLUMNS.SWEDISH]&&e[i.COLUMNS.ARABIC]&&e[i.COLUMNS.SWEDISH].length>2&&e[i.COLUMNS.SWEDISH].length<15&&(r=e),w++}if(!r){t.textContent=p("details.noWordFound"),n&&(n.textContent=""),a.innerHTML=`<button class="spelling-option-btn" onclick="loadSpellingQuestion()">${p("learn.tryAgain")}</button>`;return}d=r;const g=r[i.COLUMNS.SWEDISH],v=r[i.COLUMNS.ARABIC];t.textContent=v,n&&(n.textContent="");const c=[g];let y=0;for(;c.length<4&&y<100;){const e=dictionaryData[Math.floor(Math.random()*dictionaryData.length)];e&&e[i.COLUMNS.SWEDISH]&&e[i.COLUMNS.SWEDISH]!==g&&!c.includes(e[i.COLUMNS.SWEDISH])&&e[i.COLUMNS.SWEDISH].length>2&&c.push(e[i.COLUMNS.SWEDISH]),y++}c.sort(()=>Math.random()-.5),setTimeout(()=>{a.innerHTML="",c.forEach((e,S)=>{const l=document.createElement("button");l.className="spelling-option-btn",l.textContent=e,l.style.animationDelay=`${S*.1}s`,l.onclick=()=>{typeof soundManager<"u"&&(soundManager!=null&&soundManager.playClick)&&soundManager.playClick(),T(e,g,l)},a.appendChild(l)})},300);const f=document.getElementById("spSpeakHint");f&&(f.onclick=()=>{typeof u<"u"&&u&&u.speak(g,"sv")})}function T(t,n,a){console.log("checkSpellingAnswer CALLED",{selected:t,correct:n});const s=document.getElementById("spellingFeedback"),o=document.getElementById("nextSpellingBtn"),m=document.getElementById("spHintBtn"),r=document.querySelectorAll(".spelling-option-btn");if(!s||!d)return;r.forEach(e=>e.disabled=!0),m&&m.classList.add("hidden");const w=d[i.COLUMNS.ARABIC]||"",g=d[i.COLUMNS.EXAMPLE_SWE]||"",v=d[i.COLUMNS.EXAMPLE_ARB]||"",c=d[i.COLUMNS.DEFINITION]||"",y=d[i.COLUMNS.TYPE]||"ord";let f="";if(typeof x=="function"){const e=x(n,w,g,v,c,y);f+=`<div class="sp-example-sentence">
            <div class="sp-sentence-swe">ðŸ“– ${e.s}</div>
            <div class="sp-sentence-arb calc-text-size">${e.a}</div>
        </div>`}if(t===n){console.log("Correct answer selected - entering success block"),a.classList.add("correct"),C++,E++,H();try{typeof HapticManager<"u"&&HapticManager?HapticManager.trigger("success"):navigator.vibrate&&navigator.vibrate([50,30,50])}catch(e){console.error("Haptic error",e)}try{typeof soundManager<"u"&&(soundManager!=null&&soundManager.playSuccess)&&soundManager.playSuccess()}catch(e){console.error("Sound error",e)}s.innerHTML=f,s.className="sp-feedback success";try{window.TextSizeManager&&window.TextSizeManager.applyRules()}catch(e){console.error("TextSize error",e)}try{typeof D=="function"&&D("spelling",C)}catch(e){console.error("SaveScore error",e)}if(o){o.classList.remove("hidden"),o.style.setProperty("display","flex","important");let e=5;const S=o.innerHTML,l=()=>{e>0&&(o.innerHTML=`<span data-i18n="games.next">NÃ¤sta</span> (${e}s) âžœ`,e--)};l(),window.spellingCountdownInterval&&clearInterval(window.spellingCountdownInterval),window.spellingCountdownInterval=setInterval(()=>{e>0?l():(clearInterval(window.spellingCountdownInterval),o.innerHTML=S,I())},1e3)}}else if(a.classList.add("wrong"),r.forEach(e=>{e.textContent===n&&setTimeout(()=>e.classList.add("correct"),300)}),s.innerHTML=f,s.className="sp-feedback",E=0,H(),typeof soundManager<"u"&&(soundManager!=null&&soundManager.playError)&&soundManager.playError(),o){o.classList.remove("hidden"),o.style.setProperty("display","flex","important");let e=5;const S=o.innerHTML,l=()=>{e>0&&(o.innerHTML=`<span data-i18n="games.next">NÃ¤sta</span> (${e}s) âžœ`,e--)};l(),window.spellingCountdownInterval&&clearInterval(window.spellingCountdownInterval),window.spellingCountdownInterval=setInterval(()=>{e>0?l():(clearInterval(window.spellingCountdownInterval),o.innerHTML=S,I())},1e3)}typeof u<"u"&&u&&u.speak(n,"sv")}function b(){if(!d)return;const n=d[i.COLUMNS.SWEDISH].charAt(0).toUpperCase();typeof L=="function"&&L(`ðŸ’¡ ${p("games.firstLetter").replace("{0}",n)}`,"info");const a=document.getElementById("spHintBtn");a&&(a.disabled=!0,a.style.opacity="0.5")}function H(){const t=document.getElementById("spellingScore"),n=document.getElementById("spellingStreak");t&&(t.textContent=String(C)),n&&(n.textContent=String(E))}function B(){const t=document.querySelector(".hud-btn");t&&(t.setAttribute("aria-label",p("nav.back")),t.setAttribute("title",p("nav.back"))),M&&M.updateTranslations()}document.addEventListener("DOMContentLoaded",()=>{M&&(M.onLanguageChange(()=>{B()}),B())});window.startSpellingGame=h;window.showSpellingHint=b;window.loadSpellingQuestion=I;
