import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css              */import"./loader-CqI2jdYk.js";import{s as E,b as l,c as h,a as w}from"./games-utils-CEOlpawa.js";import{T as m}from"./tts-CfZZetlp.js";import"./config-CfHoVMbv.js";import"./db-bEbbjtoI.js";import"./i18n-BpwFYk4h.js";import"./toast-manager-DdtDDR9Z.js";console.log("pronunciationGame.ts LOADED");let u=null,p=0,f=!1,a=null;function y(){if("webkitSpeechRecognition"in window)a=new webkitSpeechRecognition;else if("SpeechRecognition"in window)a=new SpeechRecognition;else return;a.lang="sv-SE",a.continuous=!1,a.interimResults=!1,a.onresult=S,a.onerror=k,a.onend=()=>{f=!1,D()}}function g(t=0){if(typeof dictionaryData>"u"||dictionaryData.length===0){t<20?(console.log(`[Pronunciation] Data not ready. Retrying (${t+1}/20)...`),setTimeout(()=>g(t+1),500)):(console.error("[Pronunciation] Data failed to load."),E("Kunde inte ladda data.","error"));return}const o=document.getElementById("pronunciationWord"),n=document.getElementById("pronunciationTranslation"),e=document.getElementById("pronunciationFeedback"),i=document.getElementById("nextPronunciationBtn");if(!o||!n||!e)return;e.innerHTML="",e.className="pronunciation-feedback",i&&(i.style.display="none");let r=null,s=0;for(;!r&&s<200;){const c=dictionaryData[Math.floor(Math.random()*dictionaryData.length)];c&&c[l]&&c[h]&&c[l].length>=3&&c[l].length<=12&&!c[l].includes(" ")&&(r=c),s++}if(!r){o.textContent="Fel",n.textContent="Kunde inte hitta ett ord";return}u=r[l].toLowerCase(),o.textContent=r[l],n.textContent=r[h],a||y(),typeof m<"u"&&m&&setTimeout(()=>m.speak(r[l],"sv"),500)}function B(){if(!a&&(y(),!a)){I("Tyvärr stöds inte tal i denna webbläsare","error");return}if(f)a.stop(),f=!1;else try{a.start(),f=!0}catch(t){console.error("Speech recognition error:",t)}D()}function D(){const t=document.getElementById("micBtn"),o=document.getElementById("micStatus");!t||!o||(f?(t.classList.add("listening"),o.textContent="Lyssnar... / أستمع..."):(t.classList.remove("listening"),o.textContent="Tryck för att tala / اضغط للتحدث"))}function S(t){const o=document.getElementById("pronunciationFeedback"),n=document.getElementById("nextPronunciationBtn"),e=document.getElementById("pronunciationScore");if(!o||!u)return;let i="";for(let s=t.resultIndex;s<t.results.length;s++)i+=t.results[s][0].transcript;i=i.toLowerCase().trim(),console.log("Heard:",i,"Target:",u),i.includes(u)||u.includes(i)||L(i,u)<=2?(o.innerHTML=`✅ Bra uttal! / نطق ممتاز!<br><span style="opacity:0.7">Du sa: "${i}"</span>`,o.className="pronunciation-feedback success",p++,e&&(e.textContent=String(p)),typeof w=="function"&&w("pronunciation",p)):(o.innerHTML=`⚠️ Försök igen!<br><span style="opacity:0.7">Du sa: "${i}"</span>`,o.className="pronunciation-feedback warning"),n&&(n.style.display="block")}function k(t){console.error("Speech error:",t.error),I(`Fel: ${t.error}`,"error")}function I(t,o){const n=document.getElementById("pronunciationFeedback");n&&(n.textContent=t,n.className=`pronunciation-feedback ${o}`)}function L(t,o){if(t.length===0)return o.length;if(o.length===0)return t.length;const n=[];for(let e=0;e<=o.length;e++)n[e]=[e];for(let e=0;e<=t.length;e++)n[0][e]=e;for(let e=1;e<=o.length;e++)for(let i=1;i<=t.length;i++)o.charAt(e-1)===t.charAt(i-1)?n[e][i]=n[e-1][i-1]:n[e][i]=Math.min(n[e-1][i-1]+1,n[e][i-1]+1,n[e-1][i]+1);return n[o.length][t.length]}let d=!1;function v(){if(d)return;if(typeof dictionaryData<"u"&&dictionaryData.length>0){console.log("[Pronunciation] Data already available, starting game..."),d=!0,g();return}let t=0;const o=50,n=setInterval(()=>{if(d){clearInterval(n);return}t++,typeof dictionaryData<"u"&&dictionaryData.length>0?(console.log("[Pronunciation] Data found via polling, starting game..."),clearInterval(n),d=!0,g()):t>=o&&(console.error("[Pronunciation] Timeout waiting for dictionary data"),clearInterval(n),E("Kunde inte ladda data. Uppdatera sidan. / تعذر تحميل البيانات.","error"))},100);console.log("[Pronunciation] Waiting for dictionaryLoaded event..."),window.addEventListener("dictionaryLoaded",()=>{d||(console.log("[Pronunciation] dictionaryLoaded event received, starting game..."),clearInterval(n),d=!0,g())},{once:!0})}document.addEventListener("DOMContentLoaded",()=>{y();const t=document.getElementById("micBtn");t&&(t.onclick=B),v()});window.startPronunciationGame=g;window.toggleMic=B;
