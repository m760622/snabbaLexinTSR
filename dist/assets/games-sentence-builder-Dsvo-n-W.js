import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css              */import"./loader-BlPi5qr6.js";import{s as g,a as k}from"./games-utils-ODhg8alW.js";import{A as f}from"./config-8gd_ljfe.js";import{T as s}from"./tts-D1JXvOqA.js";import{t as l}from"./i18n-Dq4jSOyT.js";import"./db-CUAitF01.js";import"./toast-manager-DdtDDR9Z.js";console.log("sentenceBuilderGame.ts LOADED");let y=[],h=[],S=0,I=0,E=0;function v(){const e=localStorage.getItem("gameTheme")||"neon";document.documentElement.setAttribute("data-theme",e),T(e)}function D(){const t=document.documentElement.getAttribute("data-theme")==="calm"?"neon":"calm";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("gameTheme",t),T(t)}function T(e){const t=document.getElementById("themeToggle");t&&(t.textContent=e==="calm"?"‚òÄÔ∏è":"üåô",t.title=e==="calm"?"Ÿàÿ∂ÿπ ŸÜŸäŸàŸÜ":"Ÿàÿ∂ÿπ ŸáÿßÿØÿ¶")}function w(e){typeof s<"u"&&s&&s.speak(e,"sv")}function b(e,t){let n=3;return e>120&&n--,e>60&&n--,t>0&&n--,Math.max(1,n)}function C(e,t,n){const o=JSON.parse(localStorage.getItem("sentenceBuilderStats")||"{}");o[e]||(o[e]={attempts:0,correct:0,totalTime:0}),o[e].attempts++,o[e].correct++,o[e].totalTime+=t,o[e].lastSeen=Date.now(),localStorage.setItem("sentenceBuilderStats",JSON.stringify(o))}window.toggleTheme=D;window.speakWord=w;function p(e=0){if(typeof dictionaryData>"u"||dictionaryData.length===0){e<10?(console.warn(`Data not ready for Sentence Builder. Retrying (${e+1}/10)...`),typeof g=="function"&&g(l("common.loading"),"info"),setTimeout(()=>p(e+1),500)):(console.error("Critical: Data failed to load for Sentence Builder."),typeof g=="function"&&g(l("common.error"),"error"));return}const t=document.getElementById("sentenceHint"),n=document.getElementById("sentenceDropZone"),o=document.getElementById("sentenceWordBank"),c=document.getElementById("sentenceFeedback"),d=document.getElementById("nextSentenceBtn"),a=document.getElementById("checkSentenceBtn");if(!t||!n||!o||!c)return;c.innerHTML="",c.className="game-feedback",d&&(d.style.display="none"),a&&(a.style.display="block"),n.innerHTML=`<div class="drop-placeholder">${l("games.dragHere")}</div>`,o.innerHTML="",h=[];let r=null,B=0;for(;!r&&B<200;){const i=dictionaryData[Math.floor(Math.random()*dictionaryData.length)];i&&i[f.COLUMNS.EXAMPLE_SWE]&&i[f.COLUMNS.EXAMPLE_SWE].split(" ").length>=3&&i[f.COLUMNS.EXAMPLE_SWE].split(" ").length<=8&&(r=i),B++}if(!r){t.textContent=l("details.noWordFound");return}const L=r[f.COLUMNS.EXAMPLE_SWE],M=r[f.COLUMNS.EXAMPLE_ARB]||r[f.COLUMNS.ARABIC]||"";t.innerHTML=`<span style="display: block;">${M}</span>`,y=L.split(" ").filter(i=>i.length>0),[...y].sort(()=>Math.random()-.5).forEach(i=>{const m=document.createElement("button");m.className="sentence-word",m.textContent=i,m.onclick=()=>A(m,i),m.ondblclick=()=>w(i),o.appendChild(m)}),I=Date.now(),E=0,a&&(a.onclick=x)}function A(e,t){const n=document.getElementById("sentenceDropZone"),o=document.getElementById("sentenceWordBank");if(!n||!o)return;const c=n.querySelector(".drop-placeholder");if(e.parentElement===o)c&&c.remove(),n.appendChild(e),h.push(t);else{o.appendChild(e);const d=h.indexOf(t);d>-1&&h.splice(d,1),n.children.length===0&&(n.innerHTML=`<div class="drop-placeholder">${l("games.dragHere")}</div>`)}}function x(){const e=document.getElementById("sentenceFeedback"),t=document.getElementById("nextSentenceBtn"),n=document.getElementById("checkSentenceBtn"),o=document.getElementById("sentenceDropZone"),c=document.getElementById("sentenceScore");if(!o||!e)return;const d=Array.from(o.querySelectorAll(".sentence-word")).map(r=>r.textContent).join(" "),a=y.join(" ");if(d===a){const r=(Date.now()-I)/1e3,B=b(r,E);e.innerHTML=`‚úÖ ${l("games.perfect")} ${"‚≠ê".repeat(B)}`,e.className="game-feedback success",S++,c&&(c.textContent=String(S)),typeof k=="function"&&k("sentence",S),C(a,r),typeof s<"u"&&s&&s.speak(a,"sv"),t&&(t.style.display="block"),n&&(n.style.display="none")}else e.textContent=`‚ùå ${l("games.notQuite")}`,e.className="game-feedback error"}function N(){const e=document.getElementById("sentenceDropZone"),t=document.getElementById("sentenceWordBank"),n=document.getElementById("sentenceFeedback"),o=document.getElementById("nextSentenceBtn"),c=document.getElementById("checkSentenceBtn");!e||!t||!n||(E++,e.innerHTML="",t.innerHTML="",y.forEach(d=>{const a=document.createElement("span");a.className="sentence-word correct",a.textContent=d,e.appendChild(a)}),n.innerHTML=`üìñ ${l("games.correctOrder")}`,n.className="game-feedback",typeof s<"u"&&s&&s.speak(y.join(" "),"sv"),o&&(o.style.display="block"),c&&(c.style.display="none"))}let u=!1;function H(){if(u)return;if(typeof dictionaryData<"u"&&dictionaryData.length>0){console.log("[SentenceBuilder] Data already available, starting game..."),u=!0,p();return}let e=0;const t=50,n=setInterval(()=>{if(u){clearInterval(n);return}e++,typeof dictionaryData<"u"&&dictionaryData.length>0?(console.log("[SentenceBuilder] Data found via polling, starting game..."),clearInterval(n),u=!0,p()):e>=t&&(console.error("[SentenceBuilder] Timeout waiting for dictionary data"),clearInterval(n),g(l("common.error"),"error"))},100);console.log("[SentenceBuilder] Waiting for dictionaryLoaded event..."),window.addEventListener("dictionaryLoaded",()=>{u||(console.log("[SentenceBuilder] dictionaryLoaded event received, starting game..."),clearInterval(n),u=!0,p())},{once:!0})}document.addEventListener("DOMContentLoaded",()=>{v();const e=document.getElementById("nextSentenceBtn");e&&(e.onclick=()=>p()),H()});window.startSentenceGame=p;window.showSentenceAnswer=N;
