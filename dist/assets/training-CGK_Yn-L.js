import"./modulepreload-polyfill-B5Qt9EMX.js";import"./config-8gd_ljfe.js";import{r as c,j as t,c as O,R as q}from"./client-Chk-tuEE.js";import{DictionaryDB as g,DataLoader as B}from"./db-D9nATt-F.js";import{T as G}from"./tts-D1JXvOqA.js";import{ThemeManager as $}from"./utils-5O7zxelZ.js";import{L as X}from"./i18n-BpwFYk4h.js";import"./toast-manager-DdtDDR9Z.js";var E=(e=>(e[e.Again=0]="Again",e[e.Hard=3]="Hard",e[e.Good=4]="Good",e[e.Easy=5]="Easy",e))(E||{});const R={nextReview:Date.now(),interval:0,easeFactor:2.5,repetitions:0};function _(e,a=R){const{easeFactor:n,interval:d,repetitions:w}=a,h=Math.max(0,Math.min(5,Math.round(e)));let o,m,f;h<3?(o=1,f=0,m=Math.max(1.3,n-.2)):(f=w+1,m=n+(.1-(5-h)*(.08+(5-h)*.02)),m=Math.max(1.3,m),f===1?o=1:f===2?o=6:o=Math.round(d*m),h===5&&(o=Math.round(o*1.3))),o=Math.min(365,o);const N=Date.now();return{newData:{nextReview:N+o*24*60*60*1e3,interval:o,easeFactor:Math.round(m*100)/100,repetitions:f,lastReview:N},wasCorrect:h>=3}}const K=[{quality:0,label:"Igen / Ù…Ø±Ø© Ø£Ø®Ø±Ù‰",color:"#ef4444",icon:"ðŸ”„"},{quality:3,label:"SvÃ¥rt / ØµØ¹Ø¨",color:"#f97316",icon:"ðŸ˜“"},{quality:4,label:"Bra / Ø¬ÙŠØ¯",color:"#22c55e",icon:"ðŸ‘"},{quality:5,label:"Klar / ØªÙ…",color:"#3b82f6",icon:"ðŸ—‘ï¸"}],H=()=>{const[e,a]=c.useState([]),[n,d]=c.useState(0),[w,h]=c.useState(!1),[o,m]=c.useState(!0),[f,N]=c.useState(!1),[b,T]=c.useState(null),[p,M]=c.useState({wordsReviewed:0,correctCount:0,startTime:Date.now()}),L=c.useRef(0),I=c.useRef(0),v=c.useRef(null);c.useEffect(()=>{W(),setTimeout(()=>N(!0),100)},[]);const W=async()=>{m(!0);try{await g.hasCachedData()||await B.loadDictionary();const r=await g.getTrainingWordsDue(),l=s=>Array.isArray(s)?{id:s[0],swe:s[2],arb:s[3],type:s[1],sweDef:s[5],sweEx:s[7],arbEx:s[8]}:{id:s.id,swe:s.swe||s.swedish,arb:s.arb||s.arabic,type:s.type,sweDef:s.sweDef,sweEx:s.sweEx,arbEx:s.arbEx};let x=r.map(l);x.some(s=>!s.swe||!s.arb)&&(await B.refreshCache(),x=(await g.getTrainingWordsDue()).map(l));const y=x.filter(s=>s.swe&&s.arb);a(y)}catch(r){console.error("Failed to load training words",r)}finally{m(!1)}},i=e[n],k=()=>{if(!i)return;G.speak(i.swe);const r=parseInt(localStorage.getItem("ttsUsage")||"0",10);localStorage.setItem("ttsUsage",(r+1).toString())},A=()=>{h(!w),k()},S=async r=>{if(!i)return;const x=await g.getReviewData(i.id)||R,{newData:D,wasCorrect:y}=_(r,x);if(r===E.Easy){await g.updateTrainingStatus(i.id,!1);const s=JSON.parse(localStorage.getItem("wordAssessments")||"{}");s[i.id]={id:i.id,level:5,timestamp:Date.now()},localStorage.setItem("wordAssessments",JSON.stringify(s))}else await g.updateReviewData(i.id,D);M(s=>({...s,wordsReviewed:s.wordsReviewed+1,correctCount:s.correctCount+(y?1:0)})),T(y?"right":"left"),"vibrate"in navigator&&navigator.vibrate(y?50:[50,30,50]),setTimeout(()=>{if(T(null),h(!1),r===E.Again)a(s=>{const j=[...s],[F]=j.splice(n,1);return j.push(F),j});else{const s=e.filter(j=>j.id!==i.id);a(s),n>=s.length&&d(Math.max(0,s.length-1))}},300)},C=r=>{L.current=r.touches[0].clientX},P=r=>{if(I.current=r.touches[0].clientX,v.current&&w){const l=I.current-L.current;v.current.style.transform=`translateX(${l*.3}px) rotateY(180deg)`}},U=()=>{if(!w)return;const r=I.current-L.current,l=80;v.current&&(v.current.style.transform=""),r>l?S(E.Good):r<-l&&S(E.Again)};return c.useEffect(()=>()=>{p.wordsReviewed>0&&g.saveTrainingSession({date:new Date().toISOString().split("T")[0],wordsReviewed:p.wordsReviewed,correctCount:p.correctCount,timeSpentMs:Date.now()-p.startTime})},[p]),o?t.jsxs("div",{className:"training-loading",children:[t.jsx("div",{className:"loading-spinner"}),t.jsx("p",{className:"text-loading",children:"Laddar..."})]}):e.length===0?t.jsx(J,{stats:p}):t.jsxs("div",{className:`training-container transition-opacity duration-700 ${f?"opacity-100":"opacity-0"}`,children:[t.jsxs("div",{className:"training-header",children:[t.jsx("button",{className:"training-back-btn",onClick:()=>window.location.href="/","aria-label":"Tillbaka / Ø±Ø¬ÙˆØ¹",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),t.jsx("polyline",{points:"12 19 5 12 12 5"})]})}),t.jsxs("div",{className:"training-counter",children:[t.jsx("span",{children:"Kvar:"}),t.jsx("span",{className:"counter-label",children:e.length})]}),t.jsxs("div",{className:"training-counter mastered-counter",children:[t.jsx("span",{children:"ðŸ“Š"}),t.jsx("span",{className:"counter-label mastered-val",children:p.wordsReviewed>0?`${Math.round(p.correctCount/p.wordsReviewed*100)}%`:"0%"})]})]}),t.jsx("div",{className:`training-card ${w?"flipped":""} ${b?`swipe-${b}`:""}`,onClick:A,onTouchStart:C,onTouchMove:P,onTouchEnd:U,children:t.jsxs("div",{className:"card-inner",ref:v,children:[t.jsxs("div",{className:"card-face card-front",children:[i.type&&t.jsx("div",{className:"card-type",children:i.type}),t.jsx("h2",{className:"card-word",children:i.swe})]}),t.jsxs("div",{className:"card-face card-back",children:[t.jsx("h2",{className:"card-arabic",dir:"rtl",children:i.arb}),t.jsx("div",{className:"divider"}),t.jsxs("div",{className:"card-section",children:[i.sweDef&&t.jsx("div",{className:"card-definition",children:i.sweDef}),i.sweEx&&t.jsxs("div",{className:"card-example-container",children:[t.jsxs("p",{className:"card-example-swe",children:['"',i.sweEx,'"']}),i.arbEx&&t.jsx("p",{className:"card-example",dir:"rtl",children:i.arbEx})]})]})]})]})}),t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginTop:"1rem",marginBottom:"1.5rem",width:"100%",whiteSpace:"nowrap",color:"rgba(255, 255, 255, 0.7)",fontSize:"0.9rem",padding:"0 1rem"},children:"ðŸ‘† Tryck fÃ¶r att vÃ¤nda â€¢ Ø§Ø¶ØºØ· Ù„Ù„Ù‚Ù„Ø¨"}),t.jsx("div",{className:"training-controls sm2-controls",children:K.map(r=>t.jsxs("button",{onClick:l=>{l.stopPropagation(),S(r.quality)},className:`training-btn sm2-btn quality-${r.quality}`,style:{"--btn-color":r.color},children:[t.jsx("span",{className:"btn-icon",children:r.icon}),t.jsx("span",{className:"btn-label",children:r.label.split(" / ")[0]})]},r.quality))})]})},J=({stats:e})=>{const a=e.wordsReviewed>0?Math.round(e.correctCount/e.wordsReviewed*100):0,n=Math.round((Date.now()-e.startTime)/6e4);return t.jsxs("div",{className:"training-state complete",children:[t.jsx("div",{className:"state-emoji",children:"ðŸŽ‰"}),t.jsx("h2",{className:"text-white",children:"TrÃ¤ning Klar!"}),t.jsx("p",{children:"Grymt jobbat! Du har repeterat alla ord som behÃ¶vdes idag."}),t.jsxs("div",{className:"stats-grid",children:[t.jsxs("div",{className:"stat-item",children:[t.jsx("span",{className:"stat-value",children:e.wordsReviewed}),t.jsx("span",{className:"stat-label",children:"Ord repeterade"})]}),t.jsxs("div",{className:"stat-item",children:[t.jsxs("span",{className:"stat-value",children:[a,"%"]}),t.jsx("span",{className:"stat-label",children:"Precision"})]}),t.jsxs("div",{className:"stat-item",children:[t.jsxs("span",{className:"stat-value",children:[n,"m"]}),t.jsx("span",{className:"stat-label",children:"Tid"})]})]}),t.jsx("div",{className:"complete-actions",children:t.jsx("a",{href:"/",className:"training-btn primary",children:"Tillbaka Hem"})})]})};$.init();X.init();document.addEventListener("DOMContentLoaded",async()=>{const e=document.getElementById("training-root");if(!e){console.error("[TrainingApp] Mount point not found");return}O.createRoot(e).render(q.createElement(H)),console.log("[TrainingApp] Mounted successfully")});"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{const e=new URL("/assets/sw-BQj_SXJ1.ts",import.meta.url),a=await navigator.serviceWorker.register(e,{type:"module"});console.log("[PWA] ServiceWorker registered with URL:",e.href),a.addEventListener("updatefound",()=>{const n=a.installing;n&&(console.log("[PWA] New service worker installing..."),n.addEventListener("statechange",()=>{n.state==="installed"&&navigator.serviceWorker.controller&&Y()}))})}catch(e){console.log("[PWA] ServiceWorker registration failed:",e)}});function Y(){const e=document.getElementById("updatePrompt");if(e){e.classList.remove("hidden");const a=document.getElementById("updateBtn"),n=document.getElementById("dismissUpdate");a&&a.addEventListener("click",()=>{var d;(d=navigator.serviceWorker.controller)==null||d.postMessage({type:"SKIP_WAITING"}),window.location.reload()}),n&&n.addEventListener("click",()=>{e.classList.add("hidden")})}}window.addEventListener("online",()=>{const e=document.getElementById("offlineBanner");e&&e.classList.add("hidden")});window.addEventListener("offline",()=>{const e=document.getElementById("offlineBanner");e&&e.classList.remove("hidden")});if(!navigator.onLine){const e=document.getElementById("offlineBanner");e&&e.classList.remove("hidden")}let u=null;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),u=e;const a=document.getElementById("installApp"),n=document.getElementById("pwa-install-prompt");a&&(a.classList.remove("hidden"),a.addEventListener("click",async()=>{if(u){u.prompt();const{outcome:d}=await u.userChoice;console.log("[PWA] User response:",d),u=null,a.classList.add("hidden")}})),n&&!localStorage.getItem("pwa-prompt-dismissed")&&setTimeout(()=>{n.classList.remove("hidden")},5e3)});document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("pwa-install-btn"),a=document.getElementById("pwa-later-btn"),n=document.getElementById("pwa-install-prompt");e&&e.addEventListener("click",async()=>{if(u){u.prompt();const{outcome:d}=await u.userChoice;console.log("[PWA] Install prompt outcome:",d),u=null}n&&n.classList.add("hidden")}),a&&a.addEventListener("click",()=>{n&&n.classList.add("hidden"),localStorage.setItem("pwa-prompt-dismissed","true")})});const V=/iPad|iPhone|iPod/.test(navigator.userAgent),z=window.matchMedia("(display-mode: standalone)").matches||navigator.standalone;if(V&&!z){const e=document.getElementById("iosInstallPrompt");if(e&&!localStorage.getItem("ios-prompt-dismissed")){setTimeout(()=>{e.classList.remove("hidden"),setTimeout(()=>{e.style.transition="opacity 0.5s ease-out, transform 0.5s ease-out",e.style.opacity="0",e.style.transform="translateY(20px)",setTimeout(()=>{e.classList.add("hidden"),e.style.opacity="",e.style.transform="",e.style.transition=""},500)},15e3)},1e4);const a=document.getElementById("closeIosPrompt");a&&a.addEventListener("click",()=>{e.classList.add("hidden"),localStorage.setItem("ios-prompt-dismissed","true")})}}console.log("[PWA] Module loaded");
