var c=Object.defineProperty;var l=(a,t,s)=>t in a?c(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var r=(a,t,s)=>l(a,typeof t!="symbol"?t+"":t,s);import{showToast as o}from"./utils-4wWhGX49.js";class g{constructor(){r(this,"_favorites",new Set);r(this,"_listeners",[]);r(this,"STORAGE_KEY","favorites");this.load()}load(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(t){const s=JSON.parse(t);this._favorites=new Set(s),console.log(`[FavoritesManager] Loaded ${this._favorites.size} favorites`)}}catch(t){console.error("[FavoritesManager] Failed to load favorites:",t)}}save(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(Array.from(this._favorites)))}catch(t){console.error("[FavoritesManager] Failed to save favorites:",t)}}has(t){return this._favorites.has(t)}add(t){this._favorites.has(t)||(this._favorites.add(t),this.save(),this.notify(t,!0),o("Sparad i favoriter / ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…ÙØ¶Ù„Ø© â­"))}remove(t){this._favorites.has(t)&&(this._favorites.delete(t),this.save(),this.notify(t,!1),o("Borttagen frÃ¥n favoriter / ØªÙ… Ø§Ù„Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø© ðŸ—‘ï¸"))}toggle(t){return this.has(t)?(this.remove(t),!1):(this.add(t),!0)}getAll(){return Array.from(this._favorites)}count(){return this._favorites.size}filter(t){return t.filter(s=>this._favorites.has(s))}onChange(t){return this._listeners.push(t),()=>{this._listeners=this._listeners.filter(s=>s!==t)}}notify(t,s){this._listeners.forEach(e=>e(t,s))}updateButtonIcon(t,s){const e=s?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#ef4444" stroke="#ef4444" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>';t.innerHTML=e,t.classList.toggle("active",s)}}const S=new g;typeof window<"u"&&(window.FavoritesManager=S);class d{constructor(){r(this,"STORAGE_KEY","quizStats");r(this,"stats");r(this,"sessionCorrect",0);r(this,"sessionWrong",0);r(this,"sessionStreak",0);r(this,"sessionBestStreak",0);r(this,"sessionTimes",[]);r(this,"questionStartTime",0);this.stats=this.load(),this.checkDateReset()}load(){const t=localStorage.getItem(this.STORAGE_KEY);return t?JSON.parse(t):this.getDefaultStats()}getDefaultStats(){return{totalCorrect:0,totalWrong:0,bestStreak:0,currentStreak:0,totalQuizzes:0,todayCorrect:0,todayWrong:0,todayStudied:0,todayDate:new Date().toISOString().split("T")[0],weeklyCorrect:0,weeklyWrong:0,weekStart:this.getWeekStart(),avgResponseTime:0,fastestResponse:1/0,wordAttempts:{}}}getWeekStart(){const t=new Date,s=t.getDay(),e=t.getDate()-s+(s===0?-6:1);return new Date(t.setDate(e)).toISOString().split("T")[0]}checkDateReset(){const t=new Date().toISOString().split("T")[0];this.stats.todayDate!==t&&(this.stats.todayCorrect=0,this.stats.todayWrong=0,this.stats.todayStudied=0,this.stats.todayDate=t);const s=this.getWeekStart();this.stats.weekStart!==s&&(this.stats.weeklyCorrect=0,this.stats.weeklyWrong=0,this.stats.weekStart=s),this.save()}save(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.stats))}startQuestion(){this.questionStartTime=Date.now()}recordAnswer(t,s){const e=Date.now()-this.questionStartTime;this.sessionTimes.push(e),s?(this.stats.totalCorrect++,this.stats.todayCorrect++,this.stats.weeklyCorrect++,this.stats.currentStreak++,this.sessionCorrect++,this.sessionStreak++,this.stats.currentStreak>this.stats.bestStreak&&(this.stats.bestStreak=this.stats.currentStreak),this.sessionStreak>this.sessionBestStreak&&(this.sessionBestStreak=this.sessionStreak),e<this.stats.fastestResponse&&(this.stats.fastestResponse=e)):(this.stats.totalWrong++,this.stats.todayWrong++,this.stats.weeklyWrong++,this.stats.currentStreak=0,this.sessionWrong++,this.sessionStreak=0),this.stats.wordAttempts[t]||(this.stats.wordAttempts[t]={correct:0,wrong:0,lastSeen:Date.now()}),s?this.stats.wordAttempts[t].correct++:this.stats.wordAttempts[t].wrong++,this.stats.wordAttempts[t].lastSeen=Date.now();const i=this.sessionTimes;return this.stats.avgResponseTime=i.reduce((n,h)=>n+h,0)/i.length,this.save(),e}recordStudy(t){const s=new Date().toISOString().split("T")[0];this.stats.todayDate!==s&&this.checkDateReset(),this.stats.todayStudied++,this.stats.wordAttempts[t]?this.stats.wordAttempts[t].lastSeen=Date.now():this.stats.wordAttempts[t]={correct:0,wrong:0,lastSeen:Date.now()},this.save()}endSession(){this.stats.totalQuizzes++,this.save(),this.resetSession()}resetSession(){this.sessionCorrect=0,this.sessionWrong=0,this.sessionStreak=0,this.sessionBestStreak=0,this.sessionTimes=[]}getStats(){return{...this.stats}}getSessionStats(){return{correct:this.sessionCorrect,wrong:this.sessionWrong,streak:this.sessionStreak,bestStreak:this.sessionBestStreak,avgTime:this.sessionTimes.length>0?this.sessionTimes.reduce((t,s)=>t+s,0)/this.sessionTimes.length:0}}getTodayStats(){return{correct:this.stats.todayCorrect,wrong:this.stats.todayWrong,studied:this.stats.todayStudied||0,total:this.stats.todayCorrect+this.stats.todayWrong+(this.stats.todayStudied||0)}}getWeakWords(t=10){return Object.entries(this.stats.wordAttempts).filter(([e,i])=>i.wrong>i.correct).sort((e,i)=>i[1].wrong-i[1].correct-(e[1].wrong-e[1].correct)).slice(0,t).map(([e])=>e)}getAccuracy(){const t=this.stats.totalCorrect+this.stats.totalWrong;return t>0?Math.round(this.stats.totalCorrect/t*100):0}formatTime(t){return t===1/0||t===0?"-":(t/1e3).toFixed(1)+"s"}}const f=new d;typeof window<"u"&&(window.QuizStats=f);export{S as F,f as Q};
