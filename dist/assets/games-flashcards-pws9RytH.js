import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css              */import{s as l,a as $}from"./games-utils-BqIcxbKk.js";import"./loader-aeyOlNIl.js";import{T as k}from"./tts-CfZZetlp.js";import{TextSizeManager as W}from"./utils-5O7zxelZ.js";import"./config-BpQc0ceR.js";import"./i18n-BpwFYk4h.js";import"./toast-manager-DdtDDR9Z.js";import"./db-C5HhRm-y.js";console.log("flashcardsGame.ts LOADED - Professional Edition");let y=[],c=0,g=0,d=0,P=0,m={correct:0,wrong:0,totalTime:0},M=0,B=0,v=0,b=0,u=localStorage.getItem("fc_autoplay")!=="false";const I=0,G=1,D=2,K=3,j=7,q=8,f={STORAGE_KEY:"flashcard_leitner_data",BOX_INTERVALS:[1,3,7,14,30],getData(){try{return JSON.parse(localStorage.getItem(this.STORAGE_KEY)||"{}")}catch{return{}}},saveData(e){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))},getWordBox(e){var n;return((n=this.getData()[e])==null?void 0:n.box)||1},promoteWord(e){var a;const t=this.getData(),n=((a=t[e])==null?void 0:a.box)||1,o=Math.min(n+1,5);return t[e]={box:o,lastReview:Date.now(),nextReview:Date.now()+this.BOX_INTERVALS[o-1]*24*60*60*1e3},this.saveData(t),o},demoteWord(e){const t=this.getData();return t[e]={box:1,lastReview:Date.now(),nextReview:Date.now()+24*60*60*1e3},this.saveData(t),1},getBoxIcon(e){const t=["â„ï¸","ğŸŒ±","ğŸŒ¿","ğŸŒ³","ğŸ”¥"];return t[e-1]||t[0]},getDueWords(){const e=this.getData(),t=Date.now();return Object.entries(e).filter(([,n])=>n.nextReview<=t).map(([n])=>n)}};function Y(){const e=document.getElementById("flashcardsGame");if(!e)return;const t=["#3b82f6","#0ea5e9","#22c55e","#f59e0b","#ef4444"],n=50;for(let o=0;o<n;o++){const a=document.createElement("div");a.className="confetti-piece",a.style.cssText=`
            position: fixed;
            width: 10px;
            height: 10px;
            background: ${t[Math.floor(Math.random()*t.length)]};
            left: ${Math.random()*100}%;
            top: -10px;
            border-radius: ${Math.random()>.5?"50%":"2px"};
            animation: confettiFall ${2+Math.random()*2}s linear forwards;
            animation-delay: ${Math.random()*.5}s;
            z-index: 9999;
            pointer-events: none;
        `,e.appendChild(a),setTimeout(()=>a.remove(),2e3)}}function N(e=0){const t=document.getElementById("flashcardTypeFilter"),n=(t==null?void 0:t.value)||"all";if(typeof dictionaryData>"u"||!Array.isArray(dictionaryData)||dictionaryData.length===0){if(e<5)console.log(`Data not ready, retrying... (${e+1}/5)`),typeof l=="function"&&e===0&&l("Laddar data... / Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...","default"),setTimeout(()=>N(e+1),500);else{console.error("dictionaryData failed to load."),typeof l=="function"&&l("Kunde inte ladda data. Kontrollera din anslutning. / ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.","error");const o=document.getElementById("flashcardWord");o&&(o.innerHTML='<span style="color:red; font-size: 1rem;">Datafel / Error</span>')}return}try{let o=[...dictionaryData];if(n!=="all"&&(o=o.filter(i=>i?(i[G]||"").toLowerCase().includes(n):!1)),o=o.filter(i=>i&&i[D]&&i[D].length>0),o.length===0){console.warn("No words found for filter:",n),typeof l=="function"&&l("Inga ord hittades fÃ¶r detta filter.","error");return}o.sort((i,p)=>{const E=f.getWordBox(String(i[I])),w=f.getWordBox(String(p[I]));return E-w}),y=o.sort(()=>.5-Math.random()).slice(0,50),c=0,g=0,d=y.length,m={correct:0,wrong:0,totalTime:0};const a=document.getElementById("flashcardsGame");a&&a.style.display!=="block"&&(a.style.display="block"),A(0),V();const s=document.getElementById("flashcardProgress");s&&(s.textContent=`0/${d}`);const r=document.getElementById("flashcard");r&&r.classList.remove("flipped"),J(),F(),te(),console.log("Flashcards initialized successfully with",d,"cards.")}catch(o){console.error("Critical error starting Flashcards:",o),typeof l=="function"&&l("Ett fel uppstod. / Ø­Ø¯Ø« Ø®Ø·Ø£.","error")}}function V(){const e=document.getElementById("fcSegmentedProgress");if(e){e.innerHTML="";for(let t=0;t<d;t++){const n=document.createElement("div");n.className="fc-progress-segment",n.id=`fc-seg-${t}`,e.appendChild(n)}}}function C(e,t){const n=document.getElementById(`fc-seg-${e}`);n&&(document.querySelectorAll(".fc-progress-segment").forEach(o=>o.classList.remove("active")),t?(n.classList.add("completed"),n.classList.add(t)):n.classList.add("active"))}function A(e){const t=document.querySelector(".fc-progress-ring-circle");if(!t)return;const n=2*Math.PI*45,o=n-e/100*n;t.style.strokeDashoffset=String(o)}function J(){const e=document.getElementById("flashcard");e&&(e.addEventListener("touchstart",t=>{M=t.changedTouches[0].screenX,B=M,v=Date.now()},{passive:!0}),e.addEventListener("touchmove",t=>{B=t.changedTouches[0].screenX;const n=B-M;Math.abs(n)>30&&(e.style.transform=`translateX(${n*.3}px) rotate(${n*.02}deg)`,e.style.opacity=String(Math.max(.5,1-Math.abs(n)/500)))},{passive:!0}),e.addEventListener("touchend",()=>{const t=B-M,n=Date.now()-v;e.style.transform="",e.style.opacity="",Math.abs(t)>100?(typeof HapticManager<"u"&&HapticManager.trigger("medium"),t>0?L(4):L(0)):Math.abs(t)<30&&n<500&&O()}),e.addEventListener("click",()=>{Date.now()-b<300||v>0&&Date.now()-v<500||O()}))}function O(){if(Date.now()-b<300)return;b=Date.now();const e=document.getElementById("flashcard");e&&(e.classList.toggle("flipped"),typeof HapticManager<"u"&&HapticManager.trigger("selection"),typeof SoundManager<"u"&&SoundManager.play("flip"))}function F(){if(c>=y.length){ee();return}const e=y[c],t=e[D]||"",n=e[K]||"",o=e[j]||"",a=e[G]||"",s=String(e[I]),r=f.getWordBox(s);P=Date.now(),C(c,null);const i=document.getElementById("flashcardWord");i&&(i.textContent=t,typeof W<"u"&&W.apply(i,t,1,1.6));const p=document.getElementById("flashcardTranslation");p&&(p.textContent=n);const E=document.getElementById("flashcardMastery");E&&(E.innerHTML=`${f.getBoxIcon(r)} Box ${r}`);const w=document.getElementById("flashcardType");w&&(w.textContent=a);const T=document.getElementById("flashcard");T&&(r>=5?T.classList.add("shimmering"):T.classList.remove("shimmering"));const R=document.getElementById("flashcardBackWord");R&&(R.textContent=t);const S=document.getElementById("flashcardBackSentence");S&&(o?(S.textContent=o,S.style.display="block"):S.style.display="none");const H=e[q]||"",x=document.getElementById("flashcardExampleArb");x&&(H?(x.textContent=H,x.style.display="block"):x.style.display="none");const z=c/d*100;A(z);const _=document.getElementById("flashcardProgress");_&&(_.textContent=`${c+1}/${d}`);const h=document.getElementById("flashcard");h&&(h.classList.remove("flipped"),h.classList.remove("swiping-left","swiping-right","slide-out-right","slide-out-left"),h.style.transform="",h.style.opacity=""),setTimeout(()=>{typeof k<"u"&&u&&k.speak(t,"sv")},500),setTimeout(Q,50)}function Q(){const e=document.querySelector(".fc-front-pro"),t=document.querySelector(".fc-back-pro"),n=document.getElementById("flashcard");if(!e||!t||!n)return;const o=e.scrollHeight,a=t.scrollHeight,s=Math.max(o,a,320);n.style.height=`${s}px`}function U(){u=!u,localStorage.setItem("fc_autoplay",String(u)),X(),typeof l=="function"&&l(u?"Auto-play: PÃ… ğŸ”Š":"Auto-play: AV ğŸ”‡")}function X(){const e=document.getElementById("fcAutoPlayToggle");e&&(e.textContent=u?"ğŸ”Š":"ğŸ”‡",e.classList.toggle("muted",!u))}function L(e){try{console.log("HandleRating CALLED with:",e),Z(e)}catch(t){console.error("CRITICAL ERROR in handleFlashcardRating:",t)}}function Z(e){const t=y[c];if(!t){console.error("No card found at index",c);return}const n=String(t[I]),o=Date.now()-P;if(m.totalTime+=o,e>=3?(f.promoteWord(n),g++,m.correct++,typeof HapticManager<"u"&&HapticManager.trigger("success"),typeof SoundManager<"u"&&SoundManager.play("success"),C(c,"correct"),f.getWordBox(n)):(f.demoteWord(n),m.wrong++,typeof HapticManager<"u"&&HapticManager.trigger("error"),typeof SoundManager<"u"&&SoundManager.play("error"),C(c,"wrong")),e===0&&typeof FavoritesManager<"u"){const s=String(n);FavoritesManager.isFavorite(s)||FavoritesManager.toggle(s)}const a=document.getElementById("flashcard");if(a){const s=a.classList.contains("flipped");let r="";s?r=e>=3?"slide-out-right":"slide-out-left":r=e>=3?"slide-out-right-front":"slide-out-left-front",a.classList.add(r),setTimeout(()=>{a.classList.remove("slide-out-right","slide-out-left","slide-out-right-front","slide-out-left-front"),c++,F()},300)}else c++,F()}function ee(){const e=Math.round(g/d*100),t=Math.round(m.totalTime/d/1e3);e>=70&&(Y(),typeof HapticManager<"u"&&HapticManager.trigger("success"),typeof SoundManager<"u"&&SoundManager.play("success"));const n=document.getElementById("flashcard");n&&(n.classList.remove("flipped"),n.onclick=null);const o=document.getElementById("flashcardWord");o&&(o.innerHTML=`
            <span style="font-size: 3rem;">${e>=80?"ğŸ†":e>=60?"ğŸ‘":"ğŸ’ª"}</span>
            <div style="font-size: 2.5rem; font-weight: 700; margin-top: 0.5rem;">${e}%</div>
        `);const a=document.getElementById("flashcardTranslation");a&&(a.innerHTML=`
            <div style="margin-bottom: 1rem;">Du kunde ${g} av ${d} ord!</div>
            <div style="display: flex; gap: 1rem; justify-content: center; font-size: 0.9rem;">
                <span>âœ… ${m.correct}</span>
                <span>âŒ ${m.wrong}</span>
                <span>â±ï¸ ${t}s/kort</span>
            </div>
        `);const s=document.getElementById("flashcardExample");s&&(s.innerHTML=`
            <div style="margin-top: 1rem; display: flex; gap: 0.5rem; justify-content: center;">
                <button onclick="initFlashcards()" class="fc-action-btn">ğŸ”„ Igen</button>
                <button onclick="showGameMenu()" class="fc-action-btn secondary">ğŸ  Meny</button>
            </div>
        `,s.style.display="block");const r=document.getElementById("flashcardRatingBtns");r&&(r.style.display="none"),A(100),typeof $=="function"&&$("flashcards",g),typeof updateGamesStats=="function"&&updateGamesStats(e>=70,g),ne()}function te(){const e=document.getElementById("flashcardsGame");e&&window.innerWidth<768&&e.classList.add("fullscreen-mode")}function ne(){const e=document.getElementById("flashcardsGame");e&&e.classList.remove("fullscreen-mode")}document.addEventListener("DOMContentLoaded",X);window.initFlashcards=N;window.handleFlashcardResult=L;window.handleFlashcardRating=L;window.LeitnerSystem=f;window.toggleAutoPlay=U;
