var l=Object.defineProperty;var d=(n,e,t)=>e in n?l(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var c=(n,e,t)=>d(n,typeof e!="symbol"?e+"":e,t);import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css                            */import{A as o}from"./config-8gd_ljfe.js";import{DictionaryDB as i}from"./db-CUAitF01.js";class p{constructor(){c(this,"tipInterval",null);this.init()}async init(){this.startSplashUI();const t=new URLSearchParams(window.location.search).has("test_mode")?2e3:15e3;setTimeout(()=>{console.warn(`[Welcome] Timeout reached (${t}ms). Forcing redirect...`),localStorage.setItem("snabbaLexin_dataReady","true"),localStorage.setItem("snabbaLexin_version",o.DATA_VERSION),this.redirectToApp()},t);try{console.log("[Welcome] Initializing DB..."),await i.init();const a=localStorage.getItem("snabbaLexin_dataReady")==="true",s=localStorage.getItem("snabbaLexin_version");if(a&&s===o.DATA_VERSION&&await i.hasCachedData()){console.log("[Welcome] Data valid, redirecting to app..."),this.redirectToApp();return}await this.fetchData()}catch(a){console.error("[Welcome] Init failed:",a),this.updateProgress(0,"Fel vid start / خطأ في البدء")}}redirectToApp(){const t=new URLSearchParams(window.location.search).get("redirect");t&&(t.startsWith("/")||t.startsWith("http"))?window.location.replace(decodeURIComponent(t)):window.location.replace("index.html")}startSplashUI(){console.log("[Welcome] UI started"),this.updateProgress(10,"Ansluter... / جاري الاتصال...");const e=o.LOADING_TIPS,t=document.getElementById("splashTip");t&&(t.textContent=e[0],this.tipInterval&&clearInterval(this.tipInterval),this.tipInterval=setInterval(()=>{t.style.opacity="0",setTimeout(()=>{const a=Math.floor(Math.random()*e.length);t.textContent=e[a],t.style.opacity="1"},500)},o.SPLASH.TIP_ROTATION_INTERVAL))}updateProgress(e,t){const a=document.getElementById("splashProgressBar"),s=document.getElementById("splashPercent"),r=document.getElementById("splashStatus");a&&(a.style.width=`${e}%`),s&&(s.textContent=`${Math.round(e)}%`),r&&t&&(r.textContent=t)}async fetchData(){return new Promise((e,t)=>{const a=new XMLHttpRequest;a.open("GET",o.DATA_PATH.root,!0),a.onprogress=s=>{if(s.lengthComputable){let r=s.loaded/s.total*100;r=Math.min(90,r),this.updateProgress(r,"Laddar data... / جاري التحميل...")}},a.onload=async()=>{if(a.status===200){this.updateProgress(90,"Bearbetar... / جاري المعالجة...");try{const s=JSON.parse(a.responseText);await this.processData(s),e()}catch(s){console.error("[Welcome] JSON Parse error",s),this.updateProgress(100,"Fel vid data / خطأ في البيانات"),t(s)}}else t(new Error(`HTTP ${a.status}`))},a.onerror=()=>t(new Error("Network Error")),a.send()})}async processData(e){try{await i.saveWords(e,t=>{this.updateProgress(90+t*.1,"Sparar data... / جاري الحفظ...")}),await i.setDataVersion(o.DATA_VERSION),localStorage.setItem("snabbaLexin_dataReady","true"),localStorage.setItem("snabbaLexin_version",o.DATA_VERSION),this.updateProgress(100,"Klar! / تم!"),setTimeout(()=>this.redirectToApp(),500)}catch(t){throw console.error("[Welcome] Save failed:",t),this.updateProgress(100,"Kunde inte spara / تعذر الحفظ"),t}}}new p;
