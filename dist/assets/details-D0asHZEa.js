var pt=Object.defineProperty;var ut=(u,t,e)=>t in u?pt(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var g=(u,t,e)=>ut(u,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";import{T as Z}from"./type-color-system-DXTL0M2t.js";import"./config-8gd_ljfe.js";import{DictionaryDB as E}from"./db-D9nATt-F.js";import{TextSizeManager as X,showToast as I,ThemeManager as ht}from"./utils-5O7zxelZ.js";import{T as R}from"./tts-D1JXvOqA.js";import{Q as it,F as U}from"./quiz-stats-CpWuYj6M.js";import{t as F,L as tt,a as Y}from"./i18n-BpwFYk4h.js";import{A as gt,P as rt,H as O,M as mt}from"./ui-enhancements-BcplSgJk.js";import"./pwa-Bn3RWWLO.js";import"./toast-manager-DdtDDR9Z.js";class ct{static spawn(t,e){for(let a=0;a<15;a++){const n=document.createElement("div");n.innerHTML="â¤ï¸",n.className="heart-particle";const i=(Math.random()-.5)*100;n.style.left=t+"px",n.style.top=e+"px",n.style.setProperty("--tx",`${i}px`);const r=.5+Math.random()*1;n.style.transform=`scale(${r})`,document.body.appendChild(n),setTimeout(()=>n.remove(),1e3)}}}class Q{static process(t){return t?t.replace(/([a-zÃ¥Ã¤Ã¶A-ZÃ…Ã„Ã–]{4,})/g,e=>`<span class="smart-link" data-word="${e.toLowerCase()}">${e}</span>`):""}static setupListeners(t){t.querySelectorAll(".smart-link").forEach(e=>{e.addEventListener("click",async s=>{const a=s.currentTarget.dataset.word;if(a){const n=window.dictionaryData;let i=n==null?void 0:n.find(r=>r[2].toLowerCase()===a);if(!i)try{const r=await E.getAllWords();i=r==null?void 0:r.find(d=>d[2].toLowerCase()===a)}catch(r){console.warn("[SmartLink] DB fallback fail:",r)}i?window.location.href=`details.html?id=${i[0]}`:window.location.href=`index.html?s=${a}`}})})}}class ot{static async init(t){const e=document.getElementById("wordNotes"),s=document.getElementById("saveNotesBtn"),a=document.getElementById("notesStatus");if(!e||!s)return;const n=await E.getNote(t);n&&(e.value=n),s.onclick=async()=>{const i=e.value.trim();s.disabled=!0,a&&(a.innerHTML=`<span class="sv-text">${F("details.saving")}</span><span class="ar-text">${F("details.saving")}</span>`);const r=await E.saveNote(t,i);s.disabled=!1,a&&(a.innerHTML=r?`<span class="sv-text">${F("details.saved")}</span><span class="ar-text">${F("details.saved")}</span>`:`<span class="sv-text">${F("common.error")}</span><span class="ar-text">${F("common.error")}</span>`,setTimeout(()=>{a.innerHTML=""},3e3))}}}const ft=[{patter:/sj|stj|skj/i,tip:{sv:"Sj-ljudet: Forma lÃ¤pparna som om du ska vissla och blÃ¥s ut.",ar:"ØµÙˆØª Ø§Ù„Ù€ Sj: Ø´ÙƒÙ„ Ø´ÙØ§Ù‡Ùƒ ÙƒØ£Ù†Ùƒ Ø³ØªØµÙØ± ÙˆØ§Ø®Ø±Ø¬ Ø§Ù„Ù‡ÙˆØ§Ø¡ (ØµÙˆØª ÙŠØ´Ø¨Ù‡ Ø§Ù„Ø¹Ø·Ø³ Ø§Ù„Ø®ÙÙŠÙ)."},example:"sju, stjÃ¤rna, skjorta"},{patter:/Ã¶/i,tip:{sv:"Ã–: Som 'i' men med runda lÃ¤ppar. TÃ¤nk pÃ¥ 'hurt' pÃ¥ engelska.",ar:"Ø­Ø±Ù Ã–: ÙŠØ´Ø¨Ù‡ ØµÙˆØª Ø­Ø±Ù 'i' ÙˆÙ„ÙƒÙ† Ù…Ø¹ ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø´ÙØ§Ù‡ (Ù…Ø«Ù„ ØµÙˆØª ÙƒÙ„Ù…Ø© hurt Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©)."},example:"Ã¶ga, dÃ¶rr"},{patter:/y/i,tip:{sv:"Y: Som 'i' men med lÃ¤pparna lÃ¥ngt framÃ¥t.",ar:"Ø­Ø±Ù Y: Ø§Ù†Ø·Ù‚ Ø­Ø±Ù 'i' ÙˆÙ„ÙƒÙ† Ù…Ø¹ Ø¯ÙØ¹ Ø§Ù„Ø´ÙØªÙŠÙ† Ù„Ù„Ø£Ù…Ø§Ù… Ø¨Ø­Ø¯Ø©."},example:"ny, lyssna"},{patter:/r/i,tip:{sv:"R: Rullande r i bÃ¶rjan av ord, men mjukare efter vokal.",ar:"Ø­Ø±Ù R: ÙŠÙƒÙˆÙ† 'Ù…Ø±ÙØ±ÙØ§Ù‹' ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙƒÙ„Ù…Ø§ØªØŒ ÙˆÙŠØµØ¨Ø­ Ù†Ø§Ø¹Ù…Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ Ø¥Ø°Ø§ Ø¬Ø§Ø¡ Ø¨Ø¹Ø¯ Ø­Ø±Ù Ø¹Ù„Ø©."},example:"rÃ¶d, barn"}],et={splitIntoSyllables(u){if(!u)return[];const t="aeiouyÃ¥Ã¤Ã¶AEIOUYÃ…Ã„Ã–",e=[];for(let n=0;n<u.length;n++)t.includes(u[n])&&e.push(n);if(e.length<=1)return[u];const s=[];let a=0;for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1],o=u.substring(i+1,r).length;let l=0;o===0||o===1?l=1:l=2;const c=i+l;s.push(u.substring(a,c)),a=c}return s.push(u.substring(a)),s},getTipsForWord(u){return ft.filter(t=>t.patter.test(u))}};typeof window<"u"&&(window.PronunciationHelper=et);class q{static init(t){this.currentWord=t;try{this.visualizer||(this.visualizer=new gt("audioVisualizerContainer","#2dd4bf"),this.visualizer.setMode("liquid")),this.recorder||(this.recorder=new rt),this.setupEvents(),this.setupPracticeLevels(),this.renderStaticInfo(),this.initSpeechRecognition()}catch(e){console.warn("PronunciationLab init failed:",e)}}static setupPracticeLevels(){const t=document.getElementById("practiceLevelsContainer");t&&(t.innerHTML=`
            <div class="practice-levels">
                <button class="practice-level-btn active" data-level="listen">
                    <span class="practice-level-icon">ğŸ‘‚</span>
                    <span class="sv-text">Lyssna</span><span class="ar-text">Ø§Ø³ØªÙ…Ø¹</span>
                </button>
                <button class="practice-level-btn" data-level="repeat">
                    <span class="practice-level-icon">ğŸ”</span>
                    <span class="sv-text">Upprepa</span><span class="ar-text">ÙƒØ±Ø±</span>
                </button>
                <button class="practice-level-btn" data-level="challenge">
                    <span class="practice-level-icon">ğŸ¯</span>
                    <span class="sv-text">Utmaning</span><span class="ar-text">ØªØ­Ø¯ÙŠ</span>
                </button>
            </div>
        `,t.querySelectorAll(".practice-level-btn").forEach(e=>{e.addEventListener("click",()=>{t.querySelectorAll(".practice-level-btn").forEach(s=>s.classList.remove("active")),e.classList.add("active"),this.currentLevel=e.dataset.level,this.updateUIForLevel()})}))}static updateUIForLevel(){const t=document.getElementById("pronounceNormalBtn"),e=document.getElementById("recordingSection"),s=document.getElementById("modeInstruction");this.currentLevel==="listen"?(t==null||t.classList.remove("hidden"),e==null||e.classList.add("hidden"),s&&(s.innerHTML='<span class="sv-text">Lyssna noga pÃ¥ uttalet.</span><span class="ar-text">Ø§Ø³ØªÙ…Ø¹ Ø¬ÙŠØ¯Ø§Ù‹ Ù„Ù„Ù†Ø·Ù‚ Ø§Ù„ØµØ­ÙŠØ­.</span>')):this.currentLevel==="repeat"?(t==null||t.classList.remove("hidden"),e==null||e.classList.remove("hidden"),s&&(s.innerHTML='<span class="sv-text">Lyssna fÃ¶rst, spela sedan in.</span><span class="ar-text">Ø§Ø³ØªÙ…Ø¹ Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø«Ù… Ø³Ø¬Ù„ ØµÙˆØªÙƒ.</span>')):(t==null||t.classList.add("hidden"),e==null||e.classList.remove("hidden"),s&&(s.innerHTML='<span class="sv-text">Kan du ordet? Spela in direkt!</span><span class="ar-text">Ù‡Ù„ ØªØ¹Ø±Ù Ø§Ù„ÙƒÙ„Ù…Ø©ØŸ Ø³Ø¬Ù„Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©!</span>'))}static setupEvents(){const t=document.getElementById("pronounceNormalBtn"),e=document.getElementById("recordBtn"),s=document.getElementById("playRecordedBtn"),a=document.getElementById("ttsSpeedSlider"),n=document.getElementById("speedValue"),i=document.getElementById("speedValueAr");if(a){const c=R.getSpeed();a.value=c.toString(),n&&(n.textContent=`${c}x`),i&&(i.textContent=`${c}x`),a.addEventListener("input",p=>{const h=parseFloat(p.target.value);R.setSpeed(h),n&&(n.textContent=`${h}x`),i&&(i.textContent=`${h}x`)}),window.addEventListener("settings-changed",p=>{if(p.detail.key==="ttsSpeed"){const h=parseFloat(p.detail.value||"0.85");a.value=h.toString(),n&&(n.textContent=`${h}x`),i&&(i.textContent=`${h}x`)}})}t==null||t.addEventListener("click",()=>{O.light(),R.speakSwedish(this.currentWord)});const r=document.getElementById("repeatBtn"),d=document.getElementById("repeatCount");let o=!1,l=!1;r==null||r.addEventListener("click",async()=>{if(o){l=!0;return}O.medium();const c=(d==null?void 0:d.value)||"3",h=c==="infinite"?1/0:parseInt(c);o=!0,l=!1,r.classList.add("active");const v=r.innerHTML;r.innerHTML='â¹ï¸ <span class="sv-text">Stopp</span><span class="ar-text">Ø¥ÙŠÙ‚Ø§Ù</span>';let w=0;for(;w<h&&!l;)await new Promise(m=>{R.speakSwedish(this.currentWord);const x=()=>{window.removeEventListener("tts-end",x),setTimeout(m,800)};window.addEventListener("tts-end",x)}),w++;o=!1,l=!1,r.classList.remove("active"),r.innerHTML=v}),e==null||e.addEventListener("click",()=>this.toggleRecording()),s==null||s.addEventListener("click",async()=>{O.light();const c=this.lastRecordedBlob;c&&rt.playBlob(c)}),window.addEventListener("tts-start",()=>{var c,p;(c=this.visualizer)==null||c.start(),this.updateKaraokeActive(!0),(p=document.getElementById("audioVisualizerContainer"))==null||p.classList.add("active"),this.startSyllableHighlight()}),window.addEventListener("tts-end",()=>{var c,p;(c=this.visualizer)==null||c.stop(),this.updateKaraokeActive(!1),(p=document.getElementById("audioVisualizerContainer"))==null||p.classList.remove("active"),this.stopSyllableHighlight()}),window.addEventListener("tts-boundary",c=>{this.highlightWord(c.detail.word)})}static startSyllableHighlight(){const t=document.querySelectorAll(".syllable-chip");if(t.length===0)return;t.forEach(o=>o.classList.remove("active"));const e=this.currentWord.length,s=parseFloat(localStorage.getItem("ttsSpeed")||"0.85"),a=e*80/s,n=[];let i=0;t.forEach(o=>{const l=o.textContent||"",c=Math.max(1,l.length);i+=c,o._weight=c}),t.forEach((o,l)=>{const p=o._weight/i*a;n[l]=Math.max(200,p)});let r=0;const d=()=>{if(r>=t.length)return;r>0&&t[r-1].classList.remove("active"),t[r].classList.add("active");const l=n[r];r++,this.syllableInterval=setTimeout(d,l)};d()}static stopSyllableHighlight(){this.syllableInterval&&(clearTimeout(this.syllableInterval),this.syllableInterval=null),document.querySelectorAll(".syllable-chip").forEach(t=>t.classList.remove("active"))}static renderStaticInfo(){const t=document.getElementById("karaokeDisplay");t&&(t.innerHTML=this.currentWord.split(" ").map((a,n)=>`<span class="karaoke-word" data-word-index="${n}">${a}</span>`).join(" "),t.setAttribute("data-auto-size",""),t.setAttribute("data-max-lines","1"),setTimeout(()=>X.apply(t,this.currentWord,1,2.5),50));const e=document.getElementById("syllableDisplay");if(e){const a=et.splitIntoSyllables(this.currentWord);e.innerHTML=a.map(n=>`<span class="syllable-chip" data-auto-size data-max-lines="1">${n}</span>`).join(""),setTimeout(()=>X.applyToContainer(e),50)}const s=document.getElementById("phoneticTipsArea");if(s){const a=et.getTipsForWord(this.currentWord);s.innerHTML=a.map(n=>`
                <div class="tip-card">
                    <div class="tip-title">ğŸ’¡ <span class="sv-text">Tips</span><span class="ar-text">Ù†ØµÙŠØ­Ø©</span></div>
                    <div class="tip-text">${tt.getLanguage()==="sv"?n.tip.sv:n.tip.ar}</div>
                    <div class="tip-ex">Ex: ${n.example}</div>
                </div>
            `).join("")}}static highlightWord(t){const e=document.getElementById("karaokeDisplay");if(!e)return;e.querySelectorAll(".karaoke-word").forEach(a=>{var r;const n=(r=a.textContent)==null?void 0:r.toLowerCase().replace(/[.,!?;:]/g,""),i=t.toLowerCase().replace(/[.,!?;:]/g,"");n===i&&(a.classList.add("active"),setTimeout(()=>a.classList.remove("active"),800))})}static updateKaraokeActive(t){const e=document.getElementById("karaokeDisplay");e&&(t?e.classList.add("playing"):e.classList.remove("playing"))}static async toggleRecording(){var n,i,r,d,o,l;const t=document.getElementById("recordBtn"),e=document.getElementById("recordingFeedback"),s=document.getElementById("playbackArea"),a=document.querySelector(".pronunciation-lab-section");if(!this.isRecording)this.isRecording=!0,t==null||t.classList.add("active"),t.innerHTML='â¹ï¸ <span class="sv-text">Stoppa</span><span class="ar-text">Ø¥ÙŠÙ‚Ø§Ù</span>',e==null||e.classList.remove("hidden"),s==null||s.classList.add("hidden"),a==null||a.classList.add("recording"),(n=this.visualizer)==null||n.start(),(i=document.querySelector(".audio-visualizer-canvas"))==null||i.classList.add("recording"),await((r=this.recorder)==null?void 0:r.start()),this.startSpeechRecognition();else{this.isRecording=!1,t==null||t.classList.remove("active"),t.innerHTML='ğŸ™ï¸ <span class="sv-text">Spela in</span><span class="ar-text">ØªØ³Ø¬ÙŠÙ„</span>',e==null||e.classList.add("hidden"),a==null||a.classList.remove("recording"),(d=document.querySelector(".audio-visualizer-canvas"))==null||d.classList.remove("recording"),(o=this.visualizer)==null||o.stop();const c=await((l=this.recorder)==null?void 0:l.stop());this.lastRecordedBlob=c,s==null||s.classList.remove("hidden"),this.stopSpeechRecognition()}}static initSpeechRecognition(){const t=window.SpeechRecognition||window.webkitSpeechRecognition;t&&(this.recognition=new t,this.recognition.lang="sv-SE",this.recognition.interimResults=!1,this.recognition.maxAlternatives=1,this.recognition.onresult=e=>{const s=e.results[0][0].transcript.toLowerCase(),a=e.results[0][0].confidence;this.calculateScore(s,a)})}static startSpeechRecognition(){if(this.recognition)try{this.recognition.start()}catch{}}static stopSpeechRecognition(){if(this.recognition)try{this.recognition.stop()}catch{}}static calculateScore(t,e){const s=this.currentWord.toLowerCase();let a=0;t===s?a=Math.round(e*100):t.includes(s)||s.includes(t)?a=Math.round(e*80):a=Math.round(e*40);const n=document.getElementById("pronunciationScore"),i=document.getElementById("masteryBadgeContainer"),r=document.querySelector(".pronunciation-lab-section");n&&(n.innerHTML=`â­ <span class="sv-text">Resultat: ${a}%</span><span class="ar-text">Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${a}%</span>`,a>50&&(r==null||r.classList.add("success"),setTimeout(()=>r==null?void 0:r.classList.remove("success"),2e3)),a>80&&(O.success(),this.showGoldParticles()),i&&(i.innerHTML="",mt.renderBadge(a,i)))}static showGoldParticles(){const t=document.getElementById("audioVisualizerContainer");if(t)for(let e=0;e<15;e++){const s=document.createElement("div");s.className="gold-particle",s.style.left=`${Math.random()*100}%`,s.style.animationDelay=`${Math.random()*.5}s`,t.appendChild(s),setTimeout(()=>s.remove(),1500)}}}g(q,"visualizer",null),g(q,"recorder",null),g(q,"currentWord",""),g(q,"recognition",null),g(q,"currentLevel","listen"),g(q,"syllableInterval",null),g(q,"isRecording",!1);class st{static getEmoji(t){const e=t.toLowerCase();return this.emojiMap[e]?this.emojiMap[e]:null}static hasEmoji(t){return!!this.getEmoji(t)}}g(st,"emojiMap",{hund:"ğŸ¶",katt:"ğŸ±",fÃ¥gel:"ğŸ¦",hÃ¤st:"ğŸ´",ko:"ğŸ®",gris:"ğŸ·",fÃ¥r:"ğŸ‘",kanin:"ğŸ°",bjÃ¶rn:"ğŸ»",lejon:"ğŸ¦",tiger:"ğŸ¯",elefant:"ğŸ˜",apa:"ğŸµ",fisk:"ğŸŸ",val:"ğŸ‹",orm:"ğŸ",spindel:"ğŸ•·ï¸",bi:"ğŸ",fjÃ¤ril:"ğŸ¦‹",rÃ¤v:"ğŸ¦Š",Ã¤lg:"ğŸ«",varg:"ğŸº",mus:"ğŸ­",groda:"ğŸ¸",skÃ¶ldpadda:"ğŸ¢",sol:"â˜€ï¸",mÃ¥ne:"ğŸŒ™",stjÃ¤rna:"â­",moln:"â˜ï¸",regn:"ğŸŒ§ï¸",snÃ¶:"â„ï¸",eld:"ğŸ”¥",vatten:"ğŸ’§",trÃ¤d:"ğŸŒ³",blomma:"ğŸŒ¸",skog:"ğŸŒ²",berg:"ğŸ”ï¸",hav:"ğŸŒŠ",strand:"ğŸ–ï¸",Ã¶:"ğŸï¸",blad:"ğŸƒ",grÃ¤s:"ğŸŒ±",sten:"ğŸª¨",regnbÃ¥ge:"ğŸŒˆ",blixt:"âš¡",Ã¤pple:"ğŸ",banan:"ğŸŒ",pÃ¤ron:"ğŸ",apelsin:"ğŸŠ",citron:"ğŸ‹",druvor:"ğŸ‡",jordgubbe:"ğŸ“",tomat:"ğŸ…",potatis:"ğŸ¥”",morot:"ğŸ¥•",brÃ¶d:"ğŸ",kÃ¶tt:"ğŸ¥©",Ã¤gg:"ğŸ¥š",ost:"ğŸ§€",pizza:"ğŸ•",burgare:"ğŸ”",glass:"ğŸ¦",kaka:"ğŸ°",kaffe:"â˜•",mjÃ¶lk:"ğŸ¥›",ris:"ğŸš",sÃ¥s:"ğŸ¥£",kyckling:"ğŸ—",hus:"ğŸ ",bil:"ğŸš—",cykel:"ğŸš²",bÃ¥t:"â›µ",flygplan:"âœˆï¸",tÃ¥g:"ğŸš†",buss:"ğŸšŒ",dator:"ğŸ’»",telefon:"ğŸ“±",klocka:"âŒš",bok:"ğŸ“–",penna:"âœï¸",stol:"ğŸª‘",sÃ¤ng:"ğŸ›Œ",nyckel:"ğŸ”‘",vÃ¤ska:"ğŸ‘œ",glasÃ¶gon:"ğŸ‘“",hatt:"ğŸ©",skor:"ğŸ‘",klÃ¤der:"ğŸ‘•",dÃ¶rr:"ğŸšª",fÃ¶nster:"ğŸªŸ",bord:"5ï¸âƒ£",lampa:"ğŸ’¡",sax:"âœ‚ï¸",Ã¶ga:"ğŸ‘ï¸",Ã¶ra:"ğŸ‘‚",nÃ¤sa:"ğŸ‘ƒ",mun:"ğŸ‘„",hand:"âœ‹",fot:"ğŸ¦¶",hjÃ¤rta:"â¤ï¸",hjÃ¤rna:"ğŸ§ ",tand:"ğŸ¦·",hÃ¥r:"ğŸ’‡",lÃ¤kare:"ğŸ‘¨â€âš•ï¸",lÃ¤rare:"ğŸ§‘â€ğŸ«",polis:"ğŸ‘®",bebis:"ğŸ‘¶",kvinna:"ğŸ‘©",man:"ğŸ‘¨",flicka:"ğŸ‘§",pojke:"ğŸ‘¦",familj:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦",kung:"ğŸ‘‘"});class G{static getContext(){return this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.audioContext}static playCorrect(){const t=this.getContext(),e=t.createOscillator(),s=t.createGain();e.connect(s),s.connect(t.destination),e.frequency.setValueAtTime(523.25,t.currentTime),e.frequency.setValueAtTime(659.25,t.currentTime+.1),e.frequency.setValueAtTime(783.99,t.currentTime+.2),s.gain.setValueAtTime(.3,t.currentTime),s.gain.exponentialRampToValueAtTime(.01,t.currentTime+.4),e.start(t.currentTime),e.stop(t.currentTime+.4)}static playWrong(){const t=this.getContext(),e=t.createOscillator(),s=t.createGain();e.connect(s),s.connect(t.destination),e.type="sawtooth",e.frequency.setValueAtTime(200,t.currentTime),e.frequency.exponentialRampToValueAtTime(100,t.currentTime+.3),s.gain.setValueAtTime(.2,t.currentTime),s.gain.exponentialRampToValueAtTime(.01,t.currentTime+.3),e.start(t.currentTime),e.stop(t.currentTime+.3)}static playTick(){const t=this.getContext(),e=t.createOscillator(),s=t.createGain();e.connect(s),s.connect(t.destination),e.frequency.setValueAtTime(880,t.currentTime),s.gain.setValueAtTime(.1,t.currentTime),s.gain.exponentialRampToValueAtTime(.01,t.currentTime+.05),e.start(t.currentTime),e.stop(t.currentTime+.05)}}g(G,"audioContext",null);class K{static getKey(t){return`weak_${t}`}static recordWrong(t){const e=this.getWrongCount(t)+1;localStorage.setItem(this.getKey(t),e.toString())}static recordCorrect(t){const e=Math.max(0,this.getWrongCount(t)-1);localStorage.setItem(this.getKey(t),e.toString())}static getWrongCount(t){return parseInt(localStorage.getItem(this.getKey(t))||"0")}static isWeak(t){return this.getWrongCount(t)>=3}}class _{static getKey(t){return`mastery_${t}`}static getMastery(t){return parseInt(localStorage.getItem(this.getKey(t))||"0")}static updateMastery(t,e){let s=this.getMastery(t);return s+=e?20:-10,s=Math.max(0,Math.min(100,s)),localStorage.setItem(this.getKey(t),s.toString()),s}static getLastStudied(t){return localStorage.getItem(`lastStudied_${t}`)}static recordStudy(t){localStorage.setItem(`lastStudied_${t}`,new Date().toISOString())}static getTimeAgo(t){const e=this.getLastStudied(t);if(!e)return"";const s=Date.now()-new Date(e).getTime(),a=Math.floor(s/(1e3*60*60*24)),n=Math.floor(s/(1e3*60*60)),i=Math.floor(s/(1e3*60));return a>0?`<span class="sv-text">Studerad ${a} dagar sedan</span><span class="ar-text">Ø¯Ø±Ø³Øª Ù…Ù†Ø° ${a} Ø£ÙŠØ§Ù…</span>`:n>0?`<span class="sv-text">Studerad ${n} timmar sedan</span><span class="ar-text">Ø¯Ø±Ø³Øª Ù…Ù†Ø° ${n} Ø³Ø§Ø¹Ø§Øª</span>`:i>0?`<span class="sv-text">Studerad ${i} minuter sedan</span><span class="ar-text">Ø¯Ø±Ø³Øª Ù…Ù†Ø° ${i} Ø¯Ù‚Ø§Ø¦Ù‚</span>`:'<span class="sv-text">Nyligen</span><span class="ar-text">Ù…Ø¤Ø®Ø±Ø§Ù‹</span>'}static renderMasteryBar(t,e){const s=this.getMastery(t),a=this.getTimeAgo(t),n=K.isWeak(t),i=document.createElement("div");i.className="mastery-section",i.innerHTML=`
            <div class="mastery-header">
                <span class="mastery-label">
                    ğŸ“ˆ <span class="sv-text">BehÃ¤rskningsnivÃ¥</span><span class="ar-text">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¥ØªÙ‚Ø§Ù†</span>
                    ${n?'<span class="weak-badge">âš ï¸ <span class="sv-text">Svagt ord</span><span class="ar-text">ÙƒÙ„Ù…Ø© Ø¶Ø¹ÙŠÙØ©</span></span>':""}
                </span>
                <span class="mastery-percent">${s}%</span>
            </div>
            <div class="mastery-bar">
                <div class="mastery-progress" style="width: ${s}%"></div>
            </div>
            ${a?`<div class="last-studied">${a}</div>`:""}
        `,e.prepend(i),this.recordStudy(t)}}class j{static setDifficulty(t){this.difficulty=t}static adjustDifficulty(t){t?(this.consecutiveCorrect++,this.consecutiveCorrect>=3&&this.difficulty!=="hard"&&(this.setDifficulty(this.difficulty==="easy"?"medium":"hard"),this.consecutiveCorrect=0)):(this.consecutiveCorrect=0,this.difficulty!=="easy"&&this.setDifficulty(this.difficulty==="hard"?"medium":"easy"))}static getTimeLimit(){switch(this.difficulty){case"easy":return 15;case"medium":return 10;case"hard":return 5;default:return 10}}static getArabicFeatures(t){const e=t.startsWith("Ø§Ù„"),s=t.endsWith("Ø©"),a=t.includes("Ùˆ"),n=t.endsWith("ÙŠ")||t.endsWith("Ù‰"),i=t.endsWith("ÙˆÙ†")||t.endsWith("ÙŠÙ†")||t.endsWith("Ø§Øª"),r=t.split(" ").length;return{hasAl:e,hasTaa:s,hasWaw:a,hasYaa:n,hasPlural:i,wordCount:r,length:t.length}}static similarityScore(t,e){const s=this.getArabicFeatures(t),a=this.getArabicFeatures(e);let n=0;return s.hasAl===a.hasAl&&(n+=3),s.hasTaa===a.hasTaa&&(n+=2),s.hasPlural===a.hasPlural&&(n+=2),s.hasYaa===a.hasYaa&&(n+=1),s.wordCount===a.wordCount&&(n+=3),Math.abs(s.length-a.length)<=1&&(n+=4),Math.abs(s.length-a.length)===0&&(n+=3),t.charAt(0)===e.charAt(0)&&(n+=2),t.charAt(t.length-1)===e.charAt(e.length-1)&&(n+=2),n}static swedishSimilarityScore(t,e){let s=0;t.length===e.length?s+=10:Math.abs(t.length-e.length)===1&&(s+=5),t.charAt(0).toLowerCase()===e.charAt(0).toLowerCase()&&(s+=4),t.charAt(t.length-1)===e.charAt(e.length-1)&&(s+=3);const a=["ar","er","or","ning","tion","het","lig","isk"];for(const n of a)if(t.endsWith(n)&&e.endsWith(n)){s+=4;break}return t.substring(0,2).toLowerCase()===e.substring(0,2).toLowerCase()&&(s+=3),s}static getSmartDistractors(t,e,s=3){const a=t[1],n=t[3],i=[],r=new Set([n]),d=e.filter(o=>o[3]!==n&&o[1]===a).map(o=>({text:o[3],score:this.similarityScore(n,o[3])})).sort((o,l)=>l.score-o.score);for(const o of d){if(i.length>=s)break;r.has(o.text)||(i.push(o.text),r.add(o.text))}if(i.length<s)for(const o of e.sort(()=>Math.random()-.5)){if(i.length>=s)break;r.has(o[3])||(i.push(o[3]),r.add(o[3]))}return i}static getSwedishDistractors(t,e,s=3){const a=t[1],n=t[2],i=[],r=new Set([n]),d=e.filter(o=>o[2]!==n&&o[1]===a).map(o=>({text:o[2],score:this.swedishSimilarityScore(n,o[2])})).sort((o,l)=>l.score-o.score);for(const o of d){if(i.length>=s)break;r.has(o.text)||(i.push(o.text),r.add(o.text))}if(i.length<s)for(const o of e.sort(()=>Math.random()-.5)){if(i.length>=s)break;r.has(o[2])||(i.push(o[2]),r.add(o[2]))}return i}static getEasyDistractorsSv(t,e,s=3){return e.filter(a=>a[2]!==t).sort(()=>Math.random()-.5).slice(0,s).map(a=>a[2])}static init(t){const e=document.getElementById("miniQuizContainer"),s=document.getElementById("miniQuizQuestion"),a=document.getElementById("miniQuizOptions"),n=document.getElementById("miniQuizFeedback");if(!e||!s||!a||!n)return;const i=t[2],r=t[3],d=t[1],o=t[7]||"",l=window.dictionaryData,c=["Hus","Bil","Katt","Hund","Sol","Vatten","BrÃ¶d","Bok"],p=["Ø¨ÙŠØª","Ø³ÙŠØ§Ø±Ø©","Ù‚Ø·Ø©","ÙƒÙ„Ø¨","Ø´Ù…Ø³","Ù…Ø§Ø¡","Ø®Ø¨Ø²","ÙƒØªØ§Ø¨"],h=(f,b)=>(b?c:p).filter(L=>L!==f).sort(()=>Math.random()-.5).slice(0,3),v=i.substring(0,Math.min(4,i.length)).toLowerCase(),w=o&&o.length>10&&o.toLowerCase().includes(v),m=st.hasEmoji(i),x=[2,3];w&&x.push(1),m&&x.push(4);const $=x[Math.floor(Math.random()*x.length)];let W=[],M="",A="",C="",z="";if($===4&&m){const f=st.getEmoji(i);let b;this.difficulty==="easy"?b=this.getEasyDistractorsSv(i,l,3):b=l?this.getSwedishDistractors(t,l,3):h(i,!0),W=[...b,i].sort(()=>Math.random()-.5),M=i,A=`
                <div class="quiz-emoji-display">${f}</div>
                <div class="quiz-instruction"><span class="sv-text">Vilket ord passar bilden?</span><span class="ar-text">Ù…Ø§ Ù‡ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„ØµÙˆØ±Ø©ØŸ</span></div>
            `,C='<span class="sv-text">Bildquiz</span><span class="ar-text">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØ±</span>',z="ğŸ–¼ï¸"}else if($===1&&w){const f=o.replace(new RegExp(`\\b(${v}\\w*)\\b`,"gi"),"______");W=[...l?this.getSwedishDistractors(t,l,3):h(i,!0),i].sort(()=>Math.random()-.5),M=i,A=`
                <div class="quiz-sentence" dir="ltr">"${f}"</div>
                <div class="quiz-instruction"><span class="sv-text">VÃ¤lj rÃ¤tt ord</span><span class="ar-text">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</span></div>
            `,C='<span class="sv-text">Fyll i</span><span class="ar-text">Ø¥ÙƒÙ…Ø§Ù„</span>',z="ğŸ“"}else $===2?(W=[...l?this.getSwedishDistractors(t,l,3):h(i,!0),i].sort(()=>Math.random()-.5),M=i,A=`
                <div class="quiz-listen-container">
                    <button class="quiz-listen-btn" onclick="window.TTSManager.speak('${i}', 'sv')">
                        ğŸ”Š <span><span class="sv-text">${Y("btn.test","sv")}</span><span class="ar-text">${Y("btn.test","ar")}</span></span>
                    </button>
                </div>
                <div class="quiz-instruction"><span class="sv-text">Vilket ord hÃ¶rde du?</span><span class="ar-text">Ù…Ø§ Ù‡ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØªÙŠ Ø³Ù…Ø¹ØªÙ‡Ø§ØŸ</span></div>
            `,C='<span class="sv-text">Lyssna</span><span class="ar-text">Ø§Ø³ØªÙ…Ø§Ø¹</span>',z="ğŸ§",setTimeout(()=>R.speak(i,"sv"),500)):Math.random()<.5?(W=[...l?this.getSwedishDistractors(t,l,3):h(i,!0),i].sort(()=>Math.random()-.5),M=i,A=`
                    <span class="sv-text">Vad Ã¤r det svenska ordet fÃ¶r</span><span class="ar-text">Ù…Ø§ Ù‡ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø³ÙˆÙŠØ¯ÙŠØ© Ù„Ù€</span> 
                    <strong>"${r}"</strong>?`,C='<span class="sv-text">OmvÃ¤nd</span><span class="ar-text">Ø¹ÙƒØ³ÙŠ</span>',z="ğŸ”„"):(W=[...l?this.getSmartDistractors(t,l,3):h(r,!1),r].sort(()=>Math.random()-.5),M=r,A=`
                    <span class="sv-text">Vad betyder</span><span class="ar-text">Ù…Ø§ Ù…Ø¹Ù†Ù‰</span> 
                    <strong>"${i}"</strong>?`,C=`<span class="sv-text">${d}</span><span class="ar-text">${d}</span>`,z="ğŸ“–");const V=parseInt(localStorage.getItem("quizStreak")||"0"),N=parseInt(localStorage.getItem("quizXP")||"0");s.innerHTML=`
            <div class="quiz-header-row">
                <span class="quiz-word-type">${z} ${C}</span>
                <div class="quiz-stats">
                    <span class="quiz-xp">â­ ${N} XP</span>
                    ${V>0?`<span class="quiz-streak">ğŸ”¥ ${V}</span>`:""}
                </div>
            </div>
            <div class="quiz-timer-bar"><div class="quiz-timer-progress"></div></div>
            ${A}
        `,a.innerHTML=W.map(f=>`
            <button class="quiz-option" data-value="${f}">${f}</button>
        `).join("")+`
            <button class="quiz-hint-btn" id="quizHintBtn" ${N<5?"disabled":""}>
                ğŸ’¡ <span class="sv-text">LedtrÃ¥d</span><span class="ar-text">ØªÙ„Ù…ÙŠØ­</span>
                <span class="hint-cost">(-5 XP)</span>
            </button>
        `;const P=this.getTimeLimit();let S=P;const H=s.querySelector(".quiz-timer-progress"),y=setInterval(()=>{if(S--,H){const f=S/P*100;H.style.width=`${f}%`,f<30?H.style.background="#ef4444":f<60&&(H.style.background="#f59e0b")}S<=5&&S>0&&G.playTick(),S<=0&&(clearInterval(y),this.handleAnswer(a,n,"",M,t,!1))},1e3);a.querySelectorAll(".quiz-option").forEach(f=>{f.addEventListener("click",b=>{clearInterval(y);const B=b.currentTarget.dataset.value;this.handleAnswer(a,n,B,M,t,!0)})});const k=a.querySelector("#quizHintBtn");k&&k.addEventListener("click",()=>{let f=parseInt(localStorage.getItem("quizXP")||"0");if(f<5)return;f-=5,localStorage.setItem("quizXP",f.toString());const b=s.querySelector(".quiz-xp");b&&(b.textContent=`â­ ${f} XP`);const B=Array.from(a.querySelectorAll(".quiz-option:not(.disabled)")).filter(L=>L.dataset.value!==M);if(B.length>0){const L=B[Math.floor(Math.random()*B.length)];L.classList.add("eliminated"),L.style.opacity="0.3",L.style.pointerEvents="none",L.style.textDecoration="line-through"}k.disabled=!0,k.style.opacity="0.5"})}static handleAnswer(t,e,s,a,n,i){const r=s===a,d=n[0].toString();let o=parseInt(localStorage.getItem("quizStreak")||"0"),l=parseInt(localStorage.getItem("quizXP")||"0");r?(o++,l+=10+o*2,ct.spawn(window.innerWidth/2,window.innerHeight/2),G.playCorrect(),this.adjustDifficulty(!0)):(o=0,G.playWrong(),this.adjustDifficulty(!1)),localStorage.setItem("quizStreak",o.toString()),localStorage.setItem("quizXP",l.toString()),_.updateMastery(d,r),r?K.recordCorrect(d):K.recordWrong(d),t.querySelectorAll(".quiz-option").forEach(v=>{v.classList.add("disabled"),v.dataset.value===a?v.classList.add("correct"):v.dataset.value===s&&!r&&v.classList.add("wrong")});const c=i?"":`â° <span class="sv-text">${Y("details.timeUp","sv")}</span><span class="ar-text">${Y("details.timeUp","ar")}</span>`;e.classList.remove("hidden");const p=n[7]||"",h=p?`
            <div class="quiz-explanation">
                <div class="explanation-label">ğŸ“š <span class="sv-text">Exempel</span><span class="ar-text">Ù…Ø«Ø§Ù„</span>:</div>
                <div class="explanation-text" dir="ltr">"${p}"</div>
            </div>`:"";e.innerHTML=`
            <div class="feedback-content ${r?"correct":"wrong"}">
                <div class="feedback-icon">${r?"ğŸ‰":"âŒ"}</div>
                <div class="feedback-text">
                    ${r?'<span class="sv-text">RÃ¤tt svar!</span><span class="ar-text">Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!</span>':'<span class="sv-text">Fel svar!</span><span class="ar-text">Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©!</span>'}
                </div>
                ${c?`<div class="time-up-msg">${c}</div>`:""}
                ${h}
                <button class="next-quiz-btn" onclick="document.getElementById('miniQuizFeedback').classList.add('hidden'); MiniQuizManager.init(window.currentWordData || [])">
                    ${r?'<span class="sv-text">NÃ¤sta frÃ¥ga</span><span class="ar-text">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</span>':'<span class="sv-text">FÃ¶rsÃ¶k igen</span><span class="ar-text">Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</span>'} â¡ï¸
                </button>
            </div>
        `}}g(j,"difficulty","medium"),g(j,"consecutiveCorrect",0);class D{static init(t){const e=window.dictionaryData;if(!e||(this.currentWordIndex=e.findIndex(a=>a[0].toString()===t),this.currentWordIndex===-1))return;const s=document.getElementById("detailsArea");s&&(this.addSwipeHints(s),s.addEventListener("touchstart",a=>this.handleTouchStart(a),{passive:!0}),s.addEventListener("touchend",a=>this.handleTouchEnd(a),{passive:!0}))}static addSwipeHints(t){const e=document.createElement("div");e.className="swipe-hints",e.innerHTML=`
            <span class="swipe-hint left" onclick="window.SwipeNavigator.navigate(-1)"><span class="sv-text">â€¹ FÃ¶regÃ¥ende</span><span class="ar-text">â€¹ Ø§Ù„Ø³Ø§Ø¨Ù‚</span></span>
            <span class="swipe-hint right" onclick="window.SwipeNavigator.navigate(1)"><span class="sv-text">NÃ¤sta â€º</span><span class="ar-text">Ø§Ù„ØªØ§Ù„ÙŠ â€º</span></span>
        `,t.prepend(e)}static handleTouchStart(t){this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY}static handleTouchEnd(t){const e=t.changedTouches[0].clientX,s=t.changedTouches[0].clientY,a=e-this.startX,n=Math.abs(s-this.startY);Math.abs(a)>80&&n<50&&(a>0?this.navigate(-1):this.navigate(1))}static navigate(t){var a;const e=window.dictionaryData;if(!e||this.currentWordIndex===-1)return;const s=this.currentWordIndex+t;if(s>=0&&s<e.length){const n=e[s][0];(a=document.getElementById("detailsArea"))==null||a.classList.add(t>0?"slide-left":"slide-right"),setTimeout(()=>{window.location.href=`details.html?id=${n}`},150)}}}g(D,"startX",0),g(D,"startY",0),g(D,"currentWordIndex",-1);window.SwipeNavigator=D;class at{static async init(t){const e=document.getElementById("relatedWordsContainer");if(!e)return;const s=t[1],a=t[2];t[3],e.innerHTML='<div class="related-loading">â³ <span class="sv-text">Laddar...</span><span class="ar-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span></div>';let n=window.dictionaryData;if(!n)try{n=await E.getAllWords(),window.dictionaryData=n}catch(c){console.error("[RelatedWords] Failed to load data:",c),e.innerHTML=`<div class="related-empty">
                    <span class="sv-text">Kunde inte ladda relaterade ord</span>
                    <span class="ar-text">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø°Ø§Øª Ø§Ù„ØµÙ„Ø©</span>
                </div>`;return}if(!n||n.length===0){e.innerHTML=`<div class="related-empty">
                <span class="sv-text">Inga relaterade ord hittades</span>
                <span class="ar-text">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª Ø°Ø§Øª ØµÙ„Ø©</span>
            </div>`;return}const i=[],r=n.filter(c=>c[2]!==a&&(c[2].toLowerCase().includes(a.toLowerCase())||a.toLowerCase().includes(c[2].toLowerCase()))).slice(0,4);r.length>0&&i.push({label:"Sammansatta ord",labelAr:"ÙƒÙ„Ù…Ø§Øª Ù…Ø±ÙƒØ¨Ø©",icon:"ğŸ”—",words:r});const d=a.substring(0,Math.min(3,a.length)).toLowerCase(),o=n.filter(c=>c[2]!==a&&c[2].toLowerCase().startsWith(d)&&!r.includes(c)).slice(0,4);o.length>0&&i.push({label:"Liknande ord",labelAr:"ÙƒÙ„Ù…Ø§Øª Ù…Ø´Ø§Ø¨Ù‡Ø©",icon:"ğŸŒ±",words:o});const l=n.filter(c=>c[2]!==a&&c[1]===s&&!r.includes(c)&&!o.includes(c)).sort(()=>Math.random()-.5).slice(0,4);if(l.length>0){const c=window.TypeColorSystem,p=c?c.getColor(s):{label:{sv:s,ar:s}},h=`Andra ${p.label.sv.toLowerCase()}`,v=`${p.label.ar} Ø£Ø®Ø±Ù‰`;i.push({label:h,labelAr:v,icon:"ğŸ“š",words:l})}if(i.length===0||i.reduce((c,p)=>c+p.words.length,0)<3){const c=n.filter(p=>p[2]!==a).sort(()=>Math.random()-.5).slice(0,6);i.push({label:"UpptÃ¤ck ord",labelAr:"Ø§ÙƒØªØ´Ù ÙƒÙ„Ù…Ø§Øª",icon:"âœ¨",words:c})}e.innerHTML=i.map(c=>`
            <div class="related-category">
                <div class="related-category-header">
                    <span class="category-icon">${c.icon}</span>
                    <span class="sv-text">${c.label}</span>
                    <span class="ar-text">${c.labelAr}</span>
                </div>
                <div class="related-words-row">
                    ${c.words.map(p=>`
                        <div class="related-word-chip" onclick="window.location.href='details.html?id=${p[0]}'">
                            <span class="related-swe">${p[2]}</span>
                            <span class="related-arb">${p[3]}</span>
                        </div>
                    `).join("")}
                </div>
            </div>
        `).join("")}}class T{static getTextSizeClass(t){const e=t.length;return e<=8?"text-xl":e<=15?"text-lg":e<=25?"text-md":e<=40?"text-sm":"text-xs"}static showSuccessGlow(){const t=document.querySelector(".flashcard-clean");t&&(t.classList.add("fc-success-glow"),setTimeout(()=>t.classList.remove("fc-success-glow"),600))}static showErrorFlash(){const t=document.querySelector(".flashcard-clean");t&&(t.classList.add("fc-error-flash"),setTimeout(()=>t.classList.remove("fc-error-flash"),400))}static toggleFocus(){this.focusMode=!this.focusMode;const t=document.querySelector(".fc-card-area"),e=document.getElementById("fcStatsBar"),s=document.querySelector(".fc-minimal-header");this.focusMode?(t==null||t.classList.add("focus-mode"),e==null||e.classList.add("hidden"),s==null||s.classList.add("hidden"),I('ğŸ§˜ <span class="sv-text">FokuslÃ¤ge aktiverat</span><span class="ar-text">ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ù…ÙÙØ¹Ù‘Ù„</span>',{type:"info"})):(t==null||t.classList.remove("focus-mode"),e==null||e.classList.remove("hidden"),s==null||s.classList.remove("hidden"),I('<span class="sv-text">FokuslÃ¤ge avslutat</span><span class="ar-text">Ø§Ù†ØªÙ‡Ù‰ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²</span>'))}static playAudio(t){window.TTSManager&&window.TTSManager.speak(t,"sv")}static formatTime(t){const e=Math.floor(t/1e3),s=Math.floor(e/60),a=e%60;return`${s}:${a.toString().padStart(2,"0")}`}static getAccuracy(){return this.sessionStats.total===0?0:Math.round(this.sessionStats.correct/this.sessionStats.total*100)}static init(t){const e=document.getElementById("flashcardContainer");if(!e)return;this.currentWordData=t;const s=t[2],a=t[3],n=t[1],i=t[7]||"",r=t[6]||"",d=t[13]||"",o=window.TypeColorSystem,l=o?o.getGlowClass(n,s,r,d,a):"",c=this.getTextSizeClass(s),p=this.getTextSizeClass(a),h=this.currentMode==="reverse"?a:s;this.currentMode;const v=this.currentMode==="reverse"?"rtl":"ltr";this.currentMode,e.innerHTML=`
            <!-- Minimal Header: Mode + Focus Toggle -->
            <div class="fc-minimal-header">
                <div class="fc-mode-pills">
                    <button class="fc-pill ${this.currentMode==="normal"?"active":""}" onclick="FlashcardManager.setMode('normal')" title="Normal / Ø¹Ø§Ø¯ÙŠ">ğŸ‡¸ğŸ‡ª</button>
                    <button class="fc-pill ${this.currentMode==="reverse"?"active":""}" onclick="FlashcardManager.setMode('reverse')" title="OmvÃ¤nd / Ø¹ÙƒØ³ÙŠ">ğŸ”„</button>
                    <button class="fc-pill ${this.currentMode==="listening"?"active":""}" onclick="FlashcardManager.setMode('listening')" title="Lyssna / Ø§Ø³ØªÙ…Ø§Ø¹">ğŸ§</button>
                </div>
                <button class="fc-focus-toggle" onclick="FlashcardManager.toggleFocus()" title="FokuslÃ¤ge / ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²">
                    â›¶
                </button>
            </div>
            
            <!-- Collapsible Stats (hidden by default, show on hover/click) -->
            <div class="fc-stats-minimal" id="fcStatsBar">
                <span class="fc-mini-stat">ğŸ”¥<span id="fcStreak">${this.streak}</span></span>
                <span class="fc-mini-stat">â­<span id="fcXP">${this.xp}</span></span>
                <span class="fc-mini-stat">ğŸ¯<span id="fcAccuracy">${this.getAccuracy()}%</span></span>
            </div>
            
            <div class="fc-card-area ${this.focusMode?"focus-mode":""}">
                ${this.currentMode==="listening"?`
                    <!-- Listening Mode: Simple Design -->
                    <div class="fc-listen-simple">
                        <button class="fc-listen-circle" onclick="FlashcardManager.playAudio('${s}')">
                            ğŸ”Š
                        </button>
                        <div class="fc-listen-grid quiz-options">
                            ${this.generateListeningOptions(s)}
                        </div>
                    </div>
                `:`
                    <!-- Ultra Clean Flashcard -->
                    <div class="flashcard-clean ${l}" onclick="FlashcardManager.flip()">
                        <div class="flashcard-clean-inner">
                            <!-- Front: Word Only -->
                            <div class="flashcard-clean-front">
                                <div class="fc-front-word ${this.currentMode==="reverse"?p:c}" dir="${v}">${h}</div>
                            </div>
                            <!-- Back: Translation + Example -->
                            <div class="flashcard-clean-back">
                                <div class="fc-back-swe">${s}</div>
                                <div class="fc-back-divider"></div>
                                <div class="fc-back-arb">${a}</div>
                                ${i?`<div class="fc-back-example">"${i}"</div>`:""}
                            </div>
                        </div>
                        <!-- Audio: Appears on hover/tap -->
                        <button class="fc-audio-float" onclick="event.stopPropagation(); FlashcardManager.playAudio('${s}')">ğŸ”Š</button>
                    </div>
                `}
                
                <!-- Icon-Only Rating Buttons -->
                <div class="fc-actions-simple">
                    <button class="fc-action-btn wrong" onclick="FlashcardManager.markWrong('${t[0]}')" title="Vet inte / Ù„Ø§ Ø£Ø¹Ø±Ù">
                        âŒ
                    </button>
                    <button class="fc-action-btn correct" onclick="FlashcardManager.markCorrect('${t[0]}')" title="Vet / Ø£Ø¹Ø±Ù">
                        âœ…
                    </button>
                </div>
                
                <!-- Minimal Navigation (hidden in focus mode) -->
                <div class="fc-nav-simple">
                    <button class="fc-nav-icon" onclick="SwipeNavigator.navigate(-1)" title="FÃ¶regÃ¥ende / Ø§Ù„Ø³Ø§Ø¨Ù‚">â†</button>
                    <button class="fc-nav-icon random" onclick="FlashcardManager.randomWord()" title="SlumpmÃ¤ssigt / Ø¹Ø´ÙˆØ§Ø¦ÙŠ">ğŸ²</button>
                    <button class="fc-nav-icon" onclick="SwipeNavigator.navigate(1)" title="NÃ¤sta / Ø§Ù„ØªØ§Ù„ÙŠ">â†’</button>
                </div>
            </div>
        `,this.isFlipped=!1,this.setupKeyboardShortcuts(),this.startTimeUpdater()}static generateListeningOptions(t){return[...(window.dictionaryData||[]).filter(n=>n[2]!==t).sort(()=>Math.random()-.5).slice(0,3).map(n=>n[2]),t].sort(()=>Math.random()-.5).map(n=>`
            <button class="quiz-option" onclick="FlashcardManager.checkListeningAnswer('${n}', '${t}')">
                ${n}
            </button>
        `).join("")}static checkListeningAnswer(t,e){var s,a;t===e?this.markCorrect(((s=this.currentWordData)==null?void 0:s[0])||""):this.markWrong(((a=this.currentWordData)==null?void 0:a[0])||"")}static setMode(t){this.currentMode=t,this.currentWordData&&this.init(this.currentWordData)}static setupKeyboardShortcuts(){document.onkeydown=t=>{var e,s;t.code==="Space"?(t.preventDefault(),this.flip()):t.code==="ArrowRight"||t.code==="KeyD"?D.navigate(1):t.code==="ArrowLeft"||t.code==="KeyA"?D.navigate(-1):t.code==="ArrowUp"||t.code==="KeyW"?this.markCorrect(((e=this.currentWordData)==null?void 0:e[0])||""):(t.code==="ArrowDown"||t.code==="KeyS")&&this.markWrong(((s=this.currentWordData)==null?void 0:s[0])||"")}}static startTimeUpdater(){setInterval(()=>{const t=document.getElementById("fcTime");t&&(t.textContent=this.formatTime(Date.now()-this.startTime))},1e3)}static flip(){const t=document.querySelector(".flashcard-clean");t&&(this.isFlipped=!this.isFlipped,t.classList.toggle("flipped",this.isFlipped),t.classList.add("shimmering"),setTimeout(()=>t.classList.remove("shimmering"),1500),this.isFlipped&&this.currentWordData&&setTimeout(()=>this.playAudio(this.currentWordData[2]),300))}static randomWord(){const t=window.dictionaryData;if(!t||t.length===0)return;const e=Math.floor(Math.random()*t.length),s=t[e];window.location.href=`details.html?id=${s[0]}`}static markCorrect(t){this.streak++,this.xp+=10+this.streak*2,this.sessionStats.correct++,this.sessionStats.total++,this.updateStatsUI(),this.showSuccessGlow(),I(`âœ… +${10+this.streak*2} XP`,{type:"success"}),_.updateMastery(t,!0),K.recordCorrect(t),setTimeout(()=>D.navigate(1),800)}static markWrong(t){this.streak=0,this.sessionStats.wrong++,this.sessionStats.total++,this.updateStatsUI(),this.showErrorFlash(),I("âŒ",{type:"error"}),_.updateMastery(t,!1),K.recordWrong(t)}static updateStatsUI(){const t=document.getElementById("fcStreak"),e=document.getElementById("fcXP"),s=document.getElementById("fcAccuracy");t&&(t.textContent=this.streak.toString()),e&&(e.textContent=this.xp.toString()),s&&(s.textContent=`${this.getAccuracy()}%`)}}g(T,"isFlipped",!1),g(T,"currentMode","normal"),g(T,"focusMode",!1),g(T,"streak",0),g(T,"xp",0),g(T,"sessionStats",{correct:0,wrong:0,total:0}),g(T,"startTime",Date.now()),g(T,"currentWordData",null);window.FlashcardManager=T;class J{static checkAndUpdateStreak(){const t=new Date().toDateString(),e=localStorage.getItem(this.LAST_DATE_KEY);let s=parseInt(localStorage.getItem(this.STREAK_KEY)||"0");if(e===t)return s;const a=new Date;return a.setDate(a.getDate()-1),e===a.toDateString()?s++:e!==t&&(s=1),localStorage.setItem(this.STREAK_KEY,s.toString()),localStorage.setItem(this.LAST_DATE_KEY,t),s}static getStreak(){return parseInt(localStorage.getItem(this.STREAK_KEY)||"0")}static renderStreakBadge(t){const e=this.checkAndUpdateStreak();if(e<2)return;const s=document.createElement("div");s.className="daily-streak-badge",s.innerHTML=`
            <span class="streak-fire">ğŸ”¥</span>
            <span class="sv-text">${e} dagar i rad!</span><span class="ar-text">${e} Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©!</span>
        `,t.prepend(s)}}g(J,"STREAK_KEY","dailyStreak"),g(J,"LAST_DATE_KEY","lastStudyDate");class nt{static getRandomQuote(){return this.quotes[Math.floor(Math.random()*this.quotes.length)]}static renderQuote(t){const e=this.getRandomQuote(),s=document.createElement("div");s.className="motivation-quote",s.innerHTML=`
            <p>"${e.text}"</p>
            <div class="author">â€” ${e.author}</div>
        `,t.appendChild(s)}}g(nt,"quotes",[{text:'<span class="sv-text">Varje nytt ord Ã¤r ett fÃ¶nster mot en ny vÃ¤rld</span><span class="ar-text">ÙƒÙ„ ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù‡ÙŠ Ù†Ø§ÙØ°Ø© Ø¹Ù„Ù‰ Ø¹Ø§Ù„Ù… Ø¬Ø¯ÙŠØ¯</span>',author:'<span class="sv-text">OkÃ¤nd</span><span class="ar-text">Ù…Ø¬Ù‡ÙˆÙ„</span>'},{text:'<span class="sv-text">LÃ¤rande Ã¤r ingen tÃ¤vling, det Ã¤r en resa</span><span class="ar-text">Ø§Ù„ØªØ¹Ù„Ù… Ù„ÙŠØ³ Ø³Ø¨Ø§Ù‚Ø§Ù‹ØŒ Ø¨Ù„ Ø±Ø­Ù„Ø©</span>',author:'<span class="sv-text">Visdom</span><span class="ar-text">Ø­ÙƒÙ…Ø©</span>'},{text:'<span class="sv-text">Den som lÃ¤r sig ett sprÃ¥k, fÃ¶rstÃ¥r en kultur</span><span class="ar-text">Ù…Ù† ÙŠØªØ¹Ù„Ù… Ù„ØºØ©ØŒ ÙŠÙÙ‡Ù… Ø«Ù‚Ø§ÙØ©</span>',author:'<span class="sv-text">OrdsprÃ¥k</span><span class="ar-text">Ù…Ø«Ù„</span>'},{text:'<span class="sv-text">SprÃ¥ket Ã¤r nationens sjÃ¤l</span><span class="ar-text">Ø§Ù„Ù„ØºØ© Ù‡ÙŠ Ø±ÙˆØ­ Ø§Ù„Ø£Ù…Ø©</span>',author:'<span class="sv-text">Fichte</span><span class="ar-text">ÙÙŠØ®ØªÙ‡</span>'}]);class vt{static share(t){const e=t[2],s=t[3],a=t[1],n=`ğŸ“š ØªØ¹Ù„Ù…Øª ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©!

ğŸ‡¸ğŸ‡ª ${e} (${a})
ğŸ‡¸ğŸ‡¦ ${s}

#SnabbaLexin #LearnSwedish`;navigator.share?navigator.share({title:`${e} - SnabbaLexin`,text:n,url:window.location.href}).catch(()=>{}):(navigator.clipboard.writeText(n),I('<span class="sv-text">Kopierad!</span><span class="ar-text">ØªÙ… Ø§Ù„Ù†Ø³Ø®!</span>'))}static renderShareButton(t,e){const s=document.createElement("button");s.className="share-btn",s.innerHTML='ğŸ“¤ <span class="sv-text">Dela</span><span class="ar-text">Ù…Ø´Ø§Ø±ÙƒØ©</span>',s.onclick=()=>this.share(e),t.appendChild(s)}}window.MiniQuizManager=j;window.SwipeNavigator=D;window.RelatedWordsManager=at;window.FlashcardManager=T;window.MasteryManager=_;window.DailyStreakManager=J;window.MotivationManager=nt;window.WeakWordsManager=K;window.ShareManager=vt;class yt{constructor(){g(this,"wordId",null);g(this,"wordData",null);this.init()}async init(){const t=new URLSearchParams(window.location.search);if(this.wordId=t.get("id"),!this.wordId){window.location.href="index.html";return}this.setupGeneralListeners(),this.setupTabListeners();try{await E.init();const e=await E.getWordById(this.wordId);if(e){this.wordData=e,this.renderDetails(),it.recordStudy(this.wordId),ot.init(this.wordId),this.loadBackgroundData();return}}catch(e){console.warn("[Details] Cache lookup failed:",e)}console.warn("[Details] Word not in cache. Fallback disabled.")}async loadBackgroundData(){window.dictionaryData?this.initDeferredFeatures():this.initDeferredFeatures()}initDeferredFeatures(){if(!this.wordData)return;const t=document.getElementById("detailsArea");if(t&&(_.renderMasteryBar(this.wordId,t),J.renderStreakBadge(t)),window.dictionaryData)j.init(this.wordData),at.init(this.wordData),D.init(this.wordId),T.init(this.wordData);else{const e=document.querySelector(".notes-section");e&&nt.renderQuote(e)}}setupGeneralListeners(){const t=document.getElementById("themeToggleBtn");t&&t.addEventListener("click",()=>ht.toggle())}setupTabListeners(){const t=document.querySelectorAll(".details-tab-btn"),e=document.querySelectorAll(".tab-content");e.forEach(s=>{const a=s.dataset.tab==="info";s.style.display=a?"block":"none"}),t.forEach(s=>{s.addEventListener("click",()=>{const a=s.dataset.tab;t.forEach(n=>n.classList.toggle("active",n===s)),e.forEach(n=>{const i=n.dataset.tab===a;n.classList.toggle("active",i),n.style.display=i?"block":"none"}),a==="play"&&this.wordData&&(j.init(this.wordData),q.init(this.wordData[2]))})})}async handleDataReady(){const t=window.dictionaryData;if(t)if(this.wordData=t.find(e=>e[0].toString()===this.wordId)||null,this.wordData||(this.wordData=await E.getWordById(this.wordId)),this.wordData)it.recordStudy(this.wordId),this.renderDetails(),ot.init(this.wordId),j.init(this.wordData),at.init(this.wordData);else{const e=document.getElementById("detailsArea");e&&(e.innerHTML='<div class="placeholder-message"><span class="sv-text">Ordet hittades inte</span><span class="ar-text">Ø§Ù„ÙƒÙ„Ù…Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©</span></div>')}}renderDetails(){const t=this.wordData,e=t[0].toString(),s=t[1],a=t[2],n=t[3],i=t[4]||"",r=t[5]||"",d=t[6]||"",o=t[7]||"",l=t[8]||"",c=t[9]||"",p=t[10]||"",h=t[13]||"";Z.getCategory(s,a,d,h,n);const v=U.has(e),w=Z.getGlowClass(s,a,d,h,n);this.setupHeaderActions(t,v);const m=document.getElementById("detailsArea");if(!m)return;const x=Z.generateBadge(s,a,d,h,n),$=Q.process(r),W=Q.process(o),M=Q.process(c),A=document.querySelector(".details-tabs");A&&(A.className="details-tabs "+w);const C=document.querySelector(".details-header-sticky");C&&(C.className="details-header details-header-sticky "+w);let z=`
            <!-- Hero Section with Type Glow -->
            <div class="details-hero ${w} premium-border-animated">
                <div class="hero-inner">
                    <h1 class="word-swe-hero">${a}</h1>
                    <div class="hero-divider"></div>
                    <p class="word-arb-hero" dir="rtl">${n}</p>
                    ${i?`<p class="word-arb-ext" dir="rtl">${i}</p>`:""}
                </div>
                
                <div class="word-meta-row">
                    <span class="word-type-pill">
                        <span class="sv-text">${s}</span>
                        <span class="sv-text ar-text"> / </span>
                        <span class="ar-text">${Y("quran."+s.toLowerCase().replace("substantiv","noun"),"ar")||s}</span>
                    </span>
                    ${x}
                </div>
            </div>

            <div class="details-content-grid">
                ${d?`
                <div class="details-section">
                    <h3 class="section-title"><span class="section-icon">ğŸ”—</span> <span class="sv-text">BÃ¶jningar</span><span class="ar-text">Ø§Ù„ØªØµØ±ÙŠÙØ§Øª</span></h3>
                    <div class="forms-card-container">
                        <div class="forms-container">
                            ${d.split(",").map(y=>`<span class="form-chip">${y.trim()}</span>`).join("")}
                        </div>
                    </div>
                </div>
                `:""}

                ${r||i?`
                <div class="details-section">
                    <h3 class="section-title"><span class="section-icon">ğŸ“</span> <span class="sv-text">Betydelse</span><span class="ar-text">Ø§Ù„Ù…Ø¹Ù†Ù‰</span></h3>
                    <div class="definition-card">
                        ${r?`<p class="def-text">${$}</p>`:""}
                        ${i?`<p class="def-text" dir="rtl" style="margin-top: 10px; border-top: 1px solid var(--border); padding-top: 10px;">${i}</p>`:""}
                    </div>
                </div>
                `:""}

                ${o||l?`
                <div class="details-section">
                    <h3 class="section-title"><span class="section-icon">ğŸ’¡</span> <span class="sv-text">Exempel</span><span class="ar-text">Ø£Ù…Ø«Ù„Ø©</span></h3>
                    <div class="example-card">
                        ${o?`<div class="ex-swe-detail" dir="ltr">${W}</div>`:""}
                        ${l?`<div class="ex-arb-detail" dir="rtl">${l}</div>`:""}
                    </div>
                </div>
                `:""}

                ${c||p?`
                <div class="details-section">
                    <h3 class="section-title"><span class="section-icon">ğŸ’¬</span> <span class="sv-text">Uttryck</span><span class="ar-text">ØªØ¹Ø§Ø¨ÙŠØ±</span></h3>
                    <div class="example-card idiom-card">
                        ${c?`<div class="ex-swe-detail" dir="ltr">${M}</div>`:""}
                        ${p?`<div class="ex-arb-detail" dir="rtl">${p}</div>`:""}
                    </div>
                </div>
                `:""}
            </div>
        `;m.innerHTML=z,Q.setupListeners(m);const V=m.querySelector(".word-swe-hero");V&&X.apply(V,a);const N=m.querySelector(".word-arb-hero");N&&X.apply(N,n),m.querySelectorAll(".def-text, .ex-swe-detail, .ex-arb-detail").forEach(y=>{X.apply(y,y.textContent||"")});const P=tt.getLanguage();P==="sv"?document.title=`${a} - SnabbaLexin`:P==="ar"?document.title=`${n} - Ø³Ù†Ø§Ø¨Ø§ Ù„ÙƒØ³ÙŠÙ†`:document.title=`${a} | ${n} - SnabbaLexin`,setTimeout(()=>{q.init(a)},100);let S=null;window.addEventListener("resize",()=>{S=null}),m.addEventListener("mouseenter",()=>{const y=m.querySelector(".hero-inner");y&&(S=y.getBoundingClientRect())},{capture:!0}),m.addEventListener("mousemove",y=>{const k=m.querySelector(".hero-inner");if(!k)return;S||(S=k.getBoundingClientRect());const f=y.clientX-S.left,b=y.clientY-S.top;requestAnimationFrame(()=>{const B=S.width/2,L=S.height/2,lt=(b-L)/L*-10,dt=(f-B)/B*10;k.style.transform=`perspective(1000px) rotateX(${lt}deg) rotateY(${dt}deg)`})}),m.addEventListener("mouseleave",()=>{const y=m.querySelector(".hero-inner");y&&(y.style.transform="perspective(1000px) rotateX(0) rotateY(0)"),S=null});const H=m.querySelector(".details-hero");H&&H.addEventListener("dblclick",y=>{const k=y;ct.spawn(k.clientX,k.clientY);const f=document.getElementById("headerFavoriteBtn");f&&f.click()})}setupHeaderActions(t,e){const s=t[2],a=t[0].toString(),n=a.startsWith("local_")||a.length>20,i=document.getElementById("headerAudioBtn");i&&(i.onclick=()=>R.speak(s,"sv"));const r=document.getElementById("headerFavoriteBtn");r&&(U.updateButtonIcon(r,e),r.onclick=()=>this.toggleFavorite(a,r));const d=document.getElementById("headerTrainingBtn");d&&(E.isWordMarkedForTraining(a).then(w=>{d.innerHTML=w?"ğŸ§ ":"ğŸ’ª",d.classList.toggle("active",w),d.setAttribute("aria-label",w?"Ta bort frÃ¥n trÃ¤ning / Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„ØªØ¯Ø±ÙŠØ¨":"LÃ¤gg till i trÃ¤ning / Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØªØ¯Ø±ÙŠØ¨")}),d.onclick=async()=>{const m=!d.classList.contains("active");d.classList.toggle("active"),d.innerHTML=m?"ğŸ§ ":"ğŸ’ª",d.setAttribute("aria-label",m?"Ta bort frÃ¥n trÃ¤ning / Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„ØªØ¯Ø±ÙŠØ¨":"LÃ¤gg till i trÃ¤ning / Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØªØ¯Ø±ÙŠØ¨");const x=document.createElement("div");x.innerHTML=m?"ğŸ§ ":"ğŸ’¨",x.className="heart-particle";const $=d.getBoundingClientRect();x.style.left=$.left+$.width/2+"px",x.style.top=$.top+$.height/2+"px",document.body.appendChild(x),setTimeout(()=>x.remove(),1e3),await E.updateTrainingStatus(a,m),m?I("Tillagd i trÃ¤ning / ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØªØ¯Ø±ÙŠØ¨"):I("Borttagen frÃ¥n trÃ¤ning / ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„ØªØ¯Ø±ÙŠØ¨")});const o=document.getElementById("headerFlashcardBtn");o&&(o.onclick=()=>{window.location.href=`games/flashcards.html?id=${a}`});const l=document.getElementById("customActions");l&&(l.style.display=n?"flex":"none");const c=document.getElementById("editBtn");c&&(c.onclick=()=>{window.location.href=`add.html?edit=${a}`});const p=document.getElementById("deleteBtn");p&&(p.onclick=async()=>{confirm(F("details.confirmDelete"))&&(await E.deleteWord(a),I('<span class="sv-text">Ordet borttaget</span><span class="ar-text">ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙ„Ù…Ø©</span>'),setTimeout(()=>window.location.href="index.html",1e3))});const h=document.getElementById("smartCopyBtn");h&&(h.onclick=()=>{navigator.clipboard.writeText(s).then(()=>I('<span class="sv-text">Kopierat</span><span class="ar-text">ØªÙ… Ø§Ù„Ù†Ø³Ø®</span> ğŸ“‹'))});const v=document.getElementById("headerShareBtn");v&&(v.onclick=()=>{const m=tt.getLanguage()==="ar"?`ğŸ“š ØªØ¹Ù„Ù…Øª ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©!

ğŸ‡¸ğŸ‡ª ${s}
ğŸ‡¸ğŸ‡¦ ${t[3]}

#SnabbaLexin`:`ğŸ“š Jag lÃ¤rde mig ett nytt ord!

ğŸ‡¸ğŸ‡ª ${s}
ğŸ‡¸ğŸ‡¦ ${t[3]}

#SnabbaLexin`;navigator.share?navigator.share({title:`Lexin: ${s}`,text:m,url:window.location.href}).catch(console.error):navigator.clipboard.writeText(window.location.href).then(()=>I('<span class="sv-text">LÃ¤nk kopierad</span><span class="ar-text">ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</span> ğŸ”—'))})}toggleFavorite(t,e){const s=U.toggle(t);U.updateButtonIcon(e,s)}}typeof window<"u"&&(window.detailsManager=new yt);
