import"./modulepreload-polyfill-B5Qt9EMX.js";import"./config-8gd_ljfe.js";import{r as o,j as t,c as O,R as X}from"./client-Chk-tuEE.js";import{DictionaryDB as x,DataLoader as W}from"./db-D9nATt-F.js";import{T as q}from"./tts-D1JXvOqA.js";import{ThemeManager as G}from"./utils-5O7zxelZ.js";import{L as _}from"./i18n-BpwFYk4h.js";import"./toast-manager-DdtDDR9Z.js";var b=(e=>(e[e.Again=0]="Again",e[e.Hard=3]="Hard",e[e.Good=4]="Good",e[e.Easy=5]="Easy",e))(b||{});const k={nextReview:Date.now(),interval:0,easeFactor:2.5,repetitions:0};function K(e,n=k){const{easeFactor:r,interval:m,repetitions:y}=n,f=Math.max(0,Math.min(5,Math.round(e)));let l,u,g;f<3?(l=1,g=0,u=Math.max(1.3,r-.2)):(g=y+1,u=r+(.1-(5-f)*(.08+(5-f)*.02)),u=Math.max(1.3,u),g===1?l=1:g===2?l=6:l=Math.round(m*u),f===5&&(l=Math.round(l*1.3))),l=Math.min(365,l);const N=Date.now();return{newData:{nextReview:N+l*24*60*60*1e3,interval:l,easeFactor:Math.round(u*100)/100,repetitions:g,lastReview:N},wasCorrect:f>=3}}const H=[{quality:0,label:"Igen / Ù…Ø±Ø© Ø£Ø®Ø±Ù‰",color:"#ef4444",icon:"ðŸ”„"},{quality:3,label:"SvÃ¥rt / ØµØ¹Ø¨",color:"#f97316",icon:"ðŸ˜“"},{quality:4,label:"Bra / Ø¬ÙŠØ¯",color:"#22c55e",icon:"ðŸ‘"},{quality:5,label:"Klar / ØªÙ…",color:"#3b82f6",icon:"ðŸ—‘ï¸"}],J=()=>{const[e,n]=o.useState([]),[r,m]=o.useState(0),[y,f]=o.useState(!1),[l,u]=o.useState(!0),[g,N]=o.useState(!1),[D,M]=o.useState(null),[p,A]=o.useState({wordsReviewed:0,correctCount:0,startTime:Date.now()}),L=o.useRef(0),I=o.useRef(0),w=o.useRef(null);o.useEffect(()=>{C(),setTimeout(()=>N(!0),100)},[]);const C=async()=>{u(!0);try{await x.hasCachedData()||await W.loadDictionary();const a=await x.getTrainingWordsDue(),c=s=>Array.isArray(s)?{id:s[0],swe:s[2],arb:s[3],type:s[1],sweDef:s[5],sweEx:s[7],arbEx:s[8]}:{id:s.id,swe:s.swe||s.swedish,arb:s.arb||s.arabic,type:s.type,sweDef:s.sweDef,sweEx:s.sweEx,arbEx:s.arbEx};let d=a.map(c);d.some(s=>!s.swe||!s.arb)&&(await W.refreshCache(),d=(await x.getTrainingWordsDue()).map(c));const v=d.filter(s=>s.swe&&s.arb);n(v)}catch(a){console.error("Failed to load training words",a)}finally{u(!1)}},i=e[r],B=()=>{if(!i)return;q.speak(i.swe);const a=parseInt(localStorage.getItem("ttsUsage")||"0",10);localStorage.setItem("ttsUsage",(a+1).toString())},P=()=>{f(!y),B()},R=async a=>{if(!i)return;const d=await x.getReviewData(i.id)||k,{newData:j,wasCorrect:v}=K(a,d);if(a===b.Easy){await x.updateTrainingStatus(i.id,!1);const s=JSON.parse(localStorage.getItem("wordAssessments")||"{}");s[i.id]={id:i.id,level:5,timestamp:Date.now()},localStorage.setItem("wordAssessments",JSON.stringify(s))}else await x.updateReviewData(i.id,j);A(s=>({...s,wordsReviewed:s.wordsReviewed+1,correctCount:s.correctCount+(v?1:0)})),M(v?"right":"left"),"vibrate"in navigator&&navigator.vibrate(v?50:[50,30,50]),setTimeout(()=>{if(M(null),f(!1),a===b.Again)n(s=>{const E=[...s],[F]=E.splice(r,1);return E.push(F),E});else{const s=e.filter(E=>E.id!==i.id);n(s),r>=s.length&&m(Math.max(0,s.length-1))}},300)},S=o.useRef(0),T=o.useRef(0),U=a=>{L.current=a.touches[0].clientX,S.current=a.touches[0].clientY},Y=a=>{I.current=a.touches[0].clientX,T.current=a.touches[0].clientY;const c=I.current-L.current,d=T.current-S.current;if(Math.abs(c)>Math.abs(d)){if(Math.abs(c)>10&&w.current){a.cancelable&&a.preventDefault();const j=c*.05,v=y?180:0;w.current.style.transform=`translateX(${c}px) rotateY(${v}deg) rotateZ(${j}deg)`}}else if(d<-10&&w.current){const j=y?180:0;w.current.style.transform=`translateY(${d*.3}px) rotateY(${j}deg)`}},$=()=>{const a=I.current-L.current,c=T.current-S.current,d=80;w.current&&(w.current.style.transform=""),Math.abs(a)>Math.abs(c)?a>d?R(b.Good):a<-d&&R(b.Again):c<-50&&(B(),"vibrate"in navigator&&navigator.vibrate(20)),L.current=0,I.current=0,S.current=0,T.current=0};return o.useEffect(()=>()=>{p.wordsReviewed>0&&x.saveTrainingSession({date:new Date().toISOString().split("T")[0],wordsReviewed:p.wordsReviewed,correctCount:p.correctCount,timeSpentMs:Date.now()-p.startTime})},[p]),l?t.jsxs("div",{className:"training-loading",children:[t.jsx("div",{className:"loading-spinner"}),t.jsx("p",{className:"text-loading",children:"Laddar..."})]}):e.length===0?t.jsx(V,{stats:p}):t.jsxs("div",{className:`training-container transition-opacity duration-700 ${g?"opacity-100":"opacity-0"}`,children:[t.jsxs("div",{className:"training-header",children:[t.jsx("button",{className:"training-back-btn",onClick:()=>window.location.href="/","aria-label":"Tillbaka / Ø±Ø¬ÙˆØ¹",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("line",{x1:"19",y1:"12",x2:"5",y2:"12"}),t.jsx("polyline",{points:"12 19 5 12 12 5"})]})}),t.jsxs("div",{className:"training-counter",children:[t.jsx("span",{children:"Kvar:"}),t.jsx("span",{className:"counter-label",children:e.length})]}),t.jsxs("div",{className:"training-counter mastered-counter",children:[t.jsx("span",{children:"ðŸ“Š"}),t.jsx("span",{className:"counter-label mastered-val",children:p.wordsReviewed>0?`${Math.round(p.correctCount/p.wordsReviewed*100)}%`:"0%"})]})]}),t.jsx("div",{className:`training-card ${y?"flipped":""} ${D?`swipe-${D}`:""}`,onClick:P,onTouchStart:U,onTouchMove:Y,onTouchEnd:$,children:t.jsxs("div",{className:"card-inner",ref:w,children:[t.jsxs("div",{className:"card-face card-front",children:[i.type&&t.jsx("div",{className:"card-type",children:i.type}),t.jsx("h2",{className:"card-word",children:i.swe})]}),t.jsxs("div",{className:"card-face card-back",children:[t.jsx("h2",{className:"card-arabic",dir:"rtl",children:i.arb}),t.jsx("div",{className:"divider"}),t.jsxs("div",{className:"card-section",children:[i.sweDef&&t.jsx("div",{className:"card-definition",children:i.sweDef}),i.sweEx&&t.jsxs("div",{className:"card-example-container",children:[t.jsxs("p",{className:"card-example-swe",children:['"',i.sweEx,'"']}),i.arbEx&&t.jsx("p",{className:"card-example",dir:"rtl",children:i.arbEx})]})]})]})]})}),t.jsx("div",{className:"swipe-hint-container",children:"ðŸ‘† Tryck fÃ¶r att vÃ¤nda â€¢ Ø§Ø¶ØºØ· Ù„Ù„Ù‚Ù„Ø¨"}),t.jsx("div",{className:"training-controls sm2-controls",children:H.map(a=>t.jsxs("button",{onClick:c=>{c.stopPropagation(),R(a.quality)},className:`training-btn sm2-btn quality-${a.quality}`,style:{"--btn-color":a.color},children:[t.jsx("span",{className:"btn-icon",children:a.icon}),t.jsx("span",{className:"btn-label",children:a.label.split(" / ")[0]})]},a.quality))})]})},V=({stats:e})=>{const n=e.wordsReviewed>0?Math.round(e.correctCount/e.wordsReviewed*100):0,r=Math.round((Date.now()-e.startTime)/6e4);return t.jsxs("div",{className:"training-state complete",children:[t.jsx("div",{className:"state-emoji",children:"ðŸŽ‰"}),t.jsx("h2",{className:"text-white",children:"TrÃ¤ning Klar!"}),t.jsx("p",{children:"Grymt jobbat! Du har repeterat alla ord som behÃ¶vdes idag."}),t.jsxs("div",{className:"stats-grid",children:[t.jsxs("div",{className:"stat-item",children:[t.jsx("span",{className:"stat-value",children:e.wordsReviewed}),t.jsx("span",{className:"stat-label",children:"Ord repeterade"})]}),t.jsxs("div",{className:"stat-item",children:[t.jsxs("span",{className:"stat-value",children:[n,"%"]}),t.jsx("span",{className:"stat-label",children:"Precision"})]}),t.jsxs("div",{className:"stat-item",children:[t.jsxs("span",{className:"stat-value",children:[r,"m"]}),t.jsx("span",{className:"stat-label",children:"Tid"})]})]}),t.jsx("div",{className:"complete-actions",children:t.jsx("a",{href:"/",className:"training-btn primary",children:"Tillbaka Hem"})})]})};G.init();_.init();document.addEventListener("DOMContentLoaded",async()=>{const e=document.getElementById("training-root");if(!e){console.error("[TrainingApp] Mount point not found");return}O.createRoot(e).render(X.createElement(J)),console.log("[TrainingApp] Mounted successfully")});"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{const e=new URL("/assets/sw-BQj_SXJ1.ts",import.meta.url),n=await navigator.serviceWorker.register(e,{type:"module"});console.log("[PWA] ServiceWorker registered with URL:",e.href),n.addEventListener("updatefound",()=>{const r=n.installing;r&&(console.log("[PWA] New service worker installing..."),r.addEventListener("statechange",()=>{r.state==="installed"&&navigator.serviceWorker.controller&&Z()}))})}catch(e){console.log("[PWA] ServiceWorker registration failed:",e)}});function Z(){const e=document.getElementById("updatePrompt");if(e){e.classList.remove("hidden");const n=document.getElementById("updateBtn"),r=document.getElementById("dismissUpdate");n&&n.addEventListener("click",()=>{var m;(m=navigator.serviceWorker.controller)==null||m.postMessage({type:"SKIP_WAITING"}),window.location.reload()}),r&&r.addEventListener("click",()=>{e.classList.add("hidden")})}}window.addEventListener("online",()=>{const e=document.getElementById("offlineBanner");e&&e.classList.add("hidden")});window.addEventListener("offline",()=>{const e=document.getElementById("offlineBanner");e&&e.classList.remove("hidden")});if(!navigator.onLine){const e=document.getElementById("offlineBanner");e&&e.classList.remove("hidden")}let h=null;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),h=e;const n=document.getElementById("installApp"),r=document.getElementById("pwa-install-prompt");n&&(n.classList.remove("hidden"),n.addEventListener("click",async()=>{if(h){h.prompt();const{outcome:m}=await h.userChoice;console.log("[PWA] User response:",m),h=null,n.classList.add("hidden")}})),r&&!localStorage.getItem("pwa-prompt-dismissed")&&setTimeout(()=>{r.classList.remove("hidden")},5e3)});document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("pwa-install-btn"),n=document.getElementById("pwa-later-btn"),r=document.getElementById("pwa-install-prompt");e&&e.addEventListener("click",async()=>{if(h){h.prompt();const{outcome:m}=await h.userChoice;console.log("[PWA] Install prompt outcome:",m),h=null}r&&r.classList.add("hidden")}),n&&n.addEventListener("click",()=>{r&&r.classList.add("hidden"),localStorage.setItem("pwa-prompt-dismissed","true")})});const z=/iPad|iPhone|iPod/.test(navigator.userAgent),Q=window.matchMedia("(display-mode: standalone)").matches||navigator.standalone;if(z&&!Q){const e=document.getElementById("iosInstallPrompt");if(e&&!localStorage.getItem("ios-prompt-dismissed")){setTimeout(()=>{e.classList.remove("hidden"),setTimeout(()=>{e.style.transition="opacity 0.5s ease-out, transform 0.5s ease-out",e.style.opacity="0",e.style.transform="translateY(20px)",setTimeout(()=>{e.classList.add("hidden"),e.style.opacity="",e.style.transform="",e.style.transition=""},500)},15e3)},1e4);const n=document.getElementById("closeIosPrompt");n&&n.addEventListener("click",()=>{e.classList.add("hidden"),localStorage.setItem("ios-prompt-dismissed","true")})}}console.log("[PWA] Module loaded");
