var p=Object.defineProperty;var x=(n,t,e)=>t in n?p(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var o=(n,t,e)=>x(n,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import"./loader-CqI2jdYk.js";import"./pwa-Bn3RWWLO.js";import"./config-CfHoVMbv.js";import"./db-bEbbjtoI.js";class v{constructor(){o(this,"ctx");o(this,"enabled");this.ctx=new(window.AudioContext||window.webkitAudioContext),this.enabled=!0}playTone(t,e,s,i=.1,l=0){if(!this.enabled)return;const a=this.ctx.createOscillator(),r=this.ctx.createGain();a.type=e,a.frequency.setValueAtTime(t,this.ctx.currentTime),l!==0&&a.frequency.exponentialRampToValueAtTime(t+l,this.ctx.currentTime+s),r.gain.setValueAtTime(i,this.ctx.currentTime),r.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+s),a.connect(r),r.connect(this.ctx.destination),a.start(),a.stop(this.ctx.currentTime+s)}playSlide(){this.playTone(400,"sine",.1,.1,200)}playHit(){this.playTone(150,"square",.1,.05,-50)}playWin(){[523.25,659.25,783.99,1046.5,783.99,1046.5].forEach((t,e)=>{setTimeout(()=>this.playTone(t,"square",.1,.1),e*80)}),setTimeout(()=>this.playTone(1318.51,"square",.4,.1),480)}playUndo(){this.playTone(600,"sawtooth",.15,.1,-400)}}class f{constructor(t,e,s,i,l,a){o(this,"id");o(this,"x");o(this,"y");o(this,"length");o(this,"orientation");o(this,"type");o(this,"el");o(this,"tempX");o(this,"tempY");this.id=t,this.x=e,this.y=s,this.length=i,this.orientation=l,this.type=a,this.el=null}}class k{constructor(){o(this,"board");o(this,"cellSize");o(this,"gap");o(this,"gridSize");o(this,"blocks");o(this,"currentLevel");o(this,"moves");o(this,"history");o(this,"sound");o(this,"gameMode");o(this,"progress");o(this,"levels");o(this,"isDragging",!1);o(this,"draggedBlock",null);o(this,"startPos",{x:0,y:0});o(this,"blockStartPos",{x:0,y:0});o(this,"hasMoved",!1);this.board=document.getElementById("board"),this.cellSize=55,this.gap=4,this.gridSize=6,this.blocks=[],this.currentLevel=0,this.moves=0,this.history=[],this.sound=new v,this.gameMode="classic",this.progress=JSON.parse(localStorage.getItem("unblockMe_progress"))||{},this.levels=[{par:10,blocks:[{x:1,y:2,len:2,dir:"h",type:"target"},{x:0,y:0,len:3,dir:"v",type:"normal"},{x:1,y:0,len:2,dir:"h",type:"normal"},{x:3,y:0,len:3,dir:"v",type:"normal"},{x:4,y:2,len:2,dir:"v",type:"normal"},{x:0,y:4,len:2,dir:"h",type:"normal"},{x:2,y:4,len:2,dir:"v",type:"normal"},{x:4,y:4,len:2,dir:"h",type:"normal"}]},{par:15,blocks:[{x:0,y:2,len:2,dir:"h",type:"target"},{x:2,y:0,len:3,dir:"v",type:"normal"},{x:3,y:1,len:2,dir:"v",type:"normal"},{x:0,y:4,len:3,dir:"h",type:"normal"},{x:4,y:3,len:2,dir:"v",type:"normal"},{x:2,y:3,len:2,dir:"h",type:"normal"},{x:0,y:0,len:1,dir:"h",type:"fixed"},{x:5,y:5,len:1,dir:"h",type:"fixed"}]},{par:20,blocks:[{x:1,y:2,len:2,dir:"h",type:"target"},{x:0,y:0,len:2,dir:"h",type:"normal"},{x:2,y:0,len:2,dir:"h",type:"normal"},{x:4,y:0,len:2,dir:"v",type:"normal"},{x:0,y:1,len:2,dir:"v",type:"normal"},{x:3,y:1,len:3,dir:"v",type:"normal"},{x:1,y:3,len:2,dir:"v",type:"normal"},{x:0,y:4,len:2,dir:"h",type:"normal"},{x:4,y:4,len:2,dir:"v",type:"normal"},{x:2,y:2,len:1,dir:"h",type:"fixed"}]}],this.addEventListeners(),window.addEventListener("click",()=>{this.sound.ctx.state==="suspended"&&this.sound.ctx.resume()},{once:!0}),localStorage.getItem("unblockMe_nightMode")==="true"&&this.toggleNightMode(!0)}toggleNightMode(t=null){const e=document.body,s=t!==null?t:!e.classList.contains("night-mode");s?(e.classList.add("night-mode"),document.getElementById("theme-icon").innerHTML='<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>'):(e.classList.remove("night-mode"),document.getElementById("theme-icon").innerHTML='<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>'),localStorage.setItem("unblockMe_nightMode",s.toString())}startMode(t){this.gameMode=t,document.getElementById("start-screen").classList.add("hidden"),this.initLevel(this.currentLevel)}initLevel(t){this.currentLevel=t,this.moves=0,this.history=[],this.updateUI(),this.board.innerHTML='<div class="exit-gate"></div><div class="exit-arrow">âžœ</div>',this.blocks=[],this.levels[t%this.levels.length].blocks.forEach((s,i)=>{const l=new f(i,s.x,s.y,s.len,s.dir,s.type);this.createBlockElement(l),this.blocks.push(l)})}updateUI(){document.getElementById("level-display").textContent=(this.currentLevel+1).toString(),document.getElementById("moves-display").textContent=this.moves.toString();const t=`${this.gameMode}_${this.currentLevel}`,e=this.progress[t]?this.progress[t].moves.toString():"-";document.getElementById("best-display").textContent=e}createBlockElement(t){const e=document.createElement("div");let s=`block ${t.type} ${t.orientation==="h"?"horizontal":"vertical"}`;this.gameMode==="ice"&&(s+=" ice-theme"),e.className=s,t.orientation==="h"?(e.style.width=`calc(${t.length} * var(--cell-size) + ${t.length-1} * var(--gap))`,e.style.height="var(--cell-size)"):(e.style.width="var(--cell-size)",e.style.height=`calc(${t.length} * var(--cell-size) + ${t.length-1} * var(--gap))`),this.updateBlockPosition(e,t.x,t.y),e.dataset.id=t.id.toString(),this.board.appendChild(e),t.el=e}updateBlockPosition(t,e,s){const i=e*(this.cellSize+this.gap),l=s*(this.cellSize+this.gap);t.style.transform=`translate(${i}px, ${l}px)`}addEventListeners(){const t=i=>{if(!i.target.classList.contains("block"))return;const l=parseInt(i.target.dataset.id),a=this.blocks[l];if(a.type==="fixed"){this.sound.playHit();return}i.cancelable&&i.preventDefault(),this.isDragging=!0,this.draggedBlock=a;const r=i.touches?i.touches[0]:i;this.startPos={x:r.clientX,y:r.clientY},this.blockStartPos={x:this.draggedBlock.x,y:this.draggedBlock.y},this.hasMoved=!1},e=i=>{if(!this.isDragging||!this.draggedBlock)return;i.cancelable&&i.preventDefault();const l=i.touches?i.touches[0]:i,a=l.clientX-this.startPos.x,r=l.clientY-this.startPos.y;(Math.abs(a)>5||Math.abs(r)>5)&&(this.hasMoved=!0);const d=(this.draggedBlock.orientation==="h"?a:r)/(this.cellSize+this.gap);let c=this.blockStartPos.x,m=this.blockStartPos.y;this.draggedBlock.orientation==="h"?c+=d:m+=d;const h=this.constrainPosition(this.draggedBlock,c,m),y=h.x*(this.cellSize+this.gap),u=h.y*(this.cellSize+this.gap);this.draggedBlock.el&&(this.draggedBlock.el.style.transform=`translate(${y}px, ${u}px)`),this.draggedBlock.tempX=h.x,this.draggedBlock.tempY=h.y},s=()=>{if(!this.isDragging||!this.draggedBlock)return;let i,l;if(this.gameMode==="ice"&&this.hasMoved){const r=this.getLimits(this.draggedBlock),d=(this.draggedBlock.tempX||this.draggedBlock.x)-this.blockStartPos.x,c=(this.draggedBlock.tempY||this.draggedBlock.y)-this.blockStartPos.y;i=this.blockStartPos.x,l=this.blockStartPos.y,this.draggedBlock.orientation==="h"?d>.2?i=r.max:d<-.2&&(i=r.min):c>.2?l=r.max:c<-.2&&(l=r.min)}else i=Math.round(this.draggedBlock.tempX||this.draggedBlock.x),l=Math.round(this.draggedBlock.tempY||this.draggedBlock.y);(i!==this.blockStartPos.x||l!==this.blockStartPos.y)&&(this.history.push({id:this.draggedBlock.id,x:this.blockStartPos.x,y:this.blockStartPos.y}),this.moves++,this.updateUI(),this.sound.playSlide()),this.draggedBlock.x=i,this.draggedBlock.y=l;const a=this.draggedBlock;a.el&&(a.el.style.transition="transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94)",this.updateBlockPosition(a.el,i,l),setTimeout(()=>{a.el&&(a.el.style.transition="transform 0.1s")},200)),this.isDragging=!1,this.draggedBlock=null,this.checkWin()};this.board.addEventListener("mousedown",t),this.board.addEventListener("touchstart",t,{passive:!1}),window.addEventListener("mousemove",e),window.addEventListener("touchmove",e,{passive:!1}),window.addEventListener("mouseup",s),window.addEventListener("touchend",s)}getLimits(t){let e=0,s=this.gridSize-t.length;if(t.orientation==="h")for(let i of this.blocks)i!==t&&i.y<=t.y&&i.y+(i.orientation==="v"?i.length:1)>t.y&&(i.x+(i.orientation==="h"?i.length:1)<=this.blockStartPos.x&&(e=Math.max(e,i.x+(i.orientation==="h"?i.length:1))),i.x>=this.blockStartPos.x+t.length&&(s=Math.min(s,i.x-t.length)));else for(let i of this.blocks)i!==t&&i.x<=t.x&&i.x+(i.orientation==="h"?i.length:1)>t.x&&(i.y+(i.orientation==="v"?i.length:1)<=this.blockStartPos.y&&(e=Math.max(e,i.y+(i.orientation==="v"?i.length:1))),i.y>=this.blockStartPos.y+t.length&&(s=Math.min(s,i.y-t.length)));return{min:e,max:s}}constrainPosition(t,e,s){const i=this.getLimits(t);return t.orientation==="h"?(e=Math.max(i.min,Math.min(i.max,e)),{x:e,y:t.y}):(s=Math.max(i.min,Math.min(i.max,s)),{x:t.x,y:s})}undo(){if(this.history.length===0)return;const t=this.history.pop(),e=this.blocks[t.id];e.x=t.x,e.y=t.y,e.el&&this.updateBlockPosition(e.el,e.x,e.y),this.moves--,this.updateUI(),this.sound.playUndo()}checkWin(){const t=this.blocks.find(e=>e.type==="target");if(t&&t.x>=4){this.sound.playWin(),this.saveScore();const e=this.levels[this.currentLevel%this.levels.length].par;let s=1;this.moves<=e?s=3:this.moves<=e*1.5&&(s=2),document.getElementById("modal-stars").textContent="â˜…".repeat(s)+"â˜†".repeat(3-s),document.getElementById("modal-moves").textContent=this.moves.toString(),document.getElementById("modal-moves-ar").textContent=this.moves.toString(),setTimeout(()=>{document.getElementById("win-modal").classList.add("active"),this.createConfetti()},200)}}saveScore(){const t=`${this.gameMode}_${this.currentLevel}`,e=this.progress[t]?this.progress[t].moves:1/0;this.moves<e&&(this.progress[t]={moves:this.moves},localStorage.setItem("unblockMe_progress",JSON.stringify(this.progress)))}nextLevel(){document.getElementById("win-modal").classList.remove("active"),this.initLevel(this.currentLevel+1)}resetLevel(){this.initLevel(this.currentLevel),this.sound.playUndo()}createConfetti(){for(let t=0;t<50;t++){const e=document.createElement("div");e.style.position="fixed",e.style.left=Math.random()*100+"vw",e.style.top="-10px",e.style.width="10px",e.style.height="10px",e.style.background=`hsl(${Math.random()*360}, 100%, 50%)`,e.style.zIndex="2000",e.style.pointerEvents="none",document.body.appendChild(e);const s=e.animate([{transform:"translate(0, 0) rotate(0deg)",opacity:1},{transform:`translate(${Math.random()*100-50}px, 100vh) rotate(${Math.random()*720}deg)`,opacity:0}],{duration:1e3+Math.random()*2e3,easing:"cubic-bezier(0.25, 0.46, 0.45, 0.94)"});s.onfinish=()=>e.remove()}}}let g;document.addEventListener("DOMContentLoaded",()=>{g=new k,window.game=g,g.startMode("classic")});function b(){document.body.classList.toggle("iphone-view");const n=document.body.classList.contains("iphone-view");localStorage.setItem("mobileView",n?"true":"false");const t=document.getElementById("mobileToggle");t&&t.classList.toggle("active",n)}window.toggleMobileView=b;function M(){document.body.classList.toggle("focus-mode");const n=document.body.classList.contains("focus-mode");localStorage.setItem("unblockFocusMode",n?"true":"false");const t=document.getElementById("focusModeToggle");t&&(t.textContent=n?"ðŸŽ¯":"ðŸ‘ï¸",t.classList.toggle("active",n))}window.toggleFocusMode=M;localStorage.getItem("mobileView")==="true"&&(document.body.classList.add("iphone-view"),document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("mobileToggle");n&&n.classList.add("active")}));localStorage.getItem("unblockFocusMode")==="true"&&(document.body.classList.add("focus-mode"),document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("focusModeToggle");n&&(n.textContent="ðŸŽ¯",n.classList.add("active"))}));
