const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/db-CUAitF01.js","assets/config-8gd_ljfe.js"])))=>i.map(i=>d[i]);
var O=Object.defineProperty;var Q=(h,t,e)=>t in h?O(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var d=(h,t,e)=>Q(h,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";import{T as L}from"./type-color-system-Dd339K4H.js";import{_ as D}from"./preload-helper-D7HrI6pR.js";import{Loader as W}from"./loader-BlPi5qr6.js";import{showToast as B,TextSizeManager as k,ThemeManager as j,normalizeArabic as q,levenshteinDistance as V,VoiceSearchManager as F}from"./utils-5O7zxelZ.js";import{T}from"./tts-D1JXvOqA.js";import{Q as f,F as I}from"./quiz-stats-CpWuYj6M.js";import{DictionaryDB as $}from"./db-CUAitF01.js";import{A as N}from"./config-8gd_ljfe.js";import{L as G,t as P}from"./i18n-Dq4jSOyT.js";import"./i18n-apply-CJtsRO1p.js";import{d as U}from"./performance-utils-PTy-sCWq.js";import"./pwa-_2RHpQR3.js";import"./toast-manager-DdtDDR9Z.js";const b=[{id:"first_quiz",title:"F√∂rsta testet",titleAr:"ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ£ŸàŸÑ",description:"Avsluta ditt f√∂rsta quiz",icon:"üéØ",condition:()=>f.getStats().totalQuizzes>=1},{id:"streak_5",title:"5 i rad",titleAr:"5 ŸÖÿ™ÿ™ÿßŸÑŸäÿ©",description:"F√• 5 r√§tt svar i rad",icon:"üî•",condition:()=>f.getStats().bestStreak>=5},{id:"streak_10",title:"10 i rad",titleAr:"10 ŸÖÿ™ÿ™ÿßŸÑŸäÿ©",description:"F√• 10 r√§tt svar i rad",icon:"‚ö°",condition:()=>f.getStats().bestStreak>=10},{id:"correct_50",title:"50 r√§tt",titleAr:"50 ÿµÿ≠Ÿäÿ≠",description:"Svara r√§tt p√• 50 fr√•gor totalt",icon:"üìö",condition:()=>f.getStats().totalCorrect>=50},{id:"correct_100",title:"100 r√§tt",titleAr:"100 ÿµÿ≠Ÿäÿ≠",description:"Svara r√§tt p√• 100 fr√•gor totalt",icon:"üèÜ",condition:()=>f.getStats().totalCorrect>=100},{id:"correct_500",title:"Ordm√§stare",titleAr:"ÿ≥ŸäÿØ ÿßŸÑŸÉŸÑŸÖÿßÿ™",description:"Svara r√§tt p√• 500 fr√•gor totalt",icon:"üëë",condition:()=>f.getStats().totalCorrect>=500},{id:"speed_demon",title:"Snabbt√§nkt",titleAr:"ÿ≥ÿ±Ÿäÿπ ÿßŸÑÿ®ÿØŸäŸáÿ©",description:"Svara p√• under 2 sekunder",icon:"‚è±Ô∏è",condition:()=>f.getStats().fastestResponse<2e3},{id:"perfect_10",title:"Perfekt 10",titleAr:"ÿπÿ¥ÿ±ÿ© ŸÖÿ´ÿßŸÑŸäÿ©",description:"F√• 10/10 i ett quiz",icon:"üíØ",condition:()=>!1},{id:"accuracy_90",title:"Tr√§ffs√§ker",titleAr:"ÿØŸÇÿ© ÿπÿßŸÑŸäÿ©",description:"Uppn√• 90% noggrannhet (minst 50 svar)",icon:"üéØ",condition:()=>{const h=f.getStats();return h.totalCorrect+h.totalWrong>=50&&f.getAccuracy()>=90}},{id:"quiz_10",title:"Flitig √∂vare",titleAr:"ŸÖÿ™ÿØÿ±ÿ® ŸÖÿ¨ÿ™ŸáÿØ",description:"Avsluta 10 quiz",icon:"üìù",condition:()=>f.getStats().totalQuizzes>=10}];class Y{constructor(){d(this,"STORAGE_KEY","achievements");d(this,"unlocked");this.unlocked=this.load()}load(){const t=localStorage.getItem(this.STORAGE_KEY);return t?new Set(JSON.parse(t)):new Set}save(){localStorage.setItem(this.STORAGE_KEY,JSON.stringify(Array.from(this.unlocked)))}check(){const t=[];for(const e of b)!this.unlocked.has(e.id)&&e.condition()&&(this.unlock(e),t.push(e));return t}unlock(t){this.unlocked.has(t.id)||(this.unlocked.add(t.id),this.save(),B(`${t.icon} ${t.title} - ${t.titleAr}`),this.playCelebration())}unlockById(t){const e=b.find(i=>i.id===t);e&&this.unlock(e)}playCelebration(){}getUnlocked(){return b.filter(t=>this.unlocked.has(t.id))}getLocked(){return b.filter(t=>!this.unlocked.has(t.id))}getProgress(){return{unlocked:this.unlocked.size,total:b.length,percent:Math.round(this.unlocked.size/b.length*100)}}getAll(){return b}}const _=new Y;typeof window<"u"&&(window.Achievements=_);const R={hund:"üê∂",katt:"üê±",mus:"üê≠",hamster:"üêπ",kanin:"üê∞",bj√∂rn:"üêª",panda:"üêº",tiger:"üêØ",lejon:"ü¶Å",ko:"üêÆ",gris:"üê∑",groda:"üê∏",apa:"üêµ",kyckling:"üêî",pingvin:"üêß",f√•gel:"üê¶",anka:"ü¶Ü",√∂rn:"ü¶Ö",uggla:"ü¶â",varg:"üê∫",h√§st:"üê¥",enh√∂rning:"ü¶Ñ",bi:"üêù",mask:"üêõ",fj√§ril:"ü¶ã",snigel:"üêå",spindel:"üï∑",sk√∂ldpadda:"üê¢",orm:"üêç",√∂dla:"ü¶é",fisk:"üêü",delfin:"üê¨",val:"üêã",haj:"ü¶à",bl√§ckfisk:"üêô",krabba:"ü¶Ä",kamel:"üê´",elefant:"üêò",nosh√∂rning:"ü¶è",gorilla:"ü¶ç",giraff:"ü¶í",krokodil:"üêä",zebra:"ü¶ì",√§pple:"üçé",p√§ron:"üçê",apelsin:"üçä",citron:"üçã",banan:"üçå",vattenmelon:"üçâ",vindruvor:"üçá",jordgubbe:"üçì",k√∂rsb√§r:"üçí",persika:"üçë",ananas:"üçç",kokosn√∂t:"ü••",kiwi:"ü•ù",tomat:"üçÖ",potatis:"ü•î",morot:"ü•ï",majs:"üåΩ",l√∂k:"üßÖ",vitl√∂k:"üßÑ",gurka:"ü•í",br√∂d:"üçû",croissant:"ü•ê",pannkaka:"ü•û",ost:"üßÄ",k√∂tt:"ü•©",bacon:"ü•ì",hamburgare:"üçî","pommes frites":"üçü",pizza:"üçï",korv:"üå≠",tacos:"üåÆ",burrito:"üåØ",√§gg:"ü•ö",popcorn:"üçø",ris:"üçö",spaghetti:"üçù",sushi:"üç£",glass:"üç¶",munk:"üç©",kaka:"üç™",t√•rta:"üéÇ",choklad:"üç´",godis:"üç¨",klubba:"üç≠",mj√∂lk:"ü•õ",kaffe:"‚òï",te:"üçµ",√∂l:"üç∫",vin:"üç∑",bil:"üöó",taxi:"üöï",buss:"üöå",t√•g:"üöÜ",brandbil:"üöí",polisbil:"üöì",ambulans:"üöë",cykel:"üö≤",motorcykel:"üèç",traktor:"üöú",flygplan:"‚úàÔ∏è",helikopter:"üöÅ",b√•t:"‚õµ",raket:"üöÄ",klocka:"‚åö",mobil:"üì±",dator:"üíª",tangentbord:"‚å®Ô∏è",kamera:"üì∑",video:"üìπ",teve:"üì∫",radio:"üìª",bok:"üìñ",penna:"‚úèÔ∏è",sax:"‚úÇÔ∏è",nyckel:"üîë",hammare:"üî®",yxa:"ü™ì",sv√§rd:"‚öîÔ∏è",pistol:"üî´",sk√∂ld:"üõ°",paraply:"‚òÇÔ∏è",glas√∂gon:"üëì",v√§ska:"üëú",sko:"üëû",kl√§nning:"üëó",byxor:"üëñ",tr√∂ja:"üëï",sol:"‚òÄÔ∏è",m√•ne:"üåô",stj√§rna:"‚≠ê",moln:"‚òÅÔ∏è",regn:"üåß",sn√∂:"‚ùÑÔ∏è",eld:"üî•",vatten:"üíß",tr√§d:"üå≥",blomma:"üå∏",ros:"üåπ",kaktus:"üåµ",fotboll:"‚öΩ",baseboll:"‚öæ",basket:"üèÄ",tennis:"üéæ",golf:"‚õ≥",medalj:"ü•á",pokal:"üèÜ",leende:"üòÑ",hj√§rta:"‚ù§Ô∏è",sp√∂ke:"üëª",utomjording:"üëΩ",robot:"ü§ñ",skelett:"üíÄ"};class K{constructor(){d(this,"data",[]);d(this,"questions",[]);d(this,"currentIndex",0);d(this,"score",0);d(this,"isAnswered",!1);d(this,"container",null);d(this,"currentWord",null);d(this,"mode","normal");d(this,"questionCount",10);d(this,"timerSeconds",10);d(this,"timerInterval",null);d(this,"timeLeft",0);this.container=document.getElementById("quizInlineContainer"),this.init()}init(){const t=document.getElementById("quickQuizBtn"),e=document.getElementById("quizBtn"),i=document.getElementById("closeQuiz"),n=document.getElementById("nextQuestion"),s=document.getElementById("restartQuiz"),o=document.getElementById("quizModeSelect");t&&(t.onclick=()=>this.start()),e&&(e.onclick=()=>this.start()),i&&(i.onclick=()=>this.hide()),n&&(n.onclick=()=>this.next()),s&&(s.onclick=()=>this.start()),o&&(o.onchange=()=>{this.mode=o.value,console.log("[Quiz] Mode changed to:",this.mode),this.container&&!this.container.classList.contains("hidden")&&this.start()},this.mode=o.value);const a=document.getElementById("quizFavBtn");a&&(a.onclick=()=>this.toggleCurrentFavorite(a)),document.addEventListener("keydown",r=>this.handleKeyboard(r)),window.addEventListener("dictionaryLoaded",()=>{this.data=window.dictionaryData||[]}),window.dictionaryData&&(this.data=window.dictionaryData)}handleKeyboard(t){if(!(!this.container||this.container.classList.contains("hidden"))){if(t.key>="1"&&t.key<="4"){const e=parseInt(t.key)-1,i=document.querySelectorAll(".quiz-option");i[e]&&i[e].click()}(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this.isAnswered&&this.next())}}start(t){if(t&&(this.mode=t),!this.data||this.data.length<5){B("Laddar ordbok... / ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿßŸÖŸàÿ≥ ‚è≥");return}if(this.questions=this.getQuestions(),this.questions.length===0){B("Inga ord tillg√§ngliga f√∂r detta l√§ge / ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÉŸÑŸÖÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ©");return}this.currentIndex=0,this.score=0,this.isAnswered=!1,f.resetSession(),this.container=document.getElementById("quizInlineContainer"),this.container?(this.container.classList.remove("hidden"),this.container.scrollIntoView({behavior:"smooth",block:"center"}),console.log("[Quiz] Container shown:",this.container)):console.error("[Quiz] Container element NOT FOUND!");const e=document.getElementById("quizEndScreen");e&&e.classList.add("hidden");const i=document.querySelector(".quiz-body");i&&Array.from(i.children).forEach(n=>{n.id!=="quizEndScreen"&&(n.style.display="block")}),this.updateProgressBar(),this.showQuestion(),this.updateScore()}hide(){this.stopTimer(),f.endSession(),this.container&&this.container.classList.add("hidden")}getQuestions(){let t=[];switch(this.mode){case"favorites":const i=I.getAll();t=this.data.filter(s=>i.includes(s[0].toString()));break;case"weak":const n=f.getWeakWords(20);t=this.data.filter(s=>n.includes(s[0].toString())),t.length<5&&(t=this.data);break;case"picture":t=this.data.filter(s=>{const o=(s[2]||"").toLowerCase().trim();return R.hasOwnProperty(o)});break;case"sentence":t=this.data.filter(s=>{const o=(s[2]||"").toLowerCase().trim(),a=(s[7]||"").toLowerCase();return a.length>5&&a.includes(o)});break;default:t=this.data}const e=[...t].sort(()=>.5-Math.random());return e.slice(0,Math.min(this.questionCount,e.length))}showQuestion(){const t=this.questions[this.currentIndex];this.currentWord=t;const e=t[2],i=t[3];let n="",s="",o="arb",a=!1;if(this.mode==="reverse")n=i,s=e,o="swe";else if(this.mode==="listening")n="üîä Lyssna och v√§lj r√§tt ord",s=i,T.speak(e,"sv");else if(this.mode==="picture"){const y=(e||"").toLowerCase().trim();n=R[y]||"‚ùì",s=e,o="swe",a=!0}else if(this.mode==="sentence"){const y=(e||"").toLowerCase().trim(),w=t[7]||"",E=new RegExp(y,"gi");n=w.replace(E,"_______"),s=e,o="swe"}else n=e,s=i;const r=document.getElementById("quizQuestion");r&&(r.textContent=n,a?(r.style.fontSize="4.5rem",r.dir="ltr"):this.mode==="sentence"?(r.style.fontSize="1.4rem",r.style.direction="ltr"):(r.style.fontSize="",r.dir=this.mode==="reverse"?"rtl":"ltr",k.apply(r,n)));const c=document.getElementById("quizExample");if(c)if(this.mode==="listening")c.textContent="";else if(this.mode==="picture")c.textContent="Vilket ord √§r detta? / ŸÖÿß Ÿáÿ∞Ÿá ÿßŸÑŸÉŸÑŸÖÿ©ÿü",k.apply(c,c.textContent);else if(this.mode==="sentence")c.textContent="Vilket ord saknas? / ÿ£Ÿä ŸÉŸÑŸÖÿ© ŸÖŸÅŸÇŸàÿØÿ©ÿü";else{const y=t[7]||"";c.textContent=y,k.apply(c,y)}const l=document.getElementById("quizHelp");l&&(this.mode==="normal"?l.classList.remove("hidden"):l.classList.add("hidden"));const g=document.getElementById("quizOptions");if(g){console.log("[Quiz] Found optionsEl, clearing content"),g.innerHTML="";const y=this.generateOptions(t,o);console.log("[Quiz] Generated options:",y),y.length===0&&console.error("[Quiz] Options array is EMPTY!"),y.forEach((w,E)=>{console.log("[Quiz] Creating button for:",w);const S=document.createElement("button");S.className="quiz-option",S.textContent=w,S.dir=o==="arb"?"rtl":"ltr",k.apply(S,w),S.setAttribute("data-key",(E+1).toString()),S.onclick=()=>this.handleAnswer(w,s,S),g.appendChild(S)}),console.log("[Quiz] Appended buttons. Children count:",g.children.length)}else console.error("[Quiz] optionsEl NOT FOUND!");const u=document.getElementById("quizFeedback");u&&(u.textContent="",u.className="quiz-feedback");const p=document.getElementById("nextQuestion");p&&(p.disabled=!0),this.isAnswered=!1,this.mode==="timed"&&this.startTimer(),f.startQuestion(),this.mode==="normal"&&T.speak(e,"sv"),this.updateProgressBar()}generateOptions(t,e){const i=e==="arb"?t[3]:t[2],n=t[1],s=[],o=this.data.filter(c=>c[1]===n&&c[0]!==t[0]),r=[...o.length>=3?o:this.data].sort(()=>.5-Math.random());for(const c of r){if(s.length>=3)break;const l=e==="arb"?c[3]:c[2];l!==i&&!s.includes(l)&&s.push(l)}return[i,...s].sort(()=>.5-Math.random())}handleAnswer(t,e,i){if(this.isAnswered)return;this.isAnswered=!0,this.stopTimer();const n=t===e,s=this.currentWord[0].toString(),o=f.recordAnswer(s,n),a=window.app;if(a&&(typeof a.updateDailyChallenge=="function"&&a.updateDailyChallenge(),typeof a.updateDailyProgressBar=="function"&&a.updateDailyProgressBar()),n){this.score++,i.classList.add("correct");const c=f.formatTime(o);this.showFeedback(`R√§tt! ${c} / ÿµÿ≠Ÿäÿ≠ ‚úÖ`,!0)}else i.classList.add("wrong"),$.updateTrainingStatus(s,!0).then(()=>{B("Tillagd i din tr√§ning üí™ / ÿ™ŸÖÿ™ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ™ÿØÿ±Ÿäÿ®")}),this.showFeedback(`Fel! R√§tt: ${e} / ÿÆÿ∑ÿ£ ‚ùå`,!1),document.querySelectorAll(".quiz-option").forEach(c=>{c.textContent===e&&c.classList.add("correct")});this.updateScore();const r=document.getElementById("nextQuestion");r&&(r.disabled=!1),this.mode==="reverse"||this.mode==="picture"||this.mode==="sentence"?T.speak(e,"sv"):T.speak(e,"ar")}startTimer(){this.timeLeft=this.timerSeconds,this.updateTimerDisplay(),this.timerInterval=window.setInterval(()=>{this.timeLeft--,this.updateTimerDisplay(),this.timeLeft<=0&&(this.stopTimer(),this.timeOut())},1e3)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null)}updateTimerDisplay(){const t=document.getElementById("quizTimer");t&&(t.textContent=this.timeLeft.toString(),t.classList.toggle("warning",this.timeLeft<=3))}timeOut(){if(this.isAnswered)return;this.isAnswered=!0;const t=this.currentWord[0].toString();f.recordAnswer(t,!1),$.updateTrainingStatus(t,!0).then(()=>{B("Tillagd i din tr√§ning üí™ / ÿ™ŸÖÿ™ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ™ÿØÿ±Ÿäÿ®")}),this.showFeedback("Tiden √§r slut! / ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™ ‚è±Ô∏è",!1);const e=this.mode==="reverse"||this.mode==="picture"||this.mode==="sentence"?this.currentWord[2]:this.currentWord[3];document.querySelectorAll(".quiz-option").forEach(n=>{n.textContent===e&&n.classList.add("correct")}),this.updateScore();const i=document.getElementById("nextQuestion");i&&(i.disabled=!1)}showFeedback(t,e){const i=document.getElementById("quizFeedback");i&&(i.textContent=t,i.className=`quiz-feedback ${e?"correct":"wrong"}`)}updateScore(){const t=document.getElementById("quizScore");t&&(t.textContent=this.score.toString())}updateProgressBar(){const t=document.getElementById("quizProgress");if(t){const i=this.currentIndex/this.questions.length*100;t.style.width=`${i}%`}const e=document.getElementById("quizProgressText");e&&(e.textContent=`${this.currentIndex+1}/${this.questions.length}`)}toggleCurrentFavorite(t){if(!this.currentWord)return;const e=this.currentWord[0].toString(),i=I.toggle(e);t.classList.toggle("active",i);const n=t.querySelector("svg");n&&(i?(n.setAttribute("fill","#ef4444"),n.setAttribute("stroke","#ef4444")):(n.setAttribute("fill","none"),n.setAttribute("stroke","currentColor")))}next(){this.currentIndex++,this.currentIndex<this.questions.length?this.showQuestion():this.end()}end(){this.stopTimer(),f.endSession();const t=f.getSessionStats(),e=f.getTodayStats(),i=document.getElementById("quizEndScreen");if(i){i.classList.remove("hidden");const s=document.getElementById("endScoreValue");s&&(s.textContent=this.score.toString());const o=document.getElementById("endMessage");o&&(this.score===this.questions.length?(o.innerHTML=`üéâ Perfekt! B√§sta serien: ${t.bestStreak}`,this.showConfetti(),_.unlockById("perfect_10")):this.score>=this.questions.length*.8?o.innerHTML=`Fantastiskt! Tid: ${f.formatTime(t.avgTime)}`:this.score>=this.questions.length*.5?o.textContent="Bra jobbat! / ÿ¨ŸäÿØ ÿ¨ÿØÿßŸã üëç":o.textContent="Forts√§tt √∂va! / ÿßÿ≥ÿ™ŸÖÿ± ŸÅŸä ÿßŸÑÿ™ÿØÿ±Ÿäÿ® üí™",k.apply(o,o.textContent||"",2));const a=document.getElementById("endStats");a&&(a.innerHTML=`
                    <div class="end-stat"><span>üìÖ Idag:</span> ${e.correct}/${e.total}</div>
                    <div class="end-stat"><span>üî• B√§sta serien:</span> ${t.bestStreak}</div>
                    <div class="end-stat"><span>‚è±Ô∏è Snitttid:</span> ${f.formatTime(t.avgTime)}</div>
                `)}const n=document.querySelector(".quiz-body");n&&Array.from(n.children).forEach(s=>{s.id!=="quizEndScreen"&&(s.style.display="none")})}showConfetti(){const t=this.container;if(t)for(let e=0;e<50;e++){const i=document.createElement("div");i.className="confetti",i.style.left=Math.random()*100+"%",i.style.animationDelay=Math.random()*2+"s",i.style.backgroundColor=["#10B981","#1e3a8a","#F59E0B","#EF4444","#3b82f6"][Math.floor(Math.random()*5)],t.appendChild(i),setTimeout(()=>i.remove(),3e3)}}}typeof window<"u"&&(window.QuizManager=new K);class X{constructor(){d(this,"canvas",null);d(this,"ctx",null);d(this,"particles",[]);d(this,"animationId",null);d(this,"isActive",!1);d(this,"colors",["#FFD700","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE"]);d(this,"animate",()=>{!this.ctx||!this.canvas||(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.particles=this.particles.filter(t=>(t.x+=t.velocityX,t.y+=t.velocityY,t.velocityY+=.5,t.rotation+=t.rotationSpeed,t.opacity-=.005,t.velocityX*=.99,t.opacity>0?(this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation*Math.PI/180),this.ctx.globalAlpha=t.opacity,this.ctx.fillStyle=t.color,this.ctx.fillRect(-t.size/2,-t.size/4,t.size,t.size/2),this.ctx.restore(),!0):!1)),this.particles.length>0?this.animationId=requestAnimationFrame(this.animate):(this.isActive=!1,this.animationId&&cancelAnimationFrame(this.animationId)))})}init(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.id="confetti-canvas",this.canvas.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99999;
        `,document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.resize(),window.addEventListener("resize",()=>this.resize()))}resize(){this.canvas&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight)}createParticle(t,e){return{x:t,y:e,size:Math.random()*10+5,color:this.colors[Math.floor(Math.random()*this.colors.length)],velocityX:(Math.random()-.5)*15,velocityY:Math.random()*-15-10,rotation:Math.random()*360,rotationSpeed:(Math.random()-.5)*10,opacity:1}}burst(t,e,i=50){this.init();const n=t??window.innerWidth/2,s=e??window.innerHeight/3;for(let o=0;o<i;o++)this.particles.push(this.createParticle(n,s));this.isActive||(this.isActive=!0,this.animate())}rain(t=3e3){this.init();const e=setInterval(()=>{for(let i=0;i<5;i++){const n=this.createParticle(Math.random()*window.innerWidth,-20);n.velocityY=Math.random()*3+2,n.velocityX=(Math.random()-.5)*2,this.particles.push(n)}},50);setTimeout(()=>clearInterval(e),t),this.isActive||(this.isActive=!0,this.animate())}celebrate(){this.burst(window.innerWidth/2,window.innerHeight/2,100),setTimeout(()=>{this.burst(window.innerWidth*.25,window.innerHeight/2,50),this.burst(window.innerWidth*.75,window.innerHeight/2,50)},200)}stop(){this.particles=[],this.isActive=!1,this.animationId&&cancelAnimationFrame(this.animationId),this.ctx&&this.canvas&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}const J=new X;typeof window<"u"&&(window.Confetti=J);class C{static add(t){const e=t.trim();if(!e)return;const n=this.get().filter(o=>o.toLowerCase()!==e.toLowerCase());n.unshift(e);const s=n.slice(0,this.MAX_ITEMS);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(s))}static get(){try{const t=localStorage.getItem(this.STORAGE_KEY);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load search history",t),[]}}static clear(){localStorage.removeItem(this.STORAGE_KEY)}}d(C,"MAX_ITEMS",10),d(C,"STORAGE_KEY",N.STORAGE_KEYS.SEARCH_HISTORY||"searchHistory");function Z(){console.log("Initializing Main UI..."),tt(),et(),it(),nt(),st(),ot(),at()}function tt(){const h=localStorage.getItem("theme")||"dark";if(h==="auto"){const t=new Date().getHours(),e=t>=18||t<7;document.documentElement.setAttribute("data-theme",e?"dark":"light")}else document.documentElement.setAttribute("data-theme",h)}function et(){const h=document.getElementById("mobileViewToggle");h&&h.addEventListener("click",()=>{var t;(t=window.MobileViewManager)==null||t.toggle()}),window.toggleMobileView=()=>{var t;return(t=window.MobileViewManager)==null?void 0:t.toggle()}}function it(){const h=document.getElementById("progressBadge"),t=document.getElementById("progressModal"),e=document.getElementById("closeProgress");h&&t&&h.addEventListener("click",()=>{t.style.display="flex",t.classList.remove("hidden")}),e&&t&&(e.addEventListener("click",()=>{t.style.display="none"}),t.addEventListener("click",i=>{i.target===t&&(t.style.display="none")}))}function nt(){const h=document.getElementById("quickWodBtn"),t=document.getElementById("storyRingTrigger"),e=()=>{window.location.href="word-dna.html"};h&&h.addEventListener("click",e),t&&t.addEventListener("click",e);const i=document.getElementById("quickFavBtn");i&&i.addEventListener("click",()=>{var o;(o=window.app)==null||o.performSearch("favorites")});const n=document.getElementById("quickQuizBtn");n&&n.addEventListener("click",()=>{var o,a;(a=(o=window.QuizManager)==null?void 0:o.start)==null||a.call(o)});const s=document.getElementById("quickHomeBtn");s&&s.addEventListener("click",()=>{const o=document.getElementById("searchInput");o&&(o.value="",o.dispatchEvent(new Event("input",{bubbles:!0})),o.focus());const a=document.getElementById("quizInlineContainer");a&&a.classList.add("hidden");const r=document.getElementById("landingPageContent"),c=document.getElementById("searchResults");r&&r.classList.remove("hidden"),c&&(c.innerHTML="",c.classList.remove("active"))})}function st(){const h=document.getElementById("onboardingModal");if(!h)return;const t=document.querySelectorAll(".onboarding-slide"),e=document.querySelectorAll(".dot"),i=document.getElementById("nextSlide"),n=document.getElementById("prevSlide"),s=document.getElementById("skipOnboarding");let o=0;const a=t.length;localStorage.getItem("onboardingComplete")||(h.style.display="flex",h.classList.remove("hidden"));function r(l){t.forEach((u,p)=>u.classList.toggle("active",p===l)),e.forEach((u,p)=>u.classList.toggle("active",p===l)),n&&(n.style.visibility=l===0?"hidden":"visible"),i&&(i.textContent=l===a-1?"B√∂rja! üöÄ":"N√§sta ‚ü∂");const g=t[l];g&&g.querySelectorAll("h2, p").forEach(u=>{k.apply(u,u.textContent||"")})}function c(){localStorage.setItem("onboardingComplete","true"),h.style.opacity="0",setTimeout(()=>{h.style.display="none"},300)}i&&i.addEventListener("click",()=>{o<a-1?(o++,r(o)):c()}),n&&n.addEventListener("click",()=>{o>0&&(o--,r(o))}),s&&s.addEventListener("click",c),e.forEach((l,g)=>{l.addEventListener("click",()=>{o=g,r(o)})})}function ot(){const h=document.getElementById("saveGoalBtn"),t=document.getElementById("dailyGoalInput");h&&t&&h.addEventListener("click",()=>{var e,i;localStorage.setItem("dailyGoal",t.value),(e=window.app)==null||e.updateDailyProgressBar(),(i=window.showToast)==null||i.call(window,"M√•l sparat! / ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸáÿØŸÅ üéØ")})}function at(){document.querySelectorAll(".game-card h3, .section-title, .stat-label").forEach(h=>{k.apply(h,h.textContent||"")})}class rt{constructor(){d(this,"isLoading",!0);d(this,"searchIndex",[]);d(this,"searchIndexArabic",[]);d(this,"currentResults",[]);d(this,"BATCH_SIZE",20);d(this,"renderedCount",0);d(this,"activeFilterMode","all");d(this,"activeTypeFilter","all");d(this,"activeSortMethod","relevance");d(this,"typeCategoryCache",new Map);d(this,"debouncedSearch");d(this,"currentQuery","");d(this,"typeCountsNeedUpdate",!0);d(this,"trainingIds",new Set);this.debouncedSearch=U(t=>{this.performSearchInternal(t)},150),this.init()}async init(){G.init(),Z(),W.checkCacheAndLoad(),this.initStreaks(),this.setupSearchListeners(),this.setupThemeListener(),this.initQuickActions(),this.setupInfiniteScroll(),this.setupGlobalHandlers(),this.setupFilters(),this.setupVoiceSearch(),this.setupVoiceSelection(),this.setupKeyboardShortcuts(),this.updateDailyChallenge(),this.updateDailyProgressBar();const e=new URLSearchParams(window.location.search).get("s");if(e){const i=document.getElementById("searchInput");i&&(i.value=e)}window.addEventListener("dictionaryLoaded",()=>{console.log("[App] Data loaded event received"),this.handleDataLoaded()}),window.dictionaryData&&window.dictionaryData.length>0&&this.handleDataLoaded(),window.addEventListener("pageshow",i=>{if(i.persisted&&(console.log("[App] Restoring from BFCache"),window.dictionaryData&&window.dictionaryData.length>0)){const s=new URLSearchParams(window.location.search).get("s"),o=document.getElementById("searchInput");s&&o&&(o.value=s,this.performSearch(s))}})}initStreaks(){const t="lastVisitDate",e="dailyStreak",i=new Date().toISOString().split("T")[0],n=localStorage.getItem(t);let s=parseInt(localStorage.getItem(e)||"0");if(n!==i){const a=new Date;a.setDate(a.getDate()-1);const r=a.toISOString().split("T")[0];n===r?s++:s=1,localStorage.setItem(t,i),localStorage.setItem(e,s.toString())}const o=document.getElementById("currentStreak");o&&(o.innerHTML=s.toString())}setupThemeListener(){const t=document.getElementById("themeToggle");t&&t.addEventListener("click",()=>{j.toggle()})}setupSearchListeners(){const t=document.getElementById("searchInput");if(!t)return;t.addEventListener("input",n=>this.handleSearch(n)),t.addEventListener("keydown",n=>{if(n.key==="Enter"){const s=t.value.trim();s&&C.add(s)}});const e=document.getElementById("clearSearch"),i=()=>{e&&(t.value.length>0?(e.classList.remove("hidden"),e.style.display="flex"):(e.classList.add("hidden"),e.style.display=""))};t.addEventListener("input",()=>{i()}),setTimeout(()=>{i()},100),e&&e.addEventListener("click",()=>{t.value="",e.classList.add("hidden"),e.style.display="",this.performSearch("")})}setupFilters(){const t=document.getElementById("filterModeSelect"),e=document.getElementById("typeSelect"),i=document.getElementById("sortSelect"),n=document.getElementById("quickFavBtn"),s=()=>{t&&(this.activeFilterMode=t.value),e&&(this.activeTypeFilter=e.value),i&&(this.activeSortMethod=i.value);const r=document.getElementById("searchInput");this.performSearch((r==null?void 0:r.value)||"")};t&&t.addEventListener("change",s),e&&e.addEventListener("change",s),i&&i.addEventListener("change",s),n&&n.addEventListener("click",()=>{t&&(t.value=t.value==="favorites"?"all":"favorites",s())});const o=document.getElementById("filterToggleBtn"),a=document.getElementById("filterChipsContainer");o&&a&&o.addEventListener("click",()=>{a.classList.toggle("hidden"),o.classList.toggle("active")})}setupKeyboardShortcuts(){if(document.addEventListener("keydown",t=>{var e,i;if(t.key==="/"&&((e=document.activeElement)==null?void 0:e.tagName)!=="INPUT"&&((i=document.activeElement)==null?void 0:i.tagName)!=="TEXTAREA"){t.preventDefault();const n=document.getElementById("searchInput");n&&n.focus()}}),window.innerWidth>768&&!("ontouchstart"in window)){const t=document.getElementById("searchInput");t&&setTimeout(()=>t.focus(),100)}}async handleDataLoaded(){if(!this.isLoading)return;this.isLoading=!1,console.log("[App] Data loaded, initializing...");const t=document.getElementById("loader");t&&(t.style.display="none");const e=window.dictionaryData;if(!e)return;try{const{DictionaryDB:r}=await D(async()=>{const{DictionaryDB:l}=await import("./db-CUAitF01.js");return{DictionaryDB:l}},__vite__mapDeps([0,1]));await r.init();const c=await r.getTrainingWords();this.trainingIds=new Set(c.map(l=>{var g,u;return Array.isArray(l)?(g=l[0])==null?void 0:g.toString():(u=l.id)==null?void 0:u.toString()}).filter(Boolean)),console.log("[App] Loaded training words:",this.trainingIds.size)}catch(r){console.error("[App] Failed to load training words:",r)}console.time("[Perf] Building search index"),this.searchIndex=e.map(r=>r[2].toLowerCase()),this.searchIndexArabic=e.map(r=>q(r[3]||"").toLowerCase()),this.typeCategoryCache.clear(),e.forEach((r,c)=>{const l=`${c}`,g=L.getCategory(r[1],r[2],r[6],r[13]||"",r[3]||"");this.typeCategoryCache.set(l,g)}),console.timeEnd("[Perf] Building search index"),this.initWordOfTheDay();const n=new URLSearchParams(window.location.search).get("s"),s=sessionStorage.getItem("snabbaLexin_lastSearch"),o=document.getElementById("searchInput"),a=n||s||(o==null?void 0:o.value.trim())||"";if(console.log("[Debug] Persistence | URL:",n,"| Session:",s,"| Input:",o==null?void 0:o.value,"| Using:",a),a){if(console.log("[Debug] Restoring search:",a),o&&(o.value=a),!n&&s&&window.history.replaceState){const r=`${window.location.pathname}?s=${encodeURIComponent(s)}`;window.history.replaceState({path:r},"",r)}this.performSearch(a)}else console.log("[Debug] No search state found, showing landing page."),this.performSearch("");this.updateDailyChallenge(),this.updateTypeCounts(e)}updateTypeCounts(t){console.time("[Perf] updateTypeCounts");const e={},i=window.dictionaryData;t.forEach(s=>{const o=i.indexOf(s);let a;o!==-1&&this.typeCategoryCache.has(`${o}`)?a=this.typeCategoryCache.get(`${o}`):a=L.getCategory(s[1],s[2],s[6],s[13]||"",s[3]||"");let r=a;a==="noun"&&(r="subst"),a==="conj"&&(r="konj"),a==="pronoun"&&(r="pron"),(a==="phrase"||a==="phrasal")&&(r="fras"),a==="prep"&&(r="prep"),a==="adj"&&(r="adj"),a==="adv"&&(r="adv");const c=(s[1]||"").toLowerCase();c.includes("interj")&&(r="interj"),(c.includes("r√§kne")||c.includes("num"))&&(r="num"),e[r]=(e[r]||0)+1,c.includes("juridik")&&(e.juridik=(e.juridik||0)+1),c.includes("medicin")&&(e.medicin=(e.medicin||0)+1),(c.includes("data")||c.includes("dator")||c.includes("it")||c.includes("teknik"))&&(e.it=(e.it||0)+1),(c.includes("politik")||c.includes("samh√§ll"))&&(e.politik=(e.politik||0)+1),(c.includes("religion")||c.includes("islam")||c.includes("krist")||c.includes("bibel")||c.includes("koran"))&&(e.religion=(e.religion||0)+1)});const n=document.getElementById("typeSelect");n&&(Array.from(n.querySelectorAll("option")).forEach(s=>{var a;const o=s.value;if(o==="all"){s.textContent=`Alla (${t.length})`;return}if(e[o]){const r=(a=s.textContent)==null?void 0:a.split(" (")[0].trim();s.textContent=`${r} (${e[o]})`}}),console.timeEnd("[Perf] updateTypeCounts"))}initWordOfTheDay(){const t=window.dictionaryData;if(!t||t.length===0)return;let e=null,i=0;for(;i<500;){const n=Math.floor(Math.random()*t.length),s=t[n],o=s[9]&&s[9].length>0||s[10]&&s[10].length>0,a=s[7]&&s[7].split(" ").length>5;if(o||a){e=s;break}i++}e||(e=t[Math.floor(Math.random()*t.length)]),f.recordStudy(e[0].toString()),this.renderWod(e)}renderWod(t){const e=document.getElementById("wordOfTheDay");if(!e)return;e.classList.remove("hidden");const i=e.querySelector(".wod-swe"),n=e.querySelector(".wod-arb"),s=e.querySelector(".wod-type-badge");i&&(i.textContent=t[2],k.apply(i,t[2])),n&&(n.textContent=t[3],k.apply(n,t[3])),s&&(s.textContent=t[1]),[".wod-forms-preview",".wod-def-preview",".wod-example-preview",".wod-example-arb-preview",".wod-idiom-preview"].forEach(u=>{const p=e.querySelector(u);p&&p.classList.add("hidden")});const a=document.getElementById("wodTTSBtn");a&&(a.onclick=()=>{var u;return(u=window.TTSManager)==null?void 0:u.speak(t[2],"sv")});const r=document.getElementById("wodDetailsBtn");r&&(r.onclick=()=>window.location.href=`details.html?id=${t[0]}`);const c=document.getElementById("wodLoopBtn");c&&(c.onclick=()=>this.initWordOfTheDay());const l=document.getElementById("wodFavBtn");if(l){const u=t[0].toString(),p=I.has(u);I.updateButtonIcon(l,p),l.onclick=()=>{const y=I.toggle(u);I.updateButtonIcon(l,y)}}const g=document.getElementById("wodTrainBtn");if(g){const u=t[0].toString(),p=this.trainingIds.has(u);g.classList.toggle("active",p),g.textContent=p?"üß†":"üí™",g.title=p?"Ta bort fr√•n tr√§ning":"L√§gg till i tr√§ning",g.onclick=y=>{window.toggleTraining(u,g,y)}}}initQuickActions(){}handleSearch(t){const e=t.target,i=e.value.trim();if(window.history.replaceState){const n=i?`${window.location.pathname}?s=${encodeURIComponent(i)}`:window.location.pathname;window.history.replaceState({path:n},"",n)}sessionStorage.setItem("snabbaLexin_lastSearch",i),this.debouncedSearch(e.value)}performSearch(t){this.performSearchInternal(t)}performSearchInternal(t){console.time("[Perf] performSearch");const e=t.toLowerCase().trim(),i=q(e);if(this.currentQuery=e,window.history.replaceState){const m=e?`${window.location.pathname}?s=${encodeURIComponent(e)}`:window.location.pathname;window.history.replaceState({path:m},"",m)}const n=window.dictionaryData||[];if(!n||n.length===0)return;const s=document.getElementById("landingPageContent"),o=document.getElementById("searchResults"),a=document.getElementById("emptyState");this.renderedCount=0;const r=[],c=[],l=[],g=document.getElementById("categorySelect"),u=this.activeFilterMode==="all"&&g&&g.value!=="all",p=this.activeTypeFilter!=="all",y=u&&g?g.value:"";if(!e&&this.activeFilterMode==="favorites"){const m=n.map((v,x)=>x).filter(v=>I.has(n[v][0].toString()));this.currentResults=m.map(v=>n[v]),this.finalizeSearch(s,o,a,e);return}if(!e&&!u&&!p&&this.activeFilterMode==="all"){s&&(s.style.display="block"),o&&(o.style.display="none"),a&&(a.style.display="block"),this.renderSearchHistory();return}for(let m=0;m<this.searchIndex.length;m++){const v=this.searchIndex[m],x=this.searchIndexArabic[m];if(p&&this.typeCategoryCache.get(`${m}`)!==this.activeTypeFilter||u&&!(n[m][11]||"").toLowerCase().includes(y))continue;let M=!1,z=!1,A=!1;if(e)if(v===e||x===i)M=!0;else if(v.startsWith(e)||x.startsWith(i))z=!0;else if(v.includes(e)||x.includes(i))A=!0;else continue;else A=!0;M?r.push(m):z?c.push(m):A&&l.push(m)}let w=[...r,...c,...l];this.activeSortMethod!=="relevance"&&(this.activeSortMethod==="az"?w.sort((m,v)=>this.searchIndex[m].localeCompare(this.searchIndex[v],"sv")):this.activeSortMethod==="za"&&w.sort((m,v)=>this.searchIndex[v].localeCompare(this.searchIndex[m],"sv")));const E=w.map(m=>n[m]);if(this.currentResults=E,!e&&this.activeFilterMode==="all")s&&(s.style.display="block"),o&&(o.style.display="none",o.innerHTML=""),a&&(a.style.display="block"),this.renderSearchHistory();else{if(s&&(s.style.display="none"),o&&(o.style.display="grid",o.innerHTML=""),a)if(a.style.display=E.length===0?"block":"none",E.length===0&&e.length>2)this.showDidYouMean(e,a);else{const m=a.querySelector(".suggestion-box");m&&m.remove()}this.renderNextBatch()}this.updateResultCount(),console.timeEnd("[Perf] performSearch")}finalizeSearch(t,e,i,n){if(t&&(t.style.display="none"),e&&(e.style.display="grid",e.innerHTML=""),i){const s=this.currentResults.length===0;if(i.style.display=s?"block":"none",s&&n.length>2)this.showDidYouMean(n,i);else{const o=i.querySelector(".suggestion-box");o&&o.remove()}}this.renderNextBatch(),this.updateResultCount()}renderSearchHistory(){const t=document.getElementById("landingPageContent");if(!t)return;let e=document.getElementById("searchHistorySection");if(!e){e=document.createElement("div"),e.id="searchHistorySection",e.className="landing-section fade-in-up";const n=t.querySelector(".hero-section");n&&n.nextSibling?t.insertBefore(e,n.nextSibling):t.appendChild(e)}const i=C.get();if(i.length===0){e.style.display="none";return}e.style.display="block",e.innerHTML=`
            <div class="section-header">
                <h3><span class="icon">üïí</span> <span class="sv-text">Senaste s√∂kningar</span><span class="ar-text">ÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿ£ÿÆŸäÿ±ÿ©</span></h3>
                <button class="clear-history-btn" onclick="window.app.clearHistory()">
                    <span class="sv-text">Rensa</span><span class="ar-text">ŸÖÿ≥ÿ≠</span>
                </button>
            </div>
            <div class="history-chips">
                ${i.map(n=>`
                    <button class="history-chip" onclick="window.app.performSearch('${n}')">
                        ${n}
                    </button>
                `).join("")}
            </div>
        `}clearHistory(){C.clear(),this.renderSearchHistory()}updateResultCount(){const t=this.currentResults.length,e=document.getElementById("resultCount");e&&(t>0?(e.textContent=`${t}`,e.style.display="block"):e.style.display="none")}renderNextBatch(){if(this.renderedCount>=this.currentResults.length)return;const t=document.getElementById("searchResults");if(!t)return;const e=this.currentResults.slice(this.renderedCount,this.renderedCount+this.BATCH_SIZE),i=e.map(n=>this.createCard(n,this.currentQuery)).join("");t.insertAdjacentHTML("beforeend",i),this.renderedCount+=e.length,k.autoApply()}createCard(t,e=""){const i=t[0],n=t[2],s=t[3],o=t[1],a=t[6]||"",r=t[13]||"",c=e?this.highlightText(n,e.toLowerCase()):n,l=e?this.highlightText(s,e.toLowerCase()):s,g=L.generateBadge(o,n,a,r,s),u=L.getDataType(o,n,a,r,s),p=I.has(i.toString()),y=this.trainingIds.has(i.toString()),w=p?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#F59E0B" stroke="#F59E0B" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>',E='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>',S='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>',m=a?`<div class="ghost-forms">${a}</div>`:"",v=parseInt(i)%4*33;return`
            <div class="card card-link compact-card" data-type="${u}" onclick="if(!event.target.closest('button')) window.location.href='details.html?id=${i}'">
                <div class="card-top-row">
                    ${g}
                    <div class="card-actions">
                        <button class="action-button audio-btn" onclick="speakText('${n.replace(/'/g,"\\'")}', 'sv'); event.stopPropagation();" title="Lyssna">
                            ${S}
                        </button>
                        <button class="copy-btn action-button" onclick="copyWord('${n.replace(/'/g,"\\'")}', event)" title="Kopiera">
                            ${E}
                        </button>
                        <!-- Training Button -->
                        <button class="action-button train-btn ${y?"active":""}" 
                                onclick="toggleTraining('${i}', this, event)" 
                                title="${y?"Ta bort fr√•n tr√§ning":"L√§gg till i tr√§ning"}"
                                data-id="${i}">
                            ${y?"üß†":"üí™"}
                        </button>
                        <button class="fav-btn action-button ${p?"active":""}" onclick="toggleFavorite('${i}', this, event)" title="Spara">
                            ${w}
                        </button>
                    </div>
                </div>
                <div class="card-main-content">
                    <h2 class="word-swe" dir="ltr" data-auto-size data-max-lines="1">${c}</h2>
                    ${m}
                    <p class="word-arb" dir="rtl" data-auto-size data-max-lines="1">${l}</p>
                </div>
                <!-- <div class="mastery-bar-container"><div class="mastery-fill" style="width: ${v}%"></div></div> -->
            </div>
        `}highlightText(t,e){if(!e||!t)return t;const i=t.replace(/[\u064B-\u065F]/g,""),n=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=new RegExp(`(${n})`,"gi"),o=[];let a;for(;(a=s.exec(i))!==null;){const c=a[1],l=a.index;let g=0;for(let u=0;u<t.length;u++){const p=t[u];if(!/[\u064B-\u065F]/.test(p)){if(g===l){const y=this.extractOriginalMatch(t,u,c);o.push({original:y,withoutDiacritics:c});break}g++}}}if(o.length===0)return t;let r=t;for(const c of o)r=r.replace(c.original,`<span class="search-highlight">${c.original}</span>`);return r}extractOriginalMatch(t,e,i){let n="",s=0,o=e;for(;s<i.length&&o<t.length;){const a=t[o];n+=a,/[\u064B-\u065F]/.test(a)||s++,o++}return n}showDidYouMean(t,e){const i=this.findDetailedSuggestion(t),n=e.querySelector(".suggestion-box");if(n&&n.remove(),i){const s=`
                <div class="suggestion-box" style="margin-top: 1rem; text-align: center;">
                    <p style="color: var(--text-muted); font-size: 0.9rem;">
                        <span class="sv-text">Menade du:</span>
                        <span class="ar-text">ŸáŸÑ ÿ™ŸÇÿµÿØ:</span>
                        <button class="suggestion-link" onclick="window.app.performSearch('${i.replace(/'/g,"\\'")}')" style="
                            background: none; 
                            border: none; 
                            color: var(--primary); 
                            text-decoration: underline; 
                            cursor: pointer; 
                            font-weight: bold;
                            font-size: 1rem;
                            margin: 0 5px;
                        ">${i}</button>?
                    </p>
                </div>
            `;e.insertAdjacentHTML("beforeend",s)}}findDetailedSuggestion(t){const e=this.searchIndex;let i=null,n=3;for(let s=0;s<e.length;s++){const o=e[s];if(Math.abs(o.length-t.length)>2)continue;const a=V(t,o);if(a<n&&(n=a,i=o),a===0)return o}return i}setupInfiniteScroll(){window.addEventListener("scroll",()=>{if(this.currentResults.length===0)return;const{scrollTop:t,scrollHeight:e,clientHeight:i}=document.documentElement;t+i>=e-300&&this.renderNextBatch()})}setupGlobalHandlers(){window.copyWord=(t,e)=>{e.stopPropagation(),navigator.clipboard.writeText(t).then(()=>B(P("toast.copied")+" üìã"))},window.toggleFavorite=(t,e,i)=>{i.stopPropagation();const n=t.toString(),s=I.toggle(n);e.classList.toggle("active",s),e.innerHTML=s?'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#F59E0B" stroke="#F59E0B" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>'},window.toggleTraining=async(t,e,i)=>{i.stopPropagation();const n=t.toString(),s=!this.trainingIds.has(n);s?(this.trainingIds.add(n),e.classList.add("active"),e.textContent="üß†",e.title="Ta bort fr√•n tr√§ning"):(this.trainingIds.delete(n),e.classList.remove("active"),e.textContent="üí™",e.title="L√§gg till i tr√§ning");try{const{DictionaryDB:o}=await D(async()=>{const{DictionaryDB:a}=await import("./db-CUAitF01.js");return{DictionaryDB:a}},__vite__mapDeps([0,1]));await o.updateTrainingStatus(n,s)}catch(o){console.error("Failed to update training status",o)}}}updateDailyChallenge(){const t=parseInt(localStorage.getItem("dailyGoal")||"10"),e=f.getTodayStats(),i=e.correct+(e.studied||0),n=Math.min(100,i/t*100),s=document.getElementById("challengeProgressBar");s&&(s.style.width=`${n}%`,i>=t&&s.classList.add("completed"));const o=document.getElementById("challengeProgressText");o&&(o.textContent=`${i}/${t}`,i>=t&&o.classList.add("completed"));const a=document.getElementById("dailyChallengeCard");a&&i>=t&&a.classList.add("completed"),console.log(`[App] Daily challenge: ${i}/${t} (${n.toFixed(0)}%)`),this.updateDailyProgressBar()}updateDailyProgressBar(){const t=parseInt(localStorage.getItem("dailyGoal")||"10"),e=f.getTodayStats(),i=e.correct+(e.studied||0),n=Math.min(100,i/t*100),s=document.getElementById("dailyProgressCount");s&&(s.textContent=i.toString());const o=document.getElementById("dailyWordsCount");o&&(o.textContent=i.toString());const a=document.getElementById("dailyProgressFill");a&&(a.style.width=`${n}%`,i>=t&&a.classList.add("completed"));const r=document.getElementById("progressRingValue");r&&(r.textContent=i.toString());const c=document.getElementById("progressRingGoal");c&&(c.textContent=t.toString());const l=document.querySelector(".progress-ring-circle");if(l){const u=314.159-n/100*314.159;l.style.strokeDashoffset=u.toString()}console.log(`[App] Daily progress: ${i}/${t} (${n.toFixed(0)}%)`)}setupVoiceSearch(){const t=document.getElementById("voiceSearchBtn"),e=document.getElementById("searchInput");!t||!e||(t.addEventListener("click",()=>{F.toggle()}),F.onResult=(i,n)=>{e.value=i,n&&(this.performSearch(i),B(`üé§ "${i}"`))})}setupVoiceSelection(){const t=document.querySelectorAll(".voice-selector-inline .voice-btn"),e=localStorage.getItem("ttsVoicePreference")||"natural";t.forEach(i=>{i.classList.toggle("active",i.getAttribute("data-voice")===e),i.addEventListener("click",n=>{n.stopPropagation();const s=i.getAttribute("data-voice");t.forEach(o=>o.classList.remove("active")),i.classList.add("active"),localStorage.setItem("ttsVoicePreference",s),B(`üó£Ô∏è ${P("settings.voiceChanged")||"R√∂sttyp √§ndrad"}`)})})}}typeof window<"u"&&(window.app=new rt);
