import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              *//* empty css              */import"./loader-DOLU1NFP.js";import"./games-utils-CmJc8SbM.js";import"./config-8gd_ljfe.js";import"./db-D9nATt-F.js";import"./i18n-BpwFYk4h.js";import"./toast-manager-DdtDDR9Z.js";console.log("wordRainGame.ts LOADED (Premium Upgrade)");let o,n,r=[],l=[],c=0,u=3,g=!1,p=null,E=0,y=2e3;const I=["#fbbf24","#f59e0b","#ffffff","#60a5fa"];function d(t=0){if(typeof dictionaryData>"u"||dictionaryData.length===0){t<10?(console.warn(`Data not ready for Rain Game. Retrying (${t+1}/10)...`),typeof showToast=="function"&&showToast("Laddar speldata... / جاري تحميل البيانات...","info"),setTimeout(()=>d(t+1),500)):(console.error("Critical: Data failed to load for Rain Game."),typeof showToast=="function"&&showToast("Kunde inte ladda data. Uppdatera sidan. / تعذر تحميل البيانات.","error"));return}const a=document.getElementById("rainCanvas");if(!a)return;o=a,n=o.getContext("2d"),o.width=o.offsetWidth||600,o.height=o.offsetHeight||400,r=[],l=[],c=0,u=3,g=!1;const e=document.getElementById("rainScore"),i=document.getElementById("rainLives"),f=document.getElementById("rainGameOver"),m=document.getElementById("rainInput"),h=document.getElementById("startRainBtn");e&&(e.textContent="0"),i&&(i.textContent="3"),f&&f.classList.add("hidden"),m&&(m.disabled=!0,m.value=""),h&&(h.style.display="block"),n.clearRect(0,0,o.width,o.height),n.font="24px Inter, sans-serif",n.fillStyle="rgba(255,255,255,0.8)",n.textAlign="center",n.fillText("Redo att spela? / مستعد للعب؟",o.width/2,o.height/2),h&&(h.onclick=L);const v=document.getElementById("restartRainBtn");v&&(v.onclick=()=>d()),m&&(m.onkeydown=w=>{w.key==="Enter"&&b()})}function L(){g=!0,r=[],l=[],c=0,u=3,E=Date.now();const t=document.getElementById("rainScore"),a=document.getElementById("rainLives"),e=document.getElementById("startRainBtn"),i=document.getElementById("rainInput");t&&(t.textContent="0"),a&&(a.textContent="3"),e&&(e.style.display="none"),i&&(i.disabled=!1,i.focus()),x()}function x(){if(!g)return;const t=Date.now();t-E>y&&(B(),E=t,y=Math.max(800,y-20)),r.forEach(e=>{e.y+=e.speed,e.x+=Math.sin(e.y*.05)*.5});for(let e=l.length-1;e>=0;e--){const i=l[e];i.x+=i.vx,i.y+=i.vy,i.life-=.02,i.vy+=.05,i.life<=0&&l.splice(e,1)}const a=document.getElementById("rainLives");r=r.filter(e=>e.y>o.height+20?(u--,a&&(a.textContent=String(u)),o.style.transform=`translateX(${Math.random()*10-5}px)`,setTimeout(()=>o.style.transform="none",100),u<=0&&C(),!1):!0),R(),g&&(p=requestAnimationFrame(x))}function B(){let t=null,a=0;for(;!t&&a<100;){const e=dictionaryData[Math.floor(Math.random()*dictionaryData.length)];e&&e[COL_SWE]&&e[COL_ARB]&&e[COL_SWE].length<=10&&(t={swedish:e[COL_SWE],arabic:e[COL_ARB],x:Math.random()*(o.width-100)+50,y:-40,speed:1+Math.random()*1.5,color:`hsl(${Math.random()*60+200}, 80%, 70%)`}),a++}t&&r.push(t)}function R(){n.clearRect(0,0,o.width,o.height),l.forEach(t=>{n.globalAlpha=t.life,n.fillStyle=t.color,n.beginPath(),n.arc(t.x,t.y,t.size,0,Math.PI*2),n.fill()}),n.globalAlpha=1,r.forEach(t=>{const a=n.measureText(t.arabic).width+30;n.shadowColor=t.color,n.shadowBlur=15,n.fillStyle="rgba(255, 255, 255, 0.1)",n.strokeStyle="rgba(255, 255, 255, 0.3)",n.lineWidth=1,n.beginPath(),n.roundRect(t.x-a/2,t.y-18,a,40,20),n.fill(),n.stroke(),n.shadowBlur=0,n.font='bold 20px "Tajawal", sans-serif',n.fillStyle="#fbbf24",n.textAlign="center",n.fillText(t.arabic,t.x,t.y+10),n.fillStyle="rgba(255, 255, 255, 0.2)",n.beginPath(),n.ellipse(t.x,t.y-12,a/4,3,0,0,Math.PI*2),n.fill()})}function S(t,a){for(let e=0;e<20;e++)l.push({x:t,y:a,vx:(Math.random()-.5)*8,vy:(Math.random()-.5)*8,life:1,size:Math.random()*3+2,color:I[Math.floor(Math.random()*I.length)]})}function b(){const t=document.getElementById("rainInput");if(!t)return;const a=t.value.trim().toLowerCase();if(t.value="",!a)return;const e=r.findIndex(i=>i.swedish.toLowerCase()===a);if(e!==-1){const i=r[e];S(i.x,i.y),r.splice(e,1),c+=10;const f=document.getElementById("rainScore");f&&(f.textContent=String(c)),t.classList.add("correct-flash"),setTimeout(()=>t.classList.remove("correct-flash"),300),typeof TTSManager<"u"&&TTSManager&&TTSManager.speak(a,"sv")}else t.classList.add("wrong-flash"),setTimeout(()=>t.classList.remove("wrong-flash"),300),typeof soundManager<"u"&&(soundManager!=null&&soundManager.playError)&&soundManager.playError()}function C(){g=!1,p&&cancelAnimationFrame(p);const t=document.getElementById("rainFinalScore"),a=document.getElementById("rainGameOver"),e=document.getElementById("rainInput");t&&(t.textContent=String(c)),a&&a.classList.remove("hidden"),e&&(e.disabled=!0),typeof saveScore=="function"&&saveScore("rain",c)}let s=!1;function M(){if(s)return;if(typeof dictionaryData<"u"&&dictionaryData.length>0){console.log("[WordRain] Data already available, initializing game..."),s=!0,d();return}let t=0;const a=50,e=setInterval(()=>{if(s){clearInterval(e);return}t++,typeof dictionaryData<"u"&&dictionaryData.length>0?(console.log("[WordRain] Data found via polling, initializing game..."),clearInterval(e),s=!0,d()):t>=a&&(console.error("[WordRain] Timeout waiting for dictionary data"),clearInterval(e),showToast("Kunde inte ladda data. Uppdatera sidan. / تعذر تحميل البيانات.","error"))},100);console.log("[WordRain] Waiting for dictionaryLoaded event..."),window.addEventListener("dictionaryLoaded",()=>{s||(console.log("[WordRain] dictionaryLoaded event received, initializing game..."),clearInterval(e),s=!0,d())},{once:!0})}document.addEventListener("DOMContentLoaded",M);window.initRainGame=d;
