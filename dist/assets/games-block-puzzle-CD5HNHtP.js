var w=Object.defineProperty;var b=(u,t,e)=>t in u?w(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var d=(u,t,e)=>b(u,typeof t!="symbol"?t+"":t,e);import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import"./loader-CqI2jdYk.js";import"./pwa-Bn3RWWLO.js";import"./config-CfHoVMbv.js";import"./db-bEbbjtoI.js";const m={colors:{gridLine:"#2a2a35",block:"#00f3ff",palette:["#00f3ff","#3b82f6","#ef4444","#ffe600"],bomb:"#ff0000",bombText:"#ffffff",ice:"#aaddff",rock:"#555566",ghost:"rgba(255, 255, 255, 0.2)",particles:["#00f3ff","#bc13fe","#ffffff"]},storageKeys:{highScore:"neonBlocks_highScore",gameState:"neonBlocks_state"}},S=[[[1]],[[1,1]],[[1],[1]],[[1,1,1]],[[1],[1],[1]],[[1,1],[1,1]],[[1,1,1],[0,1,0]],[[0,1,0],[1,1,1]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,1],[1,0]],[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1],[1,1,1]],[[0,1,0],[1,1,1],[0,1,0]],[[1,0,1],[1,1,1]],[[1,1,1],[1,0,1]],[[1,0,0],[1,0,0],[1,1,1]],[[0,0,1],[0,0,1],[1,1,1]],[[1,1,1],[0,1,0],[0,1,0]],[[1,0],[0,1]],[[0,1],[1,0]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]]];class k{constructor(){d(this,"ctx");d(this,"enabled");this.ctx=null,this.enabled=!0}init(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext)),this.ctx.state==="suspended"&&this.ctx.resume()}playTone(t,e,l,o=0,s=.1){if(!this.enabled||!this.ctx)return;const h=this.ctx.createOscillator(),i=this.ctx.createGain();h.type=e,h.frequency.setValueAtTime(t,this.ctx.currentTime+o),i.gain.setValueAtTime(s,this.ctx.currentTime+o),i.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+o+l),h.connect(i),i.connect(this.ctx.destination),h.start(this.ctx.currentTime+o),h.stop(this.ctx.currentTime+o+l)}playPickup(){this.playTone(400,"sine",.1,0,.05)}playPlace(){this.playTone(200,"triangle",.1,0,.1)}playClear(t=1){[1,1.25,1.5,2].forEach((l,o)=>this.playTone(440*l*(1+t*.1),"sine",.4,o*.05,.1)),t>1&&this.playTone(880,"square",.2,.2,.05)}playGameOver(){this.playTone(300,"sawtooth",.5,0,.1),this.playTone(250,"sawtooth",.5,.4,.1),this.playTone(200,"sawtooth",1,.8,.1)}playTick(){this.playTone(800,"square",.05,0,.05)}playIceCrack(){this.playTone(1200,"sawtooth",.1,0,.1)}playRotate(){this.playTone(600,"sine",.1,0,.05)}}class E{constructor(){d(this,"particles");d(this,"texts");d(this,"shake");this.particles=[],this.texts=[],this.shake=0}spawnExplosion(t,e,l,o){for(let s=0;s<l;s++)this.particles.push({x:t,y:e,color:o||m.colors.particles[0],vx:(Math.random()-.5)*4,vy:(Math.random()-.5)*4,life:1,decay:.02+Math.random()*.03,size:2+Math.random()*4})}spawnText(t,e,l,o){this.texts.push({x:t,y:e,text:l,color:o,life:1,vy:-1})}triggerShake(t){this.shake=t}update(){this.particles.forEach(t=>{t.x+=t.vx,t.y+=t.vy,t.life-=t.decay,t.size*=.95}),this.particles=this.particles.filter(t=>t.life>0),this.texts.forEach(t=>{t.y+=t.vy,t.life-=.02}),this.texts=this.texts.filter(t=>t.life>0),this.shake>0&&(this.shake*=.9,this.shake<.5&&(this.shake=0))}draw(t){this.particles.forEach(e=>{t.globalAlpha=e.life,t.fillStyle=e.color,t.beginPath(),t.arc(e.x,e.y,e.size,0,Math.PI*2),t.fill()}),this.texts.forEach(e=>{t.globalAlpha=e.life,t.fillStyle=e.color,t.font="bold 20px Inter, system-ui, sans-serif",t.textAlign="center",t.fillText(e.text,e.x,e.y)}),t.globalAlpha=1}getShake(){return this.shake>0?{x:(Math.random()-.5)*this.shake,y:(Math.random()-.5)*this.shake}:{x:0,y:0}}}class I{constructor(){d(this,"canvas");d(this,"ctx");d(this,"scoreEl");d(this,"highScoreEl");d(this,"finalScoreEl");d(this,"timerContainer");d(this,"timerValue");d(this,"mode");d(this,"grid");d(this,"hand");d(this,"score");d(this,"highScore");d(this,"moves");d(this,"timeLeft");d(this,"timerInterval");d(this,"fx");d(this,"sound");d(this,"metrics");d(this,"isDragging",!1);d(this,"dragIdx",-1);d(this,"dragPos",{x:0,y:0});d(this,"dragOffset",{x:0,y:0});this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.scoreEl=document.getElementById("score"),this.highScoreEl=document.getElementById("highScore"),this.finalScoreEl=document.getElementById("finalScore"),this.timerContainer=document.getElementById("timerContainer"),this.timerValue=document.getElementById("timerValue"),this.mode="classic",this.grid=Array(9).fill(null).map(()=>Array(9).fill(null)),this.hand=[null,null,null],this.score=0,this.highScore=0,this.moves=0,this.timeLeft=120,this.timerInterval=null,this.fx=new E,this.sound=new k,this.metrics={scale:1,gridSize:0,cellSize:0,gridX:0,gridY:0,handY:0},this.loadHighScore(),this.resize(),window.addEventListener("resize",()=>this.resize()),this.initInput(),localStorage.getItem(m.storageKeys.gameState)&&(document.getElementById("resumeBtn").style.display="block"),this.loop()}startMode(t){this.mode=t,this.restart(),document.getElementById("mainMenu").classList.remove("active"),this.mode==="time"?(this.timeLeft=120,this.timerContainer.style.display="block",this.startTimer()):this.timerContainer.style.display="none"}showMenu(){document.getElementById("gameOverModal").classList.remove("active"),document.getElementById("mainMenu").classList.add("active"),this.stopTimer()}resume(){this.loadState()&&(document.getElementById("mainMenu").classList.remove("active"),this.mode==="time"&&(this.timerContainer.style.display="block",this.startTimer()))}rotateHand(){this.sound.playRotate();for(let t=0;t<3;t++){const e=this.hand[t];if(e){const l=e.shape,o=l.length,s=l[0].length,h=Array(s).fill(null).map(()=>Array(o).fill(0));for(let i=0;i<o;i++)for(let r=0;r<s;r++)h[r][o-1-i]=l[i][r];e.shape=h}}}startTimer(){this.stopTimer(),this.timerInterval=setInterval(()=>{this.timeLeft--,this.timerValue.textContent=this.timeLeft.toString(),this.timeLeft<=10&&this.sound.playTick(),this.timeLeft<=0&&this.endGame()},1e3)}stopTimer(){this.timerInterval&&clearInterval(this.timerInterval)}resize(){const t=document.getElementById("game-container"),e=window.devicePixelRatio||1;this.canvas.width=t.clientWidth*e,this.canvas.height=t.clientHeight*e,this.canvas.style.width=`${t.clientWidth}px`,this.canvas.style.height=`${t.clientHeight}px`,this.ctx.scale(e,e);const l=20,o=t.clientWidth-l*2;this.metrics.cellSize=Math.floor(o/9),this.metrics.gridSize=this.metrics.cellSize*9,this.metrics.gridX=(t.clientWidth-this.metrics.gridSize)/2,this.metrics.gridY=l+(this.mode==="time"?40:0),this.metrics.handY=this.metrics.gridY+this.metrics.gridSize+40}spawnShapes(){for(let t=0;t<3;t++){const e=S[Math.floor(Math.random()*S.length)];let l=m.colors.block;this.mode==="color"&&(l=m.colors.palette[Math.floor(Math.random()*m.colors.palette.length)]),this.hand[t]={shape:e,color:l}}}placeShape(t,e,l){const{shape:o,color:s}=t;let h=0;this.moves++;for(let i=0;i<o.length;i++)for(let r=0;r<o[0].length;r++)if(o[i][r]===1){this.grid[e+i][l+r]={color:s,bomb:null,ice:!1,rock:!1},h++;const c=this.metrics.gridX+(l+r)*this.metrics.cellSize+this.metrics.cellSize/2,p=this.metrics.gridY+(e+i)*this.metrics.cellSize+this.metrics.cellSize/2;this.fx.spawnExplosion(c,p,3,s)}this.addScore(h*10),this.sound.playPlace(),this.fx.triggerShake(2),this.mode==="bomb"&&this.moves%5===0&&this.spawnBomb(),this.moves%15===0&&this.spawnIce(),this.moves%30===0&&this.spawnRock(),this.mode==="bomb"&&this.updateBombs()}spawnBomb(){let t=this.getFilledCells().filter(e=>!e.cell.bomb&&!e.cell.rock&&!e.cell.ice);if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];e.cell.bomb=9,this.sound.playTick()}}spawnIce(){let t=this.getFilledCells().filter(e=>!e.cell.bomb&&!e.cell.rock&&!e.cell.ice);if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];e.cell.ice=!0}}spawnRock(){let t=this.getEmptyCells();if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];this.grid[e.r][e.c]={color:m.colors.rock,rock:!0,bomb:null,ice:!1},this.fx.spawnExplosion(this.metrics.gridX+e.c*this.metrics.cellSize+this.metrics.cellSize/2,this.metrics.gridY+e.r*this.metrics.cellSize+this.metrics.cellSize/2,5,m.colors.rock)}}getFilledCells(){let t=[];for(let e=0;e<9;e++)for(let l=0;l<9;l++)this.grid[e][l]&&t.push({r:e,c:l,cell:this.grid[e][l]});return t}getEmptyCells(){let t=[];for(let e=0;e<9;e++)for(let l=0;l<9;l++)this.grid[e][l]||t.push({r:e,c:l});return t}updateBombs(){for(let t=0;t<9;t++)for(let e=0;e<9;e++){const l=this.grid[t][e];if(l&&l.bomb!==null&&(l.bomb--,l.bomb<=0)){this.endGame();return}}}checkClear(){let t=[],e=[],l=[];for(let s=0;s<9;s++)this.grid[s].every(h=>h!==null)&&t.push(s);for(let s=0;s<9;s++){let h=!0;for(let i=0;i<9;i++)this.grid[i][s]||(h=!1);h&&e.push(s)}for(let s=0;s<3;s++)for(let h=0;h<3;h++){let i=!0;for(let r=0;r<3;r++)for(let c=0;c<3;c++)this.grid[s*3+r][h*3+c]||(i=!1);i&&l.push({r:s,c:h})}const o=t.length+e.length+l.length;if(o>0){this.sound.playClear(o),this.fx.triggerShake(o*4),this.mode==="time"&&(this.timeLeft+=o*5,this.timerValue.textContent=this.timeLeft.toString(),this.fx.spawnText(this.metrics.gridX+this.metrics.gridSize/2,this.metrics.gridY,`+${o*5}s`,"#0f0"));let s=1,h=new Set;const i=(f,a)=>h.add(`${f},${a}`);t.forEach(f=>{this.mode==="color"&&this.grid[f].every(a=>a&&a.color===this.grid[f][0].color)&&(s+=2);for(let a=0;a<9;a++)i(f,a)}),e.forEach(f=>{let a=[];for(let n=0;n<9;n++)a.push(this.grid[n][f]);this.mode==="color"&&a.every(n=>n&&n.color===a[0].color)&&(s+=2);for(let n=0;n<9;n++)i(n,f)}),l.forEach(f=>{let a=[];for(let n=0;n<3;n++)for(let g=0;g<3;g++)a.push(this.grid[f.r*3+n][f.c*3+g]);this.mode==="color"&&a.every(n=>n&&n.color===a[0].color)&&(s+=2);for(let n=0;n<3;n++)for(let g=0;g<3;g++)i(f.r*3+n,f.c*3+g)}),h.forEach(f=>{const[a,n]=f.split(",").map(Number),g=this.grid[a][n];g&&!g.rock&&(g.ice?(g.ice=!1,this.sound.playIceCrack(),this.fx.spawnExplosion(this.metrics.gridX+n*this.metrics.cellSize+this.metrics.cellSize/2,this.metrics.gridY+a*this.metrics.cellSize+this.metrics.cellSize/2,5,m.colors.ice)):(this.spawnClearFX(a,n,g.color),this.grid[a][n]=null))});const r=o*100*s;this.addScore(r);const c=this.metrics.gridX+this.metrics.gridSize/2,p=this.metrics.gridY+this.metrics.gridSize/2;this.fx.spawnText(c,p,`+${r}`,"#fff"),s>1&&this.fx.spawnText(c,p-30,"Färgmatch! / تطابق!",m.colors.palette[3])}}spawnClearFX(t,e,l){const o=this.metrics.gridX+e*this.metrics.cellSize+this.metrics.cellSize/2,s=this.metrics.gridY+t*this.metrics.cellSize+this.metrics.cellSize/2;this.fx.spawnExplosion(o,s,5,l)}initInput(){const t=()=>{this.sound.init(),window.removeEventListener("touchstart",t),window.removeEventListener("mousedown",t)};window.addEventListener("touchstart",t),window.addEventListener("mousedown",t),this.isDragging=!1;const e=h=>{const i=this.canvas.getBoundingClientRect(),r=h.touches?h.touches[0]:h;return{x:r.clientX-i.left,y:r.clientY-i.top}},l=h=>{if(document.querySelector(".modal-overlay.active")&&!document.getElementById("mainMenu").classList.contains("active")||document.getElementById("mainMenu").classList.contains("active"))return;const i=e(h);if(i.y>this.metrics.handY){const r=this.canvas.width/3/(window.devicePixelRatio||1),c=Math.floor(i.x/r);c>=0&&c<3&&this.hand[c]&&(this.isDragging=!0,this.dragIdx=c,this.dragPos=i,this.dragOffset={x:0,y:-50},this.sound.playPickup())}},o=h=>{this.isDragging&&(this.dragPos=e(h))},s=()=>{if(!this.isDragging)return;const h=this.hand[this.dragIdx];if(!h)return;const i=this.getGridPos(this.dragPos.x+this.dragOffset.x,this.dragPos.y+this.dragOffset.y,h.shape);i&&this.canPlace(h.shape,i.r,i.c)&&(this.placeShape(h,i.r,i.c),this.hand[this.dragIdx]=null,this.checkClear(),this.saveState(),this.hand.every(r=>r===null)&&(this.spawnShapes(),this.saveState()),this.checkGameOver()&&this.endGame()),this.isDragging=!1,this.dragIdx=-1};this.canvas.addEventListener("mousedown",l),window.addEventListener("mousemove",o),window.addEventListener("mouseup",s),this.canvas.addEventListener("touchstart",h=>{h.preventDefault(),l(h)},{passive:!1}),this.canvas.addEventListener("touchmove",h=>{h.preventDefault(),o(h)},{passive:!1}),this.canvas.addEventListener("touchend",s)}getGridPos(t,e,l){const o=l[0].length*this.metrics.cellSize,s=l.length*this.metrics.cellSize,h=t-this.metrics.gridX-o/2+this.metrics.cellSize/2,i=e-this.metrics.gridY-s/2+this.metrics.cellSize/2;return{r:Math.round(i/this.metrics.cellSize),c:Math.round(h/this.metrics.cellSize)}}canPlace(t,e,l){for(let o=0;o<t.length;o++)for(let s=0;s<t[0].length;s++)if(t[o][s]&&(e+o<0||e+o>=9||l+s<0||l+s>=9||this.grid[e+o][l+s]))return!1;return!0}predictWillClear(t,e,l){const o=this.grid.map(i=>i.map(r=>r?{...r}:null));for(let i=0;i<t.length;i++)for(let r=0;r<t[0].length;r++)t[i][r]&&(o[e+i][l+r]={color:"#fff",bomb:null,ice:!1,rock:!1});const s={rows:[],cols:[],sqs:[]};for(let i=0;i<9;i++)o[i].every(r=>r!==null)&&s.rows.push(i);for(let i=0;i<9;i++){let r=!0;for(let c=0;c<9;c++)o[c][i]||(r=!1);r&&s.cols.push(i)}for(let i=0;i<3;i++)for(let r=0;r<3;r++){let c=!0;for(let p=0;p<3;p++)for(let f=0;f<3;f++)o[i*3+p][r*3+f]||(c=!1);c&&s.sqs.push({r:i,c:r})}const h=s.rows.length+s.cols.length+s.sqs.length;return{willClear:h>0,clearCount:h,cleared:s}}checkGameOver(){if(this.hand.every(t=>t===null))return!1;for(let t=0;t<3;t++){const e=this.hand[t];if(e&&e.shape){for(let l=0;l<9;l++)for(let o=0;o<9;o++)if(this.canPlace(e.shape,l,o))return!1}}return!0}endGame(){this.stopTimer(),this.finalScoreEl.textContent=this.score.toString(),this.score>=this.highScore&&this.score>0?document.getElementById("newHighScoreLabel").style.display="block":document.getElementById("newHighScoreLabel").style.display="none",document.getElementById("mainMenu").classList.remove("active"),document.getElementById("gameOverModal").classList.add("active"),this.sound.playGameOver(),localStorage.removeItem(m.storageKeys.gameState)}restart(){this.grid=Array(9).fill(null).map(()=>Array(9).fill(null)),this.score=0,this.moves=0,this.timeLeft=120,this.scoreEl.textContent="0",document.getElementById("gameOverModal").classList.remove("active"),this.spawnShapes(),this.saveState()}addScore(t){this.score+=t,this.scoreEl.textContent=this.score.toString(),this.score>this.highScore&&(this.highScore=this.score,this.highScoreEl.textContent=this.highScore.toString(),localStorage.setItem(m.storageKeys.highScore,this.highScore.toString()))}saveState(){if(this.timeLeft<=0)return;const t={grid:this.grid,hand:this.hand,score:this.score,mode:this.mode,timeLeft:this.timeLeft};localStorage.setItem(m.storageKeys.gameState,JSON.stringify(t))}loadState(){const t=localStorage.getItem(m.storageKeys.gameState);if(t)try{const e=JSON.parse(t);return this.grid=e.grid,this.hand=e.hand,this.score=e.score,this.mode=e.mode||"classic",this.timeLeft=e.timeLeft||120,this.scoreEl.textContent=this.score.toString(),!0}catch(e){return console.error(e),!1}return!1}loadHighScore(){const t=localStorage.getItem(m.storageKeys.highScore);t&&(this.highScore=parseInt(t),this.highScoreEl.textContent=this.highScore.toString())}loop(){this.fx.update(),this.draw(),requestAnimationFrame(()=>this.loop())}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const t=this.fx.getShake();this.ctx.save(),this.ctx.translate(t.x,t.y);const{gridX:e,gridY:l,gridSize:o,cellSize:s}=this.metrics;this.ctx.strokeStyle=m.colors.gridLine,this.ctx.lineWidth=1;for(let i=0;i<=9;i++)this.ctx.beginPath(),this.ctx.moveTo(e+i*s,l),this.ctx.lineTo(e+i*s,l+o),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e,l+i*s),this.ctx.lineTo(e+o,l+i*s),this.ctx.stroke();this.ctx.lineWidth=3,this.ctx.strokeStyle="#3a3a4a";for(let i=0;i<=3;i++)this.ctx.beginPath(),this.ctx.moveTo(e+i*s*3,l),this.ctx.lineTo(e+i*s*3,l+o),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e,l+i*s*3),this.ctx.lineTo(e+o,l+i*s*3),this.ctx.stroke();for(let i=0;i<9;i++)for(let r=0;r<9;r++){const c=this.grid[i][r];c&&(this.drawBlock(e+r*s,l+i*s,s,c.color,!1,c.ice,c.rock),c.bomb!==null&&(this.ctx.fillStyle=m.colors.bombText,this.ctx.font="bold 20px Inter, system-ui, sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(c.bomb.toString(),e+r*s+s/2,l+i*s+s/2),this.ctx.strokeStyle=m.colors.bomb,this.ctx.lineWidth=2,this.ctx.strokeRect(e+r*s+2,l+i*s+2,s-4,s-4)))}const h=this.canvas.width/3/(window.devicePixelRatio||1);for(let i=0;i<3;i++){const r=this.hand[i];if(r&&i!==this.dragIdx){const{shape:c,color:p}=r,f=c[0].length*(s*.6);c.length*(s*.6),this.drawShape(c,i*h+(h-f)/2,this.metrics.handY,s*.6,p)}}if(this.isDragging&&this.dragIdx!==-1){const i=this.hand[this.dragIdx];if(i){const{shape:r,color:c}=i,p=this.dragPos.x+this.dragOffset.x,f=this.dragPos.y+this.dragOffset.y,a=this.getGridPos(p,f,r);if(a&&this.canPlace(r,a.r,a.c)){this.drawShape(r,e+a.c*s,l+a.r*s,s,m.colors.ghost);const y=this.predictWillClear(r,a.r,a.c);y.willClear&&(this.ctx.fillStyle="rgba(0, 255, 0, 0.3)",y.cleared.rows.forEach(x=>{this.ctx.fillRect(e,l+x*s,o,s)}),y.cleared.cols.forEach(x=>{this.ctx.fillRect(e+x*s,l,s,o)}),y.cleared.sqs.forEach(x=>{this.ctx.fillRect(e+x.c*3*s,l+x.r*3*s,s*3,s*3)}))}const n=r[0].length*s,g=r.length*s;this.drawShape(r,p-n/2+s/2,f-g/2+s/2,s,c,!0)}}this.fx.draw(this.ctx),this.ctx.restore()}drawShape(t,e,l,o,s,h=!1){for(let i=0;i<t.length;i++)for(let r=0;r<t[0].length;r++)t[i][r]&&this.drawBlock(e+r*o,l+i*o,o,s,h)}drawBlock(t,e,l,o,s,h=!1,i=!1){this.ctx.fillStyle=o,s&&(this.ctx.shadowColor=o,this.ctx.shadowBlur=15),this.ctx.fillRect(t+2,e+2,l-2*2,l-2*2),h&&(this.ctx.fillStyle="rgba(255, 255, 255, 0.4)",this.ctx.fillRect(t+2,e+2,l-2*2,l-2*2),this.ctx.strokeStyle="#fff",this.ctx.lineWidth=2,this.ctx.strokeRect(t+2+2,e+2+2,l-2*2-4,l-2*2-4)),i&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(t+2,e+2,l-2*2,l-2*2),this.ctx.fillStyle="#333",this.ctx.beginPath(),this.ctx.arc(t+l/2,e+l/2,l/4,0,Math.PI*2),this.ctx.fill()),this.ctx.shadowBlur=0}}let v;window.addEventListener("load",()=>{v=new I,window.game=v});function L(){document.body.classList.toggle("iphone-view");const u=document.body.classList.contains("iphone-view");localStorage.setItem("mobileView",u?"true":"false");const t=document.getElementById("mobileToggle");t&&t.classList.toggle("active",u)}window.toggleMobileView=L;localStorage.getItem("mobileView")==="true"&&(document.body.classList.add("iphone-view"),document.addEventListener("DOMContentLoaded",()=>{const u=document.getElementById("mobileToggle");u&&u.classList.add("active")}));
